/*!
 * SG2D 1.0.0 by @ilyak
 * https://sg2d.ru
 * License MIT
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("SG2D",[],e):"object"==typeof exports?exports.SG2D=e():t.SG2D=e()}(this,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);class s{constructor(t,e,i){if(this.constructor.singleInstance){if(this.constructor._instance)throw"Error! this.constructor._instance not is empty!";this.constructor._instance=this}var r=t||{},o="function"==typeof this.defaults?this.defaults():s.clone(this.constructor.defaultProperties);if(this.constructor.localStorageKey){let e=void 0,i=localStorage.getItem(this.constructor.localStorageKey+(this.constructor.singleInstance?"":"_"+t.id));i&&(e=JSON.parse(i)),e&&s.initObjectByObject(o,e)}for(var n in r){var a=r[n];switch(this.constructor.typeProperties[n]){case s.TYPE_ANY:case s.TYPE_ARRAY:break;case s.TYPE_NUMBER:r[n]=void 0===a?void 0:+a;break;case s.TYPE_NUMBER_OR_XY:"object"==typeof a?(a.x=void 0===a.x?void 0:+a.x,a.y=void 0===a.y?void 0:+a.y):r[n]=void 0===a?void 0:+a;break;case s.TYPE_ARRAY_NUMBERS:for(var h=0;h<a.length;h++)a[h]=+a[h];break;case s.TYPE_OBJECT_NUMBERS:if(Array.isArray(a)){if(!(p=o[n]))throw'No default value was set for an object named "'+n+'" ('+this.constructor.name+")! An object structure is required to fill in the data!";var l=0;for(var h in p)p[h]=+a[l],l++;r[n]=p}else{if("object"!=typeof a)throw'Error! Property "'+n+'" ('+this.constructor.name+") must be an object or an array!";for(var h in a)a[h]=+a[h]}break;case s.TYPE_STRING:r[n]=""+a;break;case s.TYPE_BOOLEAN:r[n]=!!a;break;case s.TYPE_OBJECT:if(Array.isArray(a)){var p;if(!(p=o[n]))throw'No default value was set for an object named "'+n+'" ('+this.constructor.name+")! An object structure is required to fill in the data!";l=0;for(var h in p)p[h]=a[l],l++;r[n]=p}else if("object"!=typeof a)throw'Error! Property "'+n+'" ('+this.constructor.name+") must be an object or an array!";break;default:throw'Error! Unknown type specified for property "'+n+'" ('+this.constructor.name+")!"}}if(this.properties=s.defaults({},o,r),this.properties.id||(this.properties.id=s.uid()),e?Object.assign(this,e):e=s.OBJECT_EMPTY,this.destroyed=!1,this.onChangeCallbacks={},!this.constructor.hasOwnProperty("_ownSettersInitialized"))for(var n in this.constructor._ownSettersInitialized=!0,this.constructor.ownSetters)!0===this.constructor.ownSetters[n]&&(this.constructor.ownSetters[n]=this["set"+s.upperFirstLetter(n)]);this.changed=!1,this.initialize.call(this,t,e,i)}initialize(){}set(t,e,i,r=0){if("object"!=typeof i&&void 0!==i)throw'Error 7610932! "options" type is not a object or undefined! Property: '+t+", constructor: "+this.constructor.name;if("number"!=typeof r)throw'Error 7892354! "flags" type is not a number!';if(i=i||s.OBJECT_EMPTY,!(r&s.FLAG_IGNORE_OWN_SETTER)&&this.constructor.ownSetters[t])return this.constructor.ownSetters[t].call(this,e,i,r);var o=this.constructor.typeProperties[t];if(o)switch(o){case s.TYPE_ANY:break;case s.TYPE_NUMBER:void 0!==e&&(e=i.precision?s.roundTo(e,i.precision):+e);break;case s.TYPE_NUMBER_OR_XY:return this._setNumberOrXY.apply(this,arguments);case s.TYPE_ARRAY:case s.TYPE_ARRAY_NUMBERS:return this._setArray.apply(this,arguments);case s.TYPE_OBJECT:case s.TYPE_OBJECT_NUMBERS:return this._setObject.apply(this,arguments);case s.TYPE_STRING:e=""+e;break;case s.TYPE_BOOLEAN:e=!!e}var n=this.properties[t];if(n===e){if(!(r&s.FLAG_FORCE_CALLBACKS))return!1}else this.properties[t]=e,this.changed=!0;if(!(r&s.FLAG_NO_CALLBACKS)){s._prevValue=void 0!==i.previous_value?i.previous_value:r&s.FLAG_PREV_VALUE_CLONE?s.clone(n):n;var a=this.onChangeCallbacks[t];if(a){r&s.FLAG_OFF_MAY_BE&&(a=s.clone(a));var h=void 0;for(var l in a){var p=a[l];void 0!==(h=p.d?p.f.call(p.c?p.c:this,p.d,e,s._prevValue):p.f.call(p.c?p.c:this,e,s._prevValue))&&(n=h)}}}return!0}_setArray(t,e,i,r=0){if(i=i||s.OBJECT_EMPTY,!(r&s.FLAG_IGNORE_OWN_SETTER)&&this.constructor.ownSetters[t])return this.constructor.ownSetters[t].call(this,e,i,r);var o=this.constructor.typeProperties[t],n=this.properties[t];if(s._prevValue=i.previous_value||void 0,s._bChanged=!1,Array.isArray(e))for(var a=0;a<e.length;a++){var h=e[a];o===s.TYPE_ARRAY_NUMBERS&&(h=i.precision?s.roundTo(h,i.precision):+h),n[a]!==h&&(s._bChanged=!0,r&s.FLAG_PREV_VALUE_CLONE&&!s._prevValue&&(s._prevValue=s.clone(n)),n[a]=h)}else{if(e)throw"aValues should be must Array or empty! ("+this.constructor.name+")";for(h=o===s.TYPE_OBJECT_NUMBERS?0:void 0,a=0;a<n.length;a++)n[a]!==h&&(s._bChanged=!0,r&s.FLAG_PREV_VALUE_CLONE&&!s._prevValue&&(s._prevValue=s.clone(n)),n[a]=h)}return s._bChanged&&(this.changed=!0),!!(s._bChanged||r&s.FLAG_FORCE_CALLBACKS)&&(this._runCallbacks(t,n,r),!0)}_setObject(t,e,i,r=0){if(i=i||s.OBJECT_EMPTY,!(r&s.FLAG_IGNORE_OWN_SETTER)&&this.constructor.ownSetters[t])return this.constructor.ownSetters[t].call(this,e,i,r);var o=this.constructor.typeProperties[t],n=this.properties[t];if(s._prevValue=i.previous_value||void 0,s._bChanged=!1,Array.isArray(e))for(var a in s._index=0,n){var h=e[s._index];o===s.TYPE_OBJECT_NUMBERS&&(h=i.precision?s.roundTo(h,i.precision):+h),n[a]!==h&&(s._bChanged=!0,r&s.FLAG_PREV_VALUE_CLONE&&!s._prevValue&&(s._prevValue=s.clone(n)),n[a]=h),s._index++}else if(e)for(var a in e){h=e[a];o===s.TYPE_OBJECT_NUMBERS&&(h=i.precision?s.roundTo(h,i.precision):+h),n[a]!==h&&(s._bChanged=!0,r&s.FLAG_PREV_VALUE_CLONE&&!s._prevValue&&(s._prevValue=s.clone(n)),n[a]=h)}else{h=o===s.TYPE_OBJECT_NUMBERS?0:void 0;for(var a in n)n[a]!==h&&(s._bChanged=!0,r&s.FLAG_PREV_VALUE_CLONE&&!s._prevValue&&(s._prevValue=s.clone(n)),n[a]=h)}return s._bChanged&&(this.changed=!0),!!(s._bChanged||r&s.FLAG_FORCE_CALLBACKS)&&(this._runCallbacks(t,n,r),!0)}_setNumberOrXY(t,e,i,r=0){if(i=i||s.OBJECT_EMPTY,!(r&s.FLAG_IGNORE_OWN_SETTER)&&this.constructor.ownSetters[t])return this.constructor.ownSetters[t].call(this,e,i,r);let o=this.properties[t];return s._prevValue=i.previous_value||void 0,s._bChanged=!1,void 0!==e?"object"==typeof e?(e.x=i.precision?s.roundTo(e.x,i.precision):+e.x,e.y=i.precision?s.roundTo(e.y,i.precision):+e.y,"object"==typeof o?o.x===e.x&&o.y===e.y||(s._bChanged=!0,r&s.FLAG_PREV_VALUE_CLONE&&!s._prevValue&&(s._prevValue=s.clone(o)),o.x=e.x,o.y=e.y):o===e.x&&o===e.y||(s._bChanged=!0,s._prevValue=o,this.properties[t]=e)):(e=i.precision?s.roundTo(e,i.precision):+e,"object"==typeof o?o.x===e&&o.y===e||(s._bChanged=!0,r&s.FLAG_PREV_VALUE_CLONE&&!s._prevValue&&(s._prevValue=s.clone(o)),this.properties[t]=e):o!==e&&(s._bChanged=!0,s._prevValue=o,this.properties[t]=e)):o!==e&&(s._bChanged=!0,r&s.FLAG_PREV_VALUE_CLONE&&!s._prevValue&&(s._prevValue=s.clone(o)),this.properties[t]=void 0),!!s._bChanged&&(this.changed=!0,(s._bChanged||r&s.FLAG_FORCE_CALLBACKS)&&this._runCallbacks(t,e,r),!0)}_runCallbacks(t,e,i=0){if(!(i&s.FLAG_NO_CALLBACKS)){var r=this.onChangeCallbacks[t];if(r){i&s.FLAG_OFF_MAY_BE&&(r=s.clone(r));var o=void 0;for(var n in r){var a=r[n];void 0!==(o=a.d?a.f.call(a.c?a.c:this,a.d,e,s._prevValue):a.f.call(a.c?a.c:this,e,s._prevValue))&&(e=o)}}}}get(t){return this.properties[t]}on(t,e,i,r,o=0){var n=this.onChangeCallbacks[t];n||(n=this.onChangeCallbacks[t]=[]),n.push({f:e,c:i,d:r}),o===s.FLAG_IMMEDIATELY&&(r?e.call(i||this,r,this.properties[t],this.properties[t]):e.call(i||this,this.properties[t],this.properties[t]))}off(t,e){if(t){var i=this.onChangeCallbacks[t];if(i)if(e)for(var s=0;s<i.length;s++)i[s].f===e&&(i.splice(s,1),s--);else i.length=0}else for(var r in this.onChangeCallbacks)this.onChangeCallbacks[r].length=0}trigger(t,e=0){var i=this.onChangeCallbacks[t];if(i)for(var r in e&s.FLAG_OFF_MAY_BE&&(i=s.clone(i)),i)i[r].f.call(i[r].c?i[r].c:this,i[r].d?i[r].d:this.properties[t])}save(){if(!this.constructor.localStorageKey)throw"Error 37722990!";let t;this.constructor.singleInstance&&(t=this.properties.id,delete this.properties.id);let e={};for(var i in this.properties)"_"!==i[0]&&(e[i]=this.properties[i]);localStorage.setItem(this.constructor.localStorageKey+(this.constructor.singleInstance?"":"_"+t),JSON.stringify(e)),this.constructor.singleInstance&&(this.properties.id=t)}destroy(){this.destroyed=!0,this.constructor._instance=null,this.off()}}"object"==typeof window&&(window.SGModel=s),"object"==typeof self&&(self.SGModel=s),"object"==typeof _root&&(_root.SGModel=s),s.typeProperties={},s.defaultsProperties={},s.TYPE_ANY=void 0,s.TYPE_NUMBER=1,s.TYPE_STRING=2,s.TYPE_BOOLEAN=3,s.TYPE_OBJECT=4,s.TYPE_ARRAY=5,s.TYPE_ARRAY_NUMBERS=6,s.TYPE_OBJECT_NUMBERS=7,s.TYPE_NUMBER_OR_XY=8,s.FLAG_IMMEDIATELY=!0,s.OBJECT_EMPTY=Object.preventExtensions({}),s.FLAG_OFF_MAY_BE=1,s.FLAG_PREV_VALUE_CLONE=2,s.FLAG_NO_CALLBACKS=4,s.FLAG_FORCE_CALLBACKS=8,s.FLAG_IGNORE_OWN_SETTER=16,s.OPTIONS_PRECISION_2=Object.preventExtensions({precision:2}),s.OPTIONS_PRECISION_3=Object.preventExtensions({precision:3}),s.OPTIONS_PRECISION_4=Object.preventExtensions({precision:4}),s.OPTIONS_PRECISION_5=Object.preventExtensions({precision:5}),s.ownSetters={},s._uid=0,s.uid=function(){return++s._uid},s.defaults=function(t,...e){for(var i=e.length;i--;){var r=e[i];for(var o in r)void 0===t[o]&&(t[o]="object"==typeof r[o]?s.clone(r[o]):r[o])}return t},s.clone=function(t){let e;if(Array.isArray(t)){e=[];for(var i=0;i<t.length;i++)e[i]="object"==typeof t[i]?s.clone(t[i]):t[i]}else if("object"==typeof t)for(var r in e={},t)e[r]="object"==typeof t[r]?s.clone(t[r]):t[r];else e=t;return e},s.initObjectByObject=function(t,e){if(Array.isArray(t))for(var i=0;i<t.length;i++)e.hasOwnProperty(i)&&("object"==typeof t[i]?this.initObjectByObject(t[i],e[i]):t[i]=e[i]);else if("object"==typeof t)for(var s in t)e.hasOwnProperty(s)&&("object"==typeof t[s]?this.initObjectByObject(t[s],e[s]):t[s]=e[s]);else t=e;return t},s.upperFirstLetter=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},s.roundTo=function(t,e=0){let i=10**e;return Math.round(t*i)/i},s._instance=null,s.singleInstance=!1,s.getInstance=function(t=!1){if(this._instance)return this._instance;if(!t)throw"Error! this._instance is empty!";return null},s.get=function(...t){return this._instance&&this._instance.get(...t)},s.set=function(...t){return this._instance&&this._instance.set(...t)},s.on=function(...t){return this._instance&&this._instance.on(...t)},s.off=function(...t){return this._instance&&this._instance.off(...t)},s.localStorageKey="",s._bChanged=!1,s._index=0,s._prevValue=void 0,s._xy={x:0,y:0};var r={CELLSIZEPIX:32,CELLSIZEPIX05:16,CELLSIZELOG2:5,AREASIZE:128,AREASIZELOG2:Math.ceil(Math.log2(128)),AREASQUARE:16384,DRAW_BODY_LINES:!1,ONLY_LOGIC:!1,DEBUGGING:{CAMERA:{WIDTH_HEIGHT_K:1.01,SHOW:{GRID:!1,BOUNDS_PXY:!1,BOUNDS_TOP_CLUSTERS:!1,CLUSTER_LINE_BOUNDS:!1,AXIS_LABELS:!1,CLUSTERS_IN_OUT:!1}}},SYSTEM_TILES:[{name:"sg2d/override",url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAS+ElEQVRo3tVae3gb1ZU/1oykmZFmxnpbki2/ZctRnObhJA7pJhtCCIRXIAmP0KRACZQSCoXSXVooXViWLbTQTbfd7YPyaCmENgVKCCVxSIJjR3bsxLZsyeO3bD391Og9Go36xwQT7IAdSKH8vvn0zdw5c+753XMf59wrgC8hcBlaaqABYKyByvmijTlvGGhCyMIoG+9+m8TlgHzR9pwfCjSUJCcnMBUba6A6ugUuDV8yD+AyNMHxp/cpBQEm2OzaGlRy9muakCkx6Rdt5Mei0qSiyEykmZJIckYns2trUABAz5bICNnlV+4WMhmJRPIpK/lHIpsV3H/+mX8sOzohXLzyjOUfIRBNpgUhM+R2xKNTX7S154CC0swuRGc8S3Ik8ehU0OP+oq09BwyWyrkJfBxwZa7aUEhrjCpdAQCERpgYO+4bcJ4tU1i5PM9SiUrlADDq60vEpry9bYKQAQA5TlqsS3J1ZlQqD430hIaZyFSI1hjVhiJTsX1aA5eKBzyuYaZ1/qzmRYAg1Tk5Od6+NkhNRAIusdDnGZLjymxW4JJxUmXguaS3t1WIB6e/8o4MS1CZUqmVSFA+nYoEmeTkIAAIghBlx43F9nH/QHzKM9jhO7uuVCopwxQYoWQngvOxbW4CqFQej0wAwK277nzwoUemx/eOG7acaKgHABlGIKg0Hhm/81v3fPv+B6c/fPzRh3///G9TiTihpNPJSF1rr1QqFQlcd8Wlgx6fSp37l3oHgn7EBi6VWr+wIpWIYwSZjEfm74ozWLflvhldraB8CQA8+4tfuQd9tip7gaWwwFJYaVvgHvTdtfteADBYKnGcOHiskfEEalasFAUu+uoa96DvQN0xUUl9c1tjq1N8tef/f9vU5srLM6Io+temUz94+hmzpXD6OsYM7j/ZJsew2baJhjEHyLrnFHwHLV5zT5fFC2pNJvMll1722CPf73Z36ctqNYVL3a5OjuPuuf/BsnJr0OMuLS8vLCrevvUat7sHMA1Kmo6/f/Sl3/22tNyaZzTuvG2X3mD49l27hj1DbIz7wYPfyVWpEBTleT7D8xdvujIWjSg0pRJMI1OaNl+0XKs3fOPe+wEgz2Kb07x5zfdyDJNIJFtv3J6Tk9Ny+JUYO16+aE3tYvvyatuI10dR9GtvvO3zeVuam3INhelUwlyyqLiq9snHH/3XVTUBv/8PLzy3zF7R0uyg1IbwuH+GckKhxAlFIjY1zLQKAj8+GnrsgXt33LUbAMxliy4Agc4T+wf6+75z950VlTZHW9fv9+7raTva03Y0FovKSV3N+q/l5ACCID/97ycEQYhMBEPDTKjnqKe7KZPJeEeGAUBO0HiuUW+xyXEKQZD/ePLpTCaTTnOz6+LTHAC8tfcVAMBwPDo1Oqd5cw/iydAwABzY/9f6Y0fXXbLhqWd/ftLJAEA8FtuwZtXJw3+UIQAALc1NADA15l25avXzL++NxaLZLADAHbfc3NLcpM+38nwq5HFdcfXmyzZdecctXwsFg2qdTqXRfqQ5EQQASJoGgKKycv9Q1wXwgCBk1IbC2stuUZsr39j3J6slb5ndusxuzTMaW7t69FqVKLb+0ssAgNYYTzTUL6+2LV1gXWa3AkBPdzcA8HzK19++5fqbnnr258889eR7dQf1+VYcJzAcP7uuVDwKAJFwGAA8/f3i/PFZCQDARHBopPPwkLupyLZ8xYYdazbfjRHkMnsFiqIEoRBlvn7b7QBAaYw6c5m5YmVh5XKtTi+XyVg2DADDTOtvXvjDY08+9dCD3/nlnmcJUqUxFs2uiNaaAOD1hmYAiMeitMb0WQnQGiMA2KrsdfWOVav/ZdDV5Bt0jvn6xe4hIhwO73vtVXN+QYGlcCIwhCmoyaBnyN00NhpKcZytyg4AO2/btbL2okvXXrRv76uLVl9TZFshx5RnWj2Z5FIpMldfunC1glQDgDG/YP9rrwJAaISZT/t+BLPXAbXegmHY/oNHuof8F2/YSFG0eLUzg/XNbRiGqfUWBEHePdLAeAIVtirxrb16kWvA29LJAACKoownoNMbpr+lKFqpJJUkdbDd/chPfkZS9PR1xNV3xN2HKxSzbTvnOjD3IM5k0iCRbrpk7Z3fuucXv/5dJpPJZDJyudzv921cexFB6xWUFpHJN21Yu/qra944cIjjOBRFURR98rFHX3ju1zRN/+alV3ieP3qiBUVRAOB5HkXRocGB7duulSCSjddu2bT1egDIZDIIgrSeaHjg1h2JWAxTUMkYO6d5MzOydVvu62w6MCMazdXlp1OJGDturbSlkslEIq7R6FxdTowgCVI9ERyiNUY+zcXY8bJy6+TkhFJJEoSC6XYRpIbnuUR0qrCoGADEAROLRRUKZW9PN58RikpLM5kMhuEAkEwmMAxnupwEqZLKsNkrhsFSGfS4mQPksF9YU3OufODjMDU6QpDqIttyhd6ikhMAwKXithpTb9uxieAQAITH/QgqzS/7CqEv1BTTooA2kg55exWkSmcuUxqsSvrMjEkBJBMRbQLYcT+uKsEISir7MHAo4GWToeHZ1n8c5htOxyMTg66mQVfTx/Y0Pj3Se3qk9/SM8mh4LBoeG/X2znApqdJTGmNX0ztnl2tNpbiSRlHZPK2CeU6jFxzhcR8XCYbO6qioVIYR5JivT4iPTo155Tj5T0ogV2sGAHv10hdeO7z7gUelUqmYKOryrcl4pLTc+l5D8wL7QqlMPk+F5+5CCkpjKrbr860AwE4G+p0NfJorsddmeN7b1xZjxxWURmsqodR53r52LhnLL1+sMRQBQDIR6TyxPxmPmIrtOnMZQaq4VALDydAII5XjCkotkysmQkOM8/jOrevY8FQ6nZYTOfaVm3J1BUGPa2w0BACdzo4C6xIAKLKtENcyQeDbj785XwK0xphOxaOjvWICFY1GpTIsmxWm/K6gzytBpLlaczQ8Nsy0GEzmieAwQaqnRpyxEMNxnEQi4dOcktb6Bpzp2OhoKFhgKQSAYc+Q3mDoCgbz8owIiqYSMVDlprmUktYiqHTcczo0cFKn0wcDZ8auktbG2YnQwMmwD0smkzKZLJWIGosWzJ2sr9l8t6lkIYIg9c2nGU+A8QROnOpUqdWmAsvxvuE3TrQAwIoNOwDgkZ/+T+Ogr7jciiDI344cZzyBzl6Pq3+kpLQMAPILLKfdfTfvvFVUUl5R2dEzdOPNOzv7ht2DvkWLlzb0j6zdeBkASGWy+ubTHT1Dnb2etevWM54AAIjO7+gZYjyBDmbQPegrKS3DFTTMWshmErho0+0URbd0Mo2nnDq9nqLo9xqa65tP4wTx9bu/7fAEAKB80RoAcHgCP3nuRQzHDxx+v6G1Q6vTUxS945ZvtHX3m0xmAGju6D7pZMR1FwAYT+D4yXbxkVapHJ6A2VJIUfRRR+uf3jygUqspim5qc4kEAOCkk2loOSO/89bb27oHzPkF8yJA0zTjCVgrbSp9AQBU2qoYT4CiaJKmj3b3G0xmUbJhwFtUVk5R9EknMx3SSSSS9xqar9t2g0jg2q3Xwwf7OYwncMs37hAfSYoWCRhNZvegr7CouGLJxQBw/U1fmybAeAIKxZl4KScn5+iJlh8+/l8w/5QyFo1SaiMATE1OptNpAIiEw+k0/5u/vAUA23d9Mx6LDfb2XHr5FSRJHms6ddLJnHQyTe1uo8l8//ceksvlAHDob+8AQIwdF3U2OxrPfhQJSyQSnue1xhIAePXll8Tye7/7bwBw1NEqqm3u6DbkGa+4+lrRmXPPQiK4VBwAhKwgCIJYctMla/7qOAUA9/zgh0xXJwBYKypZlq1ZWDHjW0KhQFGEpCgxnD5fZHgeAMSMYhY+skR80jrgH3ACgFyOic1pLLaH/B+u8HdcdzUA7HnmaZqmbVV2Oa5csWEHrTGKYQ+O4wiCRti5ozEREyGPRIJM95k9zzwNAJW2BQgqq1m/nVIbxNlsNs5BgOcz8VjstTf2i3sbz7+8Vyy3lC8BAKarUxzK8Vh00epr+Awfi0X/+Oc3QEg73n1RiaMHjzXetfve8bGxVCo1p90Rlg2Hw8+/vJc5VScImaOOD/fkYrHoK/velMulzYf+QBKyunrHj5/ZMzcBVCpXqs1L7VZBEDqYQcYTyFWpahfb00IOOxkEgKcf/ncAEBOOaHhMilHL7BVe70hHz5BrwFtX77h95/Zf/9//WittFEUtrVkuqrVV2bPZrEJ5xvvZbFYQhMqF1SwbXrV0IY7jTmbQNeD91S/2AIB9YbWp2L7YVhZPxE+7+rr6Rw4fb7ptx43f/979swmcI5z2DTgDQ116LSWTSgFgYmIimkjjStX0IlK5sNrd0S7eGyyVyViYkOVotNpEIoGgKON2fWD0AqbbnclkxMjeVmV3dTklCIJKMS4ZK620efr7stkcTEGZ8rRpjpNIJH29PfaF1c6OdnPpojg7gaEZjVYbjUZxnHB1Oc2l1d6+9rnD6cnR4Qyfzsr1dL4VAHLIQKTLMW29Pt+KEPkFVlTcgg163JTaQJuraUMRDZBMRAoEfJhpNRXbeZnWUkENdDUmY6w+34pQheZSxNvXxmViCkqD55bk6vnRkR6JRCLLLdFpTFwqpi9fHZkM5WrHvX1tlNqgKV1Ga0yiWj3L8efaiZmJ2SnlPw8+ZUp5QUBrjJTGmIxHRkd6DJbKDJ8e8/VdEM2fE4HwuB+TSabGQgAQ9LhxYr7h/pz4nPKByqpFL7x2eOv22yUSSYGlcNc9/0nRahmm+Oyaz8MDxmJ7SVWteJ9MRPwDTt+AU0FpqpZfKpOfMSXGjvd3HmcngmfnA+xEoL+rcefWdRNjIaPJXFfv2HLV5Wx4QqXLl8qwItsKMctJxll3y6GzA40LSQAjSP+AE9LhdJrjUimSon2eIQBIRCd97ve9I8NGkxlFUZ7nuVQClcpn5AMcl8oKfDqdHh0NDQ0O+H0jKIoiUrk0mw30NbP+TjY8heFEmkvkas1TY95P75FzzkJSOQ4AC76yuL5v+P2eobpOxuEJbPv6bRiGm/ML3IO+qzZf5+ofYTwBV/+I0WSGj8kHNlx2+ZETLYwn0NDSXlfv0Op0Uqm0rt7BeAInnUxnr0dvyPsE2845C81NQGcuB4DSStvxvuHFK2unt9AcnsAL+9+Vy+X1zW2uAW9JaRlF0UdOtDS2OjUaLczKB8RcR6vV1dU7iopLlEpSq9M1nnK2dDLm/AKKojdefkVrV4/o7fkTmHsQo1IZACASBJVKe7u6ImxYvHZu2vDNbZvlckxvMDz5+I/6+3oTydSWKzcCZKf3nJ/40cMsG84ACgAIihIEwXFcgaUQx4loNILjhEwmu3LDOu/IMMuG33n7LUHI7r7vgWQ8Yi6d+2hDxNwE/IOdANDb7Yqw7OuNzYeczF+ONwHAUH9fPBYTZZoaGwCgqGrl2OhoPB63VVaJ5TPygRnYvGUbSVJvHXxPDPpPOhmSJHff9wB8cFAwH8xrEEvlOKHMXf9BdO7wBByeQIbnb1i/Zmps7MPGkJypNT/fIt58cj6QZzSxLHvxRTXh8EyZ0HDPBfMAAKRTifC4v8K+UG0o1BpLrllVs8KSF56auvrG7aLAgupqABjoOkHTNJ2rOnjozH7bJ+cDv9zzLEVRJnM+QapXbNihpHXTQX8qMd8D1rkJ5GrNuELxwGNPvPj2QblUGPP3+0eGAUCt1R5883UxH3jsiR9rdXouGXv9wCGKoubUSdEUAKRSyVQqtff1/QSGOt59schirKt3iF1IPJeYD+buQvHoFJeMPf3wQ+3NTeLZiYjv37XL3dFOUTSCoDtv2tbQ0g4A4XB4md3Ksqytyk7T9PLaVYf+dgAA7AurAYDOVSWZ7mDA/9Kr+9Ict271iiULyg/XO8RvAeCh7973p1f/iCmoC7m5yyVjUjmeTiXeffP1oN+XiMVj0YjBbG5tbBAFMAyLsOy2qzfJMfloKAQorqCkri7njddddfpUKwBgBOnsaL/xuqtampskEuSryxfbqxehCBpPCRiRe8vNN2g0GjbMIojE2dEux8n5HAtMY75jAADMpYtQskRXXFu0cAOuXnD2nzQAwOnskBsWE7oKIZOJseOmYjubJizWGgBIxiP6fGsK0ZlLFykoTfGCWtK8JImos1kBAOSqUlS9QF1cK9faiqtq59/75+uBaXj72rx9bTMKKZoWf/k013TwpenGm/FHltAIM33gFZkKDXQ2Tr/qdLx9XhZ/egLnhN/nvXrj+oH+XgA4L9dfKHzWcJpUG6O8TKk2f/6mi/iIBypNqmxWUFCa88oquWQcQaWfQyKqM5fN3p0+Q6BAQ41F4pOpKfeff/YPb7RPi3PuraMAYKCJbDab4PjQO5R/LHveij9fKPGckvwPe34OLkOVmGyUjZ/ep5RIYHTin51ASb6kwPghAdSkUvQFw2MNlMcnBMez0//H/LIgBwC63yZ7hwS5HNbWfMmsBwBkrIGCLHBpWL3ky2c9APwdTcH9egUuowYAAAAASUVORK5CYII="},{name:"sg2d/404",url:"data:image/png;base64,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"}],TILE_OVERRIDE:"sg2d/override",TILE_404:"sg2d/404",PIXI_TEXTURE_STRICT:!1};let o={};var n=o;!function(){let t=0;o.uid=function(){return++t};let e=[];for(var i=0;i<=10;i++)e[i]=10**i;o.roundTo=function(t,i){var s=e[i];return Math.round(t*s)/s},o.absDelta=function(t,e){return Math.abs(t-e)},o.PI180=Math.PI/180,o.PI2=2*Math.PI,o.rad90=90*o.PI180,o.normalize_a=function(t,e=0){for(;t>=360;)t-=360;for(;t<0;)t+=360;return e&&(t=o.roundTo(t,e)),t};let s=[],r=[];for(var n=0;n<=360;n++)s[n]=Math.sin(n*o.PI180),r[n]=Math.cos(n*o.PI180);let a=[],h=[];for(n=0;n<=3600;n++){var l=n/10;a[n]=Math.sin(l*o.PI180),h[n]=Math.cos(l*o.PI180)}o.sin=function(t,e=0){return 0===e?s[o.normalize_a(t,e)]:a[Math.round(10*o.normalize_a(t,1))]},o.cos=function(t,e=0){return 0===e?r[o.normalize_a(t,e)]:h[Math.round(10*o.normalize_a(t,1))]},o.angle_p1p2_deg=function(t,e,i=0){var s=Math.atan2(e.y-t.y,e.x-t.x);return o.normalize_a(s/o.PI180,i)},o.distance_d=function(t,e){return Math.sqrt(t*t+e*e)},o.distance_p=function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},o.betweenAnglesDeg=function(t,e){var i=e-t,s=e-360-t,r=e-(t-360);return Math.abs(i)<Math.abs(s)?Math.abs(r)<Math.abs(i)?r:i:Math.abs(r)<Math.abs(s)?r:s},o.nearestDirRotate=function(t,e){var i=o.normalize_a(e-t),s=o.normalize_a(t-e);return i===s?0:i>s?-1:1},o.vectors45=[{dx:1,dy:0},{dx:1,dy:1},{dx:0,dy:1},{dx:-1,dy:1},{dx:-1,dy:0},{dx:-1,dy:-1},{dx:0,dy:-1},{dx:1,dy:-1}],o.vectors90=[{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0},{dx:0,dy:-1}];let p=[];o._addLinePoint=function(t,e){this.push({x:t,y:e})},o.getLinePoints=function(t,e,i){var s=o._addLinePoint;"function"==typeof i?s=i:Array.isArray(i)?s=s.bind(i):(p.length=0,s=s.bind(p)),s(Math.round(t.x),Math.round(t.y));for(var r=t.x,n=t.y,a=e.x,h=e.y,l=a-r,c=h-n,u=Math.sqrt(l*l+c*c),d=l/u,_=c/u,f=r,v=n,m=Math.round(r),E=Math.round(n),x=m,T=E;;){f+=d,v+=_;var A=Math.round(f),I=Math.round(v);if(A!==x||I!==T){if(a>r&&f>a||a<r&&f<a)break;if(h>n&&v>h||h<n&&v<h)break;if(A!=x&&I!=T){var y=A,g=T,C=x,S=I;Math.sqrt(Math.pow(y-f,2)+Math.pow(g-v,2))+Math.sqrt(Math.pow(y-m,2)+Math.pow(g-E,2))>Math.sqrt(Math.pow(C-f,2)+Math.pow(S-v,2))+Math.sqrt(Math.pow(C-m,2)+Math.pow(S-E,2))?(s(C,S),x=C,T=S):(s(y,g),x=y,T=g)}s(A,I),m=f,E=v,x=A,T=I}}return p};let c={x:void 0,y:void 0};o.avgVertext=function(t,e){if(!t.length)throw"Error 773734";e=e||c,c.x=t[0].x,c.y=t[0].y;for(var i=1;i<t.length;i++)c.x+=t[i].x,c.y+=t[i].y;return c.x=c.x/t.length,c.y=c.y/t.length,c}}();var a={DEFAULT_WIDTH:32,DEFAULT_HEIGHT:32,getTime:function(){if("undefined"!=typeof process&&process.hrtime)var t=process.hrtime(),e=t[0]+"."+("00"+Math.round(t[1]/1e6)).substr(-3,3);else if("undefined"!=typeof performance&&performance.now)e=(performance.now()/1e3).toFixed(3);else{e=((new Date).getTime()/1e3).toFixed(3)}return+e},getTextureAsCanvas:function(t){var e="object"==typeof t?t:PIXI.Texture.from(t);if(e.canvas)return e.canvas;var i=this.createCanvas(e.frame.width,e.frame.height);return i.getContext("2d").drawImage(e.baseTexture.resource.source,e.frame.x,e.frame.y,e.frame.width,e.frame.height,0,0,e.frame.width,e.frame.height),i.texture=e.textureCacheIds[0]||"error",e.canvas=i,i},getTextureAsBlob:async function(t){if("string"==typeof t&&!PIXI.utils.TextureCache[t])return console.error('Texture "'+t+'" does not exist!'),!1;var e="object"==typeof t?t:PIXI.Texture.from(t);if(e.blob)return e.blob;var i=this.createCanvas(e.frame.width,e.frame.height);return i.getContext("2d").drawImage(e.baseTexture.resource.source,e.frame.x,e.frame.y,e.frame.width,e.frame.height,0,0,e.frame.width,e.frame.height),i.convertToBlob?e.blob=await i.convertToBlob({type:"image/png"}):e.blob=await new Promise(t=>i.toBlob(e=>t(e))),e.blob},getTextureUrl:async function(t,e){if(!t)return null;var i=await a.getTextureAsBlob(t);if(!i)return!1;if(i.url=i.url||URL.createObjectURL(i),!e)return i.url;var s=window.open("","_blank");s.document.write("<html><head><script>window.location = '"+i.url+"';<\/script></head></html>"),s.document.close()},_options:{x:void 0,y:void 0},drawTextureToCanvas:function(t,e,i){i=i||this._options;var s=e.getContext("2d");e=this.getTextureAsCanvas(t);s.drawImage(e,void 0===i.x?0:i.x,void 0===i.y?0:i.y)},addMask:function(t){for(var e=t.width||a.DEFAULT_WIDTH,i=t.height||a.DEFAULT_HEIGHT,s=this.createCanvas(e,i),r=s.getContext("2d"),o=r.getImageData(0,0,e,i),h=e>>1,l=e*i*4,p=0;p<l;p+=4){var c=p>>2,u=Math.floor(c/i)-h,d=c-(u+h)*e-h,_=n.distance_d(d+.5,u+.5),f=t.iterate(d,u,_,c);o.data[p]=f.r,o.data[p+1]=f.g,o.data[p+2]=f.b,o.data[p+3]=f.a}r.putImageData(o,0,0),s._pixiId=t.name;var v=PIXI.Texture.from(s);return v.canvas=s,v._isFinalTexture=!0,s},_optionsBAT:{},setBorderAlphaTextures:function(t={}){t.textures=t.textures||[],t.textures.length||this._getFinalTextures(t.textures);for(var e=0;e<t.textures.length;e++){var i="object"==typeof t.textures[e]?t.textures[e]:PIXI.utils.TextureCache[t.textures[e]];i?(this._optionsBAT.texture=i,this._optionsBAT.alpha=t.alpha,this._optionsBAT.alpha2=t.alpha2,this.setBorderAlphaTexture(this._optionsBAT)):console.warn('Texture with name "'+t.textures[e]+'" not found!')}},setBorderAlphaTexture:function(t={}){void 0===t.alpha&&(t.alpha=.995),void 0===t.alpha2&&(t.alpha2=1),t.alpha=~~(256*t.alpha),t.alpha2=~~(256*t.alpha2);let e="object"==typeof t.texture?t.texture:PIXI.utils.TextureCache(t.texture),i=this.getTextureAsCanvas(e);for(var s=i.getContext("2d"),r=s.getImageData(0,0,i.width,i.height),o=i.width*i.height*4,n=0;n<o;n+=4){var a=n>>2,h=Math.floor(a/i.width),l=a-h*i.width;0!==l&&0!==h&&l!==i.width-1&&h!==i.height-1||(r.data[n+3]=Math.min(r.data[n+3],t.alpha)),t.alpha2<255&&(1===l||1===h||l===i.width-2||h===i.height-2)&&(r.data[n+3]=Math.min(r.data[n+3],t.alpha2))}s.putImageData(r,0,0),PIXI.Texture.removeFromCache(i.texture),PIXI.BaseTexture.removeFromCache(i.texture),i._pixiId=i.texture;var p=PIXI.Texture.from(i);p.canvas=i,p._isFinalTexture=e._isFinalTexture},addBorderAlphaTextures:function(t){t.textures=t.textures||[],t.textures.length||this._getFinalTextures(t.textures);for(var e=0;e<t.textures.length;e++){var i="object"==typeof t.textures[e]?t.textures[e]:PIXI.utils.TextureCache[t.textures[e]];if(i){var s=a.getTextureAsCanvas(i),r=a.createCanvas(i.width+2,i.height+2);r.getContext("2d").drawImage(s,1,1),r._pixiId=i.textureCacheIds[0]||i.canvas._pixiId,PIXI.Texture.removeFromCache(r._pixiId),PIXI.BaseTexture.removeFromCache(r._pixiId);var o=PIXI.Texture.from(r);o.canvas=r,o._isFinalTexture=i._isFinalTexture}else console.warn('Texture with name "'+t.textures[e]+'" not found!')}},_getFinalTextures:function(t){for(var e in PIXI.utils.TextureCache){var i=PIXI.utils.TextureCache[e];i._isFinalTexture&&t.push(i)}},_ibt:[],createInBetweenTextures:function(t){if(t.start,t.end,t.count=Math.max(2,t.count||2),t.name,t.count<=2)return;let e=this.getTextureAsCanvas(t.start),i=this.getTextureAsCanvas(t.end),s=e.width,r=e.height,o=s*r;for(var n=0;n<o;n++)this._ibt[n]=!1;let a=e.getContext("2d").getImageData(0,0,s,r).data,h=i.getContext("2d").getImageData(0,0,s,r).data,l=t.count-1,p=Math.ceil(o/l),c=null;for(var u=2;u<t.count;u++){for(var d=(u-1)/(t.count-1),_=t.count-u+1,f=new ImageData(Uint8ClampedArray.from(c||a),s,r),v=f.data,m=0;m<p;m++)for(var E=Math.floor(Math.random()*_),x=m*l,T=x;T<x+l;T++)if(!this._ibt[T]){if(0===E){this._ibt[T]=!0;for(var A=T<<2,I=a[A]+a[A+1]+a[A+2],y=(h[A]+h[A+1]+h[A+2]-I)*d/3/256,g=0;g<3;g++){v[C=A+g]=h[C],v[C]=y<0?~~(v[C]*(1+y)):~~(v[C]+(256-v[C])*y)}var C,S=(h[C=A+3]-a[C])*d/256;v[C]=h[C],S&&(v[C]=S<0?~~(v[C]*(1+S)):~~(v[C]+(256-v[C])*S));break}E--}var b=this.createCanvas(s,r);b.getContext("2d").putImageData(f,0,0),b._pixiId=t.name.replace("%",u),(w=PIXI.Texture.from(b)).canvas=b,w._isFinalTexture=!0,c=v}var P=t.name.replace("%",1);PIXI.utils.TextureCache[P]||(e._pixiId=P,(w=PIXI.Texture.from(e))._isFinalTexture=!0);var w,L=t.name.replace("%",t.count);PIXI.utils.TextureCache[L]||(i._pixiId=L,(w=PIXI.Texture.from(i))._isFinalTexture=!0)},parseTexturePack:function(t){for(var e in t)if("_image"!==e.substr(-6,6)){var i=t[e];for(var s in i.textures){var r=i.textures[s],o=s.match(/(.+)_(\d+)x(\d+)(\w)?(\.\w+)?$/);if(o){r._isFinalTexture=!1;var n=o[1],a=+o[2],h=+o[3],l=o[4]||"h",p=Math.floor(r.width/a),c=Math.floor(r.height/h);if("h"!==l)throw"dir vertical no supported! (TODO)";for(var u=0,d=0;d<c;d++)for(var _=0;_<p;_++){var f=n+"_"+ ++u;if(PIXI.utils.TextureCache[f])console.error('Texture "'+f+'" already exists!');else{var v=_*a,m=d*h,E=new PIXI.Rectangle(0,0,0,0);E.width=a,E.height=h,E.x=r.frame.x+v,E.y=r.frame.y+m;var x=new PIXI.Texture(r,E);PIXI.Texture.addToCache(x,f),x._isFinalTexture=!0}}PIXI.Texture.removeFromCache(r),PIXI.BaseTexture.removeFromCache(r)}else r._isFinalTexture=!0}}},_loadSystemTextures:function(){return new Promise((t,e)=>{if("undefined"==typeof PIXI)t("PIXI is undefined! Perhaps we are working in server mode!");else{(new PIXI.Loader).add(r.SYSTEM_TILES).load((e,i)=>{for(var s=0;s<r.SYSTEM_TILES.length;s++)PIXI.Texture.removeFromCache(r.SYSTEM_TILES[s].url),PIXI.BaseTexture.removeFromCache(r.SYSTEM_TILES[s].url),PIXI.utils.TextureCache[r.SYSTEM_TILES[s].name]._isFinalTexture=!0;t()})}})},FLAG_CANVAS_OFFSCREEN:0,FLAG_CANVAS_ELEMENT:1,createCanvas:function(t,e,i=0){if(i===this.FLAG_CANVAS_ELEMENT||"undefined"==typeof OffscreenCanvas){var s=document.createElement("CANVAS");return s.width=t||a.DEFAULT_WIDTH,s.height=e||a.DEFAULT_HEIGHT,s}return new OffscreenCanvas(t||a.DEFAULT_WIDTH,e||a.DEFAULT_HEIGHT)},PXtoCX:function(t){return 1+(t>>r.CELLSIZELOG2)},debounce:function(t,e){let i;return function(){const s=this,r=arguments;clearTimeout(i),i=setTimeout(()=>t.apply(s,r),e)}},throttle:function(t,e,i){let s,r;return function(){const o=i||this,n=arguments;r?(clearTimeout(s),s=setTimeout((function(){Date.now()-r>=e&&(t.apply(o,n),r=Date.now())}),e-(Date.now()-r))):(t.apply(o,n),r=Date.now())}},_p:void 0,isEmpty:function(t){for(this._p in t)return!1;return!0},objectForEach:function(t,e,i=this){for(var s in t)if(!1===e.call(i,t[s]))break},ifUndefined:function(t,e){return void 0===t?e:t}},h=a;class l{constructor(){1==arguments.length?this.setBounds(arguments[0]):4==arguments.length?this.set.apply(this,arguments):this.set(0,0,0,0)}set(){1===arguments.length?this.setBounds(arguments[0]):(this.min={x:Math.min(arguments[0],arguments[2]),y:Math.min(arguments[1],arguments[3])},this.max={x:Math.max(arguments[0],arguments[2]),y:Math.max(arguments[1],arguments[3])})}setBounds(t){this.min={x:t.min.x,y:t.min.y},this.max={x:t.max.x,y:t.max.y}}dx(t){return void 0!==t&&(this.max.x=this.min.x+t),this.max.x-this.min.x}dy(t){return void 0!==t&&(this.max.y=this.min.y+t),this.max.y-this.min.y}}class p{constructor(t){this.i=t.i,this.x=t.x,this.y=t.y,this.position={x:t.x*r.CELLSIZEPIX-r.CELLSIZEPIX05,y:t.y*r.CELLSIZEPIX-r.CELLSIZEPIX05},this.tiles=new Set,this.bodies=new Set,this.lighting_frame=0}inCamera(){for(var t of(this.drawed=!0,this.tiles))t.drawUndraw()}outCamera(){for(var t of(this.drawed=!1,this.tiles)){for(var e of t.clusters)if(e.drawed)return;t.removeSprites()}}getLayerTiles(t,e=null){if(e){for(var i of(e.length=0,this.tiles))(void 0===i.properties.layer&&i.constructor.layer===t||i.properties.layer===t)&&e.push(i);return e}for(var i of(p._tiles.length=0,this.tiles))(void 0===i.properties.layer&&i.constructor.layer===t||i.properties.layer===t)&&p._tiles.push(i);return p._tiles}tileInCluster(t){if("function"==typeof t){for(var e of this.tiles)if(e.constructor===t)return e}else for(var e of this.tiles)if(e.properties.texture===t)return e;return!1}}p._tiles=[];class c{constructor(t,e=p){if(c._instance)throw"SG2DClusters Error! There is an instance of the class! You must execute .destroy() on the previous instance!";if(c._instance=this,void 0!==(t=t||{}).areasize&&(r.AREASIZE=t.areasize,r.AREASQUARE=t.areasize*t.areasize,r.AREASIZELOG2=Math.ceil(Math.log2(t.areasize))),-1===c.permissible_sizes.indexOf(r.AREASIZE))throw"Side of map size cannot differ from "+c.permissible_sizes.join(",")+"! Now SG2DConsts.AREASIZE="+r.AREASIZE;var i,s;this.areasize=this.width=this.height=r.AREASIZE,this.areasizepix=this.areasize*r.CELLSIZEPIX,this.clusters=[],this.tiles=c.tiles,this.tilesset=c.tilesset,this.bodies=c.bodies,this.clear();for(var o=0;o<r.AREASQUARE;o++)[i,s]=this.getXYbyIndex(o),this.clusters[o]=new e({x:i,y:s,i:o})}getXYbyIndex(t){return p._y=t>>r.AREASIZELOG2,[t-(p._y<<r.AREASIZELOG2)+1,1+p._y]}getClusterByIndex(t){return p._y=t>>r.AREASIZELOG2,p._x=t-(p._y<<r.AREASIZELOG2),this.getCluster0(p._x,p._y)}getCluster0(t,e){return!this.outArea0(t,e)&&this.clusters[(e<<r.AREASIZELOG2)+t]}getCluster(t,e){return!this.outArea(t,e)&&this.clusters[(e-1<<r.AREASIZELOG2)+(t-1)]}getClusterCXY(t){return!this.outArea(t.x,t.y)&&this.clusters[(t.y-1<<r.AREASIZELOG2)+(t.x-1)]}outArea0(t,e){return t<0||t>=this.width||e<0||e>=this.height}outArea(t,e){return t<1||t>this.width||e<1||e>this.height}inArea0(t,e){return!this.outArea0(t,e)}inArea(t,e){return!this.outArea(t,e)}each(t){for(var e=0;e<r.AREASQUARE;e++)t(this.clusters[e])}nearestClusters90(t,e){for(var i,s=0;s<4;s++)if((i=this.getCluster(t.x+n.vectors90[s].dx,t.y+n.vectors90[s].dy))&&!0===e(i,Math.round(90*s)))return!0;return!1}nearestClusters45(t,e){for(var i,s=0;s<8;s++)if((i=this.getCluster(t.x+n.vectors45[s].dx,t.y+n.vectors45[s].dy))&&!0===e(i,Math.round(45*s)))return!0;return!1}clear(){c.tiles.length=0,c.tilesset.clear(),c.bodies.clear()}destroy(){this.clear(),c._instance=null}}c.permissible_sizes=[8,16,32,64,128,256,512,1024],c._x=0,c._y=0,c._instance=null,c.getInstance=function(){if(this._instance)return this._instance;throw"Error! SG2DClusters._instance is empty!"},c.tiles=[],c.tilesset=new Set,c.bodies=new Set,c.each=function(t){return c.getInstance().each(t)},c.getCluster=function(t,e){return c.getInstance().getCluster(t,e)},c.getClusterCXY=function(t){return c.getInstance().getClusterCXY(t)},c.inArea=function(t,e){return c.getInstance().inArea(t,e)},c.outArea=function(t,e){return c.getInstance().outArea(t,e)},c.nearestClusters90=function(t,e){return c.getInstance().nearestClusters90(t,e)},c.nearestClusters45=function(t,e){return c.getInstance().nearestClusters45(t,e)};var u={drawDebug:function(){let t=x.getInstance(),e=t.clusters,i=t.camera;if(r.DEBUGGING.CAMERA.SHOW.GRID){if(!this._temp116){this._temp116=[];for(var s=0;s<=e.width;s++){(n=new PIXI.Graphics).lineStyle(2,16777215).moveTo(s*r.CELLSIZEPIX,0).lineTo(s*r.CELLSIZEPIX,e.height*r.CELLSIZEPIX),n.zIndex=9999,this._temp116.push(n),t.viewport.addChild(n)}for(var o=0;o<=e.height;o++){var n;(n=new PIXI.Graphics).lineStyle(2,16777215).moveTo(0,o*r.CELLSIZEPIX).lineTo(e.width*r.CELLSIZEPIX,o*r.CELLSIZEPIX),n.zIndex=9999,this._temp116.push(n),t.viewport.addChild(n)}}}else{if(this._temp116)for(var a in this._temp116)t.viewport.removeChild(this._temp116[a]);this._temp116=void 0}if(r.DEBUGGING.CAMERA.SHOW.BOUNDS_PXY){this._temp110&&t.viewport.removeChild(this._temp110);var h=this._temp110=new PIXI.Graphics,l=i.boundsPXTops;h.moveTo(l.leftTop.x,l.leftTop.y),h.lineStyle(3,16776960,1),h.lineTo(l.rightTop.x,l.rightTop.y),h.lineStyle(3,16711680,1),h.lineTo(l.rightBottom.x,l.rightBottom.y),h.lineStyle(3,65280,1),h.lineTo(l.leftBottom.x,l.leftBottom.y),h.lineStyle(3,255,1),h.lineTo(l.leftTop.x,l.leftTop.y),h.endFill(),h.zIndex=9999,t.viewport.addChild(h)}else this._temp110&&(t.viewport.removeChild(this._temp110),this._temp110=void 0);if(r.DEBUGGING.CAMERA.SHOW.BOUNDS_TOP_CLUSTERS){this._temp111||(this._temp111={});var p=0,c=[16711680,65280,255,11141290];for(var a in i.boundsClusterTops){var u=i.boundsClusterTops[a];if(!this._temp111[a])(h=this._temp111[a]=new PIXI.Graphics).lineStyle(3,c[p++],1),h.moveTo(0,0),h.lineTo(63,0),h.lineTo(63,63),h.lineTo(0,63),h.lineTo(0,0),h.endFill(),h.zIndex=9999,t.viewport.addChild(h);this._temp111[a].position.set(64*u.x-64,64*u.y-64)}}else{if(this._temp111)for(var a in this._temp111)t.viewport.removeChild(this._temp111[a]);this._temp111=void 0}if(r.DEBUGGING.CAMERA.SHOW.CLUSTER_LINE_BOUNDS){this._temp112||(this._temp112=[]);for(p=0;p<this._temp112.length;p++)t.viewport.removeChild(this._temp112[p]);this._temp112.length=0;for(p=0;p<i.boundsPoint._length;p++){(h=this._temp112[p]=new PIXI.Graphics).lineStyle(2,16777215,2);u=i.boundsPoint[p];h.moveTo(0,0),h.lineTo(63,0),h.lineTo(63,63),h.lineTo(0,63),h.lineTo(0,0),h.endFill(),h.zIndex=9998,h.position.set(64*u.x-64,64*u.y-64),t.viewport.addChild(h)}}else{if(this._temp112)for(var a in this._temp112)t.viewport.removeChild(this._temp112[a]);this._temp112=void 0}if(r.DEBUGGING.CAMERA.SHOW.AXIS_LABELS)if(this._temp115){var d=i.properties.rotate-i.rotate_adjustment;for(p=0;p<this._temp115.length;p++)this._temp115[p].angle=d}else{this._temp115=[];for(s=1;s<=e.width;s++){if(_=e.getCluster(s,1))(f=new PIXI.Text(s,{fontFamily:"Arial",fontSize:12,fill:16777215,align:"center"})).position.x=_.position.x,f.position.y=_.position.y-r.CELLSIZEPIX,f.angle=-i.rotate_adjustment,f.zIndex=9999,this._temp115.push(f),t.viewport.addChild(f)}for(o=1;o<=e.height;o++){var _,f;if(_=e.getCluster(1,o))(f=new PIXI.Text(o,{fontFamily:"Arial",fontSize:12,fill:16777215,align:"center"})).position.x=_.position.x-r.CELLSIZEPIX,f.position.y=_.position.y,f.angle=-i.rotate_adjustment,f.zIndex=9999,this._temp115.push(f),t.viewport.addChild(f)}}else{if(this._temp115)for(var a in this._temp115)t.viewport.removeChild(this._temp115[a]);this._temp115=void 0}},drawDebug2:function(){let t=x.getInstance(),e=t.camera;if(r.DEBUGGING.CAMERA.SHOW.CLUSTERS_IN_OUT){this._temp113||(this._temp113=[]);for(var i=0;i<this._temp113.length;i++)t.viewport.removeChild(this._temp113[i]);this._temp113.length=0;for(i=0;i<e.clustersIn.length;i++){(o=new PIXI.Graphics).lineStyle(2,16711680,1);var s=e.clustersIn[i];o.moveTo(0,0),o.lineTo(63,0),o.lineTo(63,63),o.lineTo(0,63),o.lineTo(0,0),o.endFill(),o.zIndex=9998,o.position.set(64*s.x-64,64*s.y-64),t.viewport.addChild(o),this._temp113.push(o)}for(i=0;i<e.clustersOut.length;i++){var o;(o=new PIXI.Graphics).lineStyle(2,4482815,1);s=e.clustersOut[i];o.moveTo(0,0),o.lineTo(63,0),o.lineTo(63,63),o.lineTo(0,63),o.lineTo(0,0),o.endFill(),o.zIndex=9998,o.position.set(64*s.x-64,64*s.y-64),t.viewport.addChild(o),this._temp113.push(o)}}else{if(this._temp113)for(var n in this._temp113)t.viewport.removeChild(this._temp113[n]);this._temp113=void 0}},_bodiesDrawed:new Set,drawSG2DBodyLines:function(t){if(t&&t.body&&t.body.vertices&&t.body.vertices.length&&!this._bodiesDrawed.has(t.body)){this._bodiesDrawed.add(t.body);for(var e=t.body.parts,i=t.body._sg2dLines=1===e.length?new PIXI.Graphics:new PIXI.Container,s=1===e.length?0:1;s<e.length;s++){var r=e[s],o=1===e.length?i:(o=new PIXI.Graphics,i.addChild(o),o);o.lineStyle(2,16777215,1),o.moveTo(r.vertices[0].x-r.position.x,r.vertices[0].y-r.position.y);for(var n=0;n<r.vertices.length;n++)o.lineTo(r.vertices[n].x-r.position.x,r.vertices[n].y-r.position.y);o.lineTo(r.vertices[0].x-r.position.x,r.vertices[0].y-r.position.y),o.endFill(),o.x=r.position.x-t.body.position.x,o.y=r.position.y-t.body.position.y}i.x=t.body.position.x,i.y=t.body.position.y,i.angle_init=t.body.angle,i.zIndex=9998,SG2D._instance.viewport.addChild(i)}},undrawSG2DBodyLines:function(t){t&&t.body&&this._bodiesDrawed.has(t.body)&&(SG2D._instance.viewport.removeChild(t.body._sg2dLines),this._bodiesDrawed.delete(t.body))},redrawSG2DBodiesLines:function(){for(var t of this._bodiesDrawed)t.removed?(SG2D._instance.viewport.removeChild(t._sg2dLines),SG2D._bodiesDrawed.delete(t)):t.isStatic||(t._sg2dLines.x=t.position.x,t._sg2dLines.y=t.position.y,t._sg2dLines.angle=(t.angle-t._sg2dLines.angle_init)/n.PI180)},clear:function(){this._bodiesDrawed.clear()}};class d extends s{initialize(t,e,i){if(this.constructor._prepareStaticConfigSprites(),i=i||s.OBJECT_EMPTY,this.bounds=i.own_bounds?new l(i.own_bounds):new l,this.boundsCXY=new l,this.clusters=new Set,this.centerCluster=null,this.sprite=void 0,this.sprites=void 0,this.hasAnimations=!1,!this.constructor.sprites)throw"Error 82423704! this.constructor.sprites must be filled!";if(this.sprites=s.clone(this.constructor.sprites),this.sprites.main&&(this.sprite=this.sprites.main),this.sprite){for(var r in this.sprite.texture=void 0!==this.properties.texture?this.properties.texture:this.constructor.sprites.main.texture,d._defaultSpriteValues)void 0!==t[r]&&(this.sprite[r]=t[r]);void 0!==this.properties.layer&&(this.sprite.layer=this.properties.layer)}h.objectForEach(this.sprites,t=>{t._texture=t.texture,t.animation&&(t.animation._count=t.animation.start||1,t.animation._sleep=1,t.animation.onComplete&&(t.animation.onComplete=t.animation.onComplete.bind(this)),this.hasAnimations=!0,this._animationIndex=0)}),c.tiles[this.properties.id]=this,c.tilesset.add(this),this.onGeometric(),this.drawUndraw()}setTexture(t,e=s.OBJECT_EMPTY,i=0){r.ONLY_LOGIC||this._setTileProperty("texture",t,e,i)}setPosition(t,e=s.OBJECT_EMPTY,i=0){this.set("position",t,e,i|s.FLAG_IGNORE_OWN_SETTER)&&(this.onGeometric(),this.drawUndraw())}setAngle(t,e=s.OBJECT_EMPTY,i=0){void 0!==t&&(t=n.normalize_a(t,h.ifUndefined(e.precision,1))),this._setTileProperty("angle",t,e,i)}setAnchor(t,e=s.OBJECT_EMPTY,i=0){this._setTileProperty("anchor",t,e,i)}setScale(t,e=s.OBJECT_EMPTY,i=0){this._setTileProperty("scale",t,e,i)}setAlpha(t,e=s.OBJECT_EMPTY,i=0){this._setTileProperty("alpha",t,e,i)}setVisible(t,e=s.OBJECT_EMPTY,i=0){this._setTileProperty("visible",t,e,i)}setZindex(t,e=s.OBJECT_EMPTY,i=0){this._setTileProperty("zindex",t,e,i)}_setTileProperty(t,e,i=s.OBJECT_EMPTY,r=0){if(this._spritesFromOptions(i),d._spritesFromOptions.size){let i=!1;for(var o of d._spritesFromOptions)o[t]!==e&&(o[t]=e,i=!0,this.drawUndraw(o));return i}return!!this.set(t,e,i,r|s.FLAG_IGNORE_OWN_SETTER)&&(h.objectForEach(this.sprites,i=>{i.setter_flag!==d.FLAG_ONLY_OPTIONS_SPRITE&&(i[t]=e)}),this.drawUndraw(),!0)}drawUndraw(t){if(!r.ONLY_LOGIC&&x._initialized){for(var e of(this.clusters,this.clusters))if(e.drawed){if(t)this._pixiSprite(t);else{for(var i in this.sprites)this._pixiSprite(this.sprites[i]);this.set("drawed",!0)}return!0}return this.removeSprites(),!1}}_pixiSprite(t){if(x._initialized&&!1===this.constructor.noDraw){var e=t.pixiSprite;if(t.visible){if(!e){let i=this.updateSpriteTexture(t,t.animation&&t.animation.running?this.getAnimationTexture(t):t.texture);(e=t.pixiSprite=new PIXI.Sprite(i)).tile=this,x.drawSprite(e,t.layer)}}else e&&(x.removeSprite(t.pixiSprite),delete t.pixiSprite);t.pixiSprite&&(e.position.x=~~this.properties.position.x,e.position.y=~~this.properties.position.y,"number"==typeof t.anchor?e.anchor.set(t.anchor):e.anchor.set(t.anchor.x,t.anchor.y),"number"==typeof t.scale?e.scale.set(t.scale):e.scale.set(t.scale.x,t.scale.y),e.angle=t.angle,e.zIndex=t.zindex,e.alpha=t.alpha,e.visible=t.visible)}}removeSprites(){if(this.properties.drawed){for(var t in this.sprites){var e=this.sprites[t];e.pixiSprite&&(x.removeSprite(e.pixiSprite),delete e.pixiSprite),e.animation&&(e.animation._count=1,e.animation._sleep=1,e.animation.loop||(e._texture=e.texture,e.animation.running=!1))}this.set("drawed",!1)}}startAnimation(t){let e=this._checkSpriteAnimation(t);e&&(e.animation.running=!0,e.visible=!0,e.animation._count=1,e.animation._sleep=1,this._pixiSprite(e),this.updateSpriteTexture(e,this.getAnimationTexture(e)))}breakAnimation(t){let e=this._checkSpriteAnimation(t);e&&(e.animation.running=!1,e.animation.visible=!1,e.animation._count=1,e.animation._sleep=1,this.updateSpriteTexture(e,e.texture||e._texture),this._pixiSprite(e))}stopAnimation(t,e){let i=this._checkSpriteAnimation(t);i&&(i.animation.running=!1),e&&void 0!==e.visible&&this.set("visible",e.visible,{sprite:i})}resumeAnimation(t,e){let i=this._checkSpriteAnimation(t);i&&(i.animation.running=!0),e&&void 0!==e.visible&&this.set("visible",e.visible,{sprite:i})}stepAnimation(t,e=1){let i=this._checkSpriteAnimation(t);if(i)for(var s=0;s<e;s++)this.iterateAnimations(!0,i)}_checkSpriteAnimation(t){if(this.hasAnimations){let e="object"==typeof(t=t||this.sprite)?t:this.sprites[t];if(!e)throw'Error 730002! Animation sprite "'+t+'" not found!';if(!e.animation)throw'Error 908720! Sprite "'+e.name+'" does not contain animation description!';return e}return!1}getAnimationTexture(t){return t.animation.basetexture+t.animation._count}iterateAnimations(t=!0,e){this.hasAnimations&&(this._animationIndex<t||!0===t)&&(!0!==t&&(this._animationIndex=t),e?this._iterateAnimation(e):h.objectForEach(this.sprites,this._iterateAnimation,this))}_iterateAnimation(t){var e=t.animation;e&&e.running&&(e._sleep++,e._sleep>e.sleep&&(e._sleep=1,e._count++,e._count>e.count?(e._count=1,e.loop||(t._texture=t.texture||t._texture,t.visible=!1,e.running=!1,e.onComplete&&e.onComplete(t),this._pixiSprite(t))):t._texture=this.getAnimationTexture(t),this.updateSpriteTexture(t)))}updateSpriteTexture(t,e){void 0!==e&&(t._texture=e);let i=this.checkTexture(t._texture),s=PIXI.Texture.from(i,{},r.PIXI_TEXTURE_STRICT);return t.pixiSprite&&t.pixiSprite.texture.textureCacheIds[0]!==i&&(t.pixiSprite.texture=s),s}checkTexture(t){return r.PIXI_TEXTURE_STRICT||PIXI.utils.TextureCache[t]||(-1===d._textures_not_founded.indexOf(t)&&(d._textures_not_founded.push(t),console.warn('Texture with the name "'+t+'" was not found!')),t=r.TILE_404),t}_spritesFromOptions(t=s.OBJECT_EMPTY){d._spritesFromOptions.clear(),t.sprite&&d._spritesFromOptions.add(t.sprite),t.sprites&&h.objectForEach(t.sprites,t=>d._spritesFromOptions.add(t))}onGeometric(){this.calcBoundsPX(),this.calcCXY(),this.calcClustersBody()}calcBoundsPX(){this.bounds.set(this.properties.position.x-r.CELLSIZEPIX05+.5,this.properties.position.y-r.CELLSIZEPIX05+.5,this.properties.position.x+r.CELLSIZEPIX05-.5,this.properties.position.y+r.CELLSIZEPIX05-.5)}calcCXY(){d._point.x=h.PXtoCX(this.properties.position.x),d._point.y=h.PXtoCX(this.properties.position.y),this.centerCluster=c.getClusterCXY(d._point),this.set("cxy",d._point,void 0,s.FLAG_PREV_VALUE_CLONE),this.boundsCXY.set(h.PXtoCX(this.bounds.min.x),h.PXtoCX(this.bounds.min.y),h.PXtoCX(this.bounds.max.x),h.PXtoCX(this.bounds.max.y))}calcClustersBody(){var t;for(t of this.clusters)(t.x<this.boundsCXY.min.x||t.x>this.boundsCXY.max.x||t.y<this.boundsCXY.min.y||t.y>this.boundsCXY.max.y)&&(this.clusters.delete(t),t.tiles.delete(this),this.constructor.isBody&&t.bodies.delete(this));for(var e=this.boundsCXY.min.y;e<=this.boundsCXY.max.y;e++)for(var i=this.boundsCXY.min.x;i<=this.boundsCXY.max.x;i++)(t=c.getCluster(i,e))&&(this.clusters.add(t),t.tiles.add(this),this.constructor.isBody&&t.bodies.add(this))}destroy(){for(var t of(r.ONLY_LOGIC||(this.removeSprites(),r.DRAW_BODY_LINES&&u.undrawSG2DBodyLines(this)),this.clusters))t.tiles.delete(this),t.bodies.delete(this);this.clusters.clear(),c.tiles[this.properties.id]=null,c.tilesset.delete(this),super.destroy()}}d.typeProperties={texture:s.TYPE_STRING,position:s.TYPE_OBJECT_NUMBERS,angle:s.TYPE_NUMBER,anchor:s.TYPE_NUMBER_OR_XY,scale:s.TYPE_NUMBER_OR_XY,alpha:s.TYPE_NUMBER,visible:s.TYPE_BOOLEAN,zindex:s.TYPE_NUMBER,cxy:s.TYPE_OBJECT_NUMBERS},d.layer=void 0,d.texture=r.TILE_OVERRIDE,d.angle=0,d.anchor=.5,d.scale=1,d.alpha=1,d.visible=!0,d.zindex=0,d.isTile=!0,d.isBody=!1,d.noDraw=!1,d.FLAG_ONLY_OPTIONS_SPRITE=!0,d._initPrevPosition={x:-1,y:-1},d._point={x:void 0,y:void 0},d.ownSetters={position:!0,angle:!0,anchor:!0,scale:!0,alpha:!0,visible:!0,zindex:!0,texture:!0},d.defaultProperties={id:void 0,position:{x:0,y:0},angle:0,anchor:.5,scale:1,alpha:1,visible:!0,zindex:0,layer:void 0,cxy:{x:0,y:0},drawed:!1},d._defaultSpriteValues={angle:0,anchor:.5,scale:1,alpha:1,visible:!0,zindex:0},d._prepareStaticConfigSprites=function(){this.hasOwnProperty("_spritesPrepared")||(this._spritesPrepared=!0,this.hasOwnProperty("sprites")?this.sprites=this._prepareMultipleSprites(this.sprites):this.sprites={main:this._prepareSpriteProperties({name:"main"},this)},this.sprites.main&&(this.sprite=this.sprites.main),this.sprite&&void 0!==this.animation&&(this.sprite.animation=s.clone(this.animation)),void 0!==this.zindex&&h.objectForEach(this.sprites,t=>{"main"!==t.name&&(t.zindex+=this.zindex)}))},d._prepareMultipleSprites=function(t,e){for(var i in t){const s=t[i];s.name=i,e&&(s.parent=e.name,s.setter_flag=d.FLAG_ONLY_OPTIONS_SPRITE),this._prepareSpriteProperties(s),s.sprites&&(t={...t,...this._prepareMultipleSprites(s.sprites,s)})}return t},d._prepareSpriteProperties=function(t,e){for(var i in e||(e=t),t.texture=void 0!==typeof e.texture?e.texture:r.TILE_OVERRIDE,d._defaultSpriteValues)t[i]=h.ifUndefined(e[i],d._defaultSpriteValues[i]);return t.layer=e.layer||this.layer,t},d._textures_not_founded=[],d._spritesFromOptions=new Set;class _ extends s{defaults(){return{scale:_.SCALE_NORMAL,rotation:!1,rotate:0,position:{x:0,y:0},target:{x:0,y:0},offset:{x:0,y:0},wh:{w:0,h:0},wh05:{w:0,h:0},boundsPX:{left:0,top:0,right:0,bottom:0},boundsCluster:{left:0,top:0,right:0,bottom:0},frameCVC:0,scale_wheel:!0,scale_min:_.SCALE_MIN,scale_max:_.SCALE_MAX,mouse_over_canvas:!0,movement_by_pointer:0,movement_state:0}}initialize(t){let e=t||{};e.scale_wheel=void 0===e.scale_wheel||e.scale_wheel,e.scale=+e.scale||_.SCALE_NORMAL,e.rotation=!!e.rotation||!1,e.rotate=+e.rotate||0,e.position=e.position||null,e.rotate_adjustment=+e.rotate_adjustment||_.ROTATE_ADJUSTMENT,e.movement_by_pointer=+e.movement_by_pointer,this.rotate_adjustment=e.rotate_adjustment,this.browser_scale_start=window.devicePixelRatio?window.devicePixelRatio:window.outerWidth/window.innerWidth,this.set("scale_min",+e.scale_min||_.SCALE_MIN),this.set("scale_max",+e.scale_max||_.SCALE_MAX),this.scales_k=[],this.scales_per=[];for(var i=1,s=100,o=_.SCALE_NORMAL;o<=this.properties.scale_max;o++)this.scales_k[o]=i,this.scales_per[o]=~~s,i+=.125,s+=12.5;for(i=1,s=100,o=_.SCALE_NORMAL;o>=this.properties.scale_min;o--)this.scales_k[o]=i,this.scales_per[o]=~~s,i-=.125,s-=12.5;this.positionPrev={x:this.properties.position.x,y:this.properties.position.y},this.frame_lighting=1,this.boundsClusterPrev=null,this.clustersInCamera=new Set,this.boundsPXTops={leftTop:{x:0,y:0},rightTop:{x:0,y:0},rightBottom:{x:0,y:0},leftBottom:{x:0,y:0}},this.boundsClusterTops={leftTop:{x:0,y:0},rightTop:{x:0,y:0},rightBottom:{x:0,y:0},leftBottom:{x:0,y:0}},this.clustersOut=[],this.clustersIn=[],this._addLinePoint=this._addLinePoint.bind(this),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.onWheelScale=this.onWheelScale.bind(this),this.properties.scale_wheel&&this._onwheel(this.onWheelScale),this.boundsPoint=[],this.on("wh",t=>{for(var e=~~((t.w+t.h)/r.CELLSIZEPIX*4),i=0;i<e;i++)this.boundsPoint[i]={x:0,y:0}}),this.set("scale_wheel",e.scale_wheel),this.set("scale",e.scale),this.set("rotation",e.rotation),this.on("frameCVC",u.drawDebug2),this.set("movement_by_pointer",e.movement_by_pointer),this._followToTile=null}_sg2dconnect(t){this.sg2d=t,this.onResize(),this.sg2d.pixi.view.addEventListener("mouseenter",this.onMouseEnter),this.sg2d.pixi.view.addEventListener("mouseleave",this.onMouseLeave),this.set("rotate",this.properties.rotate),this.sg2d.viewport.angle=-this.properties.rotate+this.rotate_adjustment,this.startPosition(this.properties.position||null),this._calc()}setRotate(t,e,i=0){if(!(this.properties.rotation||i&s.FLAG_FORCE_CALLBACKS))return;t=n.normalize_a(t);let r=this.properties.rotate;if(this.set("rotate",t,e,i|s.FLAG_IGNORE_OWN_SETTER)){this.sg2d.viewport.angle=-this.properties.rotate+this.rotate_adjustment;let e=n.normalize_a(t-r),i=this.properties.offset.x,s=this.properties.offset.y;return _._point.x=i*n.cos(e,1)-s*n.sin(e,1),_._point.y=s*n.cos(e,1)+i*n.sin(e,1),this.set("offset",_._point),this._calc(),!0}return!1}startPosition(t){this.moveTo(t,!0)}setPosition(t,e=s.OBJECT_EMPTY,i=0){return t=t||this.positionPrev,(e=e&&e!==s.OBJECT_EMPTY?e:s.OPTIONS_PRECISION_5).precision=e.precision||5,!!this.set("position",t,e,i|s.FLAG_IGNORE_OWN_SETTER)&&(this._calc(),!0)}_calc(){this.sg2d.viewport.x=this.sg2d.pixi.screen.width/2,this.sg2d.viewport.y=this.sg2d.pixi.screen.height/2,this.sg2d.viewport.pivot.x=this.properties.position.x,this.sg2d.viewport.pivot.y=this.properties.position.y;var t=this.properties.position.x,e=this.properties.position.y,i=n.cos(this.properties.rotate,1),s=n.sin(this.properties.rotate,1),o=this.properties.wh05.w*r.DEBUGGING.CAMERA.WIDTH_HEIGHT_K,a=this.properties.wh05.h*r.DEBUGGING.CAMERA.WIDTH_HEIGHT_K,h=this.boundsPXTops,l=this.boundsClusterTops;h.leftTop.x=Math.round(t-o*i+a*s),h.leftTop.y=Math.round(e-o*s-a*i),h.rightTop.x=Math.round(t+o*i+a*s),h.rightTop.y=Math.round(e+o*s-a*i),h.rightBottom.x=Math.round(t+o*i-a*s),h.rightBottom.y=Math.round(e+o*s+a*i),h.leftBottom.x=Math.round(t-o*i-a*s),h.leftBottom.y=Math.round(e-o*s+a*i);var p=_._boundsPX;for(var c in p.left=p.top=p.right=p.bottom=void 0,h){var d=h[c];(void 0===p.left||p.left>d.x)&&(p.left=d.x),(void 0===p.top||p.top>d.y)&&(p.top=d.y),(void 0===p.right||p.right<d.x)&&(p.right=d.x),(void 0===p.bottom||p.bottom<d.y)&&(p.bottom=d.y)}var f=!1;for(var c in this.properties.boundsPX)p[c]!==this.properties.boundsPX[c]&&(f=!0),this.properties.boundsPX[c]=p[c];var v=_._boundsCluster;v.left=Math.floor(1+p.left/r.CELLSIZEPIX),v.top=Math.floor(1+p.top/r.CELLSIZEPIX),v.right=Math.floor(1+p.right/r.CELLSIZEPIX),v.bottom=Math.floor(1+p.bottom/r.CELLSIZEPIX);var m,E,x,T,A=!1;for(var c in v)v[c]!==this.properties.boundsCluster[c]&&(A=!0),this.properties.boundsCluster[c]=v[c];this.boundsClusterPrev||(this.boundsClusterPrev={left:this.properties.boundsCluster.left,top:this.properties.boundsCluster.top,right:this.properties.boundsCluster.right,bottom:this.properties.boundsCluster.bottom}),l.leftTop.x=.5+h.leftTop.x/r.CELLSIZEPIX,l.leftTop.y=.5+h.leftTop.y/r.CELLSIZEPIX,l.rightTop.x=.5+h.rightTop.x/r.CELLSIZEPIX,l.rightTop.y=.5+h.rightTop.y/r.CELLSIZEPIX,l.rightBottom.x=.5+h.rightBottom.x/r.CELLSIZEPIX,l.rightBottom.y=.5+h.rightBottom.y/r.CELLSIZEPIX,l.leftBottom.x=.5+h.leftBottom.x/r.CELLSIZEPIX,l.leftBottom.y=.5+h.leftBottom.y/r.CELLSIZEPIX,this.boundsPoint._length=-1,n.getLinePoints(l.leftTop,l.rightTop,this._addLinePoint),n.getLinePoints(l.rightTop,l.rightBottom,this._addLinePoint),n.getLinePoints(l.rightBottom,l.leftBottom,this._addLinePoint),n.getLinePoints(l.leftBottom,l.leftTop,this._addLinePoint),this.boundsPoint._length++;var I=this.frame_lighting++,y=this.frame_lighting;this.clustersOut.length=0,this.clustersIn.length=0;for(var g=0;g<this.boundsPoint._length;g++){c=this.boundsPoint[g];(m=this.sg2d.clusters.getCluster(c.x,c.y))&&(0===m.lighting_frame&&(this.clustersIn.push(m),this.clustersInCamera.add(m)),m.lighting_frame=y)}var C=Math.min(this.boundsClusterPrev.left,this.properties.boundsCluster.left),S=Math.min(this.boundsClusterPrev.top,this.properties.boundsCluster.top),b=Math.max(this.boundsClusterPrev.right,this.properties.boundsCluster.right),P=Math.max(this.boundsClusterPrev.bottom,this.properties.boundsCluster.bottom);for(e=S;e<=P;e++){for(T=0,E=0,x=0,t=C;t<=b;t++)if(m=this.sg2d.clusters.getCluster(t,e))switch(T){case 0:switch(m.lighting_frame){case 0:break;case I:this.clustersOut.push(m),this.clustersInCamera.delete(m),m.lighting_frame=0;break;case y:T=1,x=E=t;break;default:throw"Error!"}break;case 1:switch(m.lighting_frame){case 0:case I:break;case y:x=t;break;default:throw console.log("cluster.lighting_frame="+m.lighting_frame),"Error!"}}if(E&&x){for(t=E;t<=x;t++)(m=this.sg2d.clusters.getCluster(t,e))&&(0===m.lighting_frame&&(this.clustersIn.push(m),this.clustersInCamera.add(m)),m.lighting_frame=y);for(t=x+1;t<=b;t++)(m=this.sg2d.clusters.getCluster(t,e))&&(m.lighting_frame===I&&(this.clustersOut.push(m),this.clustersInCamera.delete(m)),m.lighting_frame=0)}}if(this.clustersOut.length||this.clustersIn.length){this.set("frameCVC",this.properties.frameCVC+1);for(g=0;g<this.clustersOut.length;g++)this.clustersOut[g].outCamera();for(g=0;g<this.clustersIn.length;g++)this.clustersIn[g].inCamera()}for(var c in l)l[c].x=Math.floor(.5+l[c].x),l[c].y=Math.floor(.5+l[c].y);u.drawDebug(),this.positionPrev.x=this.properties.position.x,this.positionPrev.y=this.properties.position.y,this.boundsClusterPrev.left=this.properties.boundsCluster.left,this.boundsClusterPrev.top=this.properties.boundsCluster.top,this.boundsClusterPrev.right=this.properties.boundsCluster.right,this.boundsClusterPrev.bottom=this.properties.boundsCluster.bottom,f&&this.trigger("boundsPX"),A&&this.trigger("boundsCluster")}followTo(t){this._followToTile=t}stopFollow(){this._followToTile=null}getFollow(){return this._followToTile}moveTo(){"object"==typeof arguments[0]?(this.set("target",arguments[0],s.OPTIONS_PRECISION_5),!0===arguments[1]&&this.set("position",arguments[0],s.OPTIONS_PRECISION_5)):(_._moveToTarget.x=arguments[0],_._moveToTarget.y=arguments[1],this.set("target",_._moveToTarget,s.OPTIONS_PRECISION_5),!0===arguments[2]&&this.set("position",_._moveToTarget,s.OPTIONS_PRECISION_5))}moveOffset(t=r.CELLSIZEPIX,e=0){let i=t/this.scales_k[this.properties.scale];e=e-this.properties.rotate+this.rotate_adjustment,_._point.x=this.properties.offset.x+i*n.cos(e,1),_._point.y=this.properties.offset.y-i*n.sin(e,1),this.set("offset",_._point)}onResize(){var t=window.devicePixelRatio?window.devicePixelRatio:window.outerWidth/window.innerWidth,e=this.scales_k[this.properties.scale]*this.browser_scale_start/t;this.sg2d.viewport.scale.set(e),0===this.rotate_adjustment||180===this.rotate_adjustment||-180===this.rotate_adjustment?this.set("wh",{w:this.sg2d.pixi.screen.width/e,h:this.sg2d.pixi.screen.height/e}):this.set("wh",{w:this.sg2d.pixi.screen.height/e,h:this.sg2d.pixi.screen.width/e}),this.set("wh05",{w:this.properties.wh.w>>1,h:this.properties.wh.h>>1}),this.set("position",void 0,void 0,_.FLAG_FORCE_CALLBACKS)}_iterate(){this._followToTile&&(_._point.x=this._followToTile.properties.position.x+this.properties.offset.x,_._point.y=this._followToTile.properties.position.y+this.properties.offset.y,this.set("target",_._point)),this.properties.target.x===this.properties.position.x&&this.properties.target.y===this.properties.position.y||(_._point.x=this.properties.position.x+_.SMOOTHNESS_FACTOR*(this.properties.target.x-this.properties.position.x),_._point.y=this.properties.position.y+_.SMOOTHNESS_FACTOR*(this.properties.target.y-this.properties.position.y),this.set("position",_._point))}onMouseEnter(t){this.set("mouse_over_canvas",!0)}onMouseLeave(t){this.set("mouse_over_canvas",!1)}onWheelScale(t){if(this.properties.mouse_over_canvas){var e=t.deltaY||t.detail||t.wheelDelta;this.zoomInc(e<0?1:-1)}}zoom(t=_.SCALE_NORMAL){t=Math.max(this.properties.scale_min,t),t=Math.min(this.properties.scale_max,t),this.set("scale",t),this.onResize()}zoomInc(t=1){var e=this.properties.scale+t;e=Math.max(this.properties.scale_min,e),e=Math.min(this.properties.scale_max,e),this.set("scale",e),this.onResize()}getScale(){return{value:this.properties.scale,percent:this.scales_per[this.properties.scale],k:this.scales_k[this.properties.scale]}}_addLinePoint(t,e){var i=this.boundsPoint[++this.boundsPoint._length];i.x=t<1?1:t>r.AREASIZE?r.AREASIZE:t,i.y=e<1?1:e>r.AREASIZE?r.AREASIZE:e}_onwheel(t,e){e||(e=window),"onwheel"in document?e.addEventListener("wheel",t):"onmousewheel"in document?e.addEventListener("mousewheel",t):e.addEventListener("MozMousePixelScroll",t)}_offwheel(t,e){e||(e=window),e.removeEventListener("wheel",t),e.removeEventListener("onmousewheel",t),e.removeEventListener("mousewheel",t),e.removeEventListener("MozMousePixelScroll",t)}destroy(){this.sg2d.pixi.view.removeEventListener("mouseenter",this.onMouseEnter),this.sg2d.pixi.view.removeEventListener("mouseleave",this.onMouseLeave),this._offwheel(this.onWheelScale),super.destroy()}}_.singleInstance=!0,_.ROTATE_ADJUSTMENT=0,_.SCALE_MIN=2,_.SCALE_NORMAL=8,_.SCALE_MAX=10,_.MOVEMENT_BY_POINTER=1,_.MOVEMENT_BY_POINTER_LEFT=1,_.MOVEMENT_BY_POINTER_RIGHT=2,_.MOVEMENT_BY_POINTER_MIDDLE=4,_.STATE_NO_MOVEMENT=0,_.STATE_MOVEMENT_WAITING_SHIFT=1,_.STATE_MOVING=2,_.SMOOTHNESS_FACTOR=.25,_.typeProperties={rotate:s.TYPE_NUMBER,rotation:s.TYPE_BOOLEAN,position:s.TYPE_OBJECT_NUMBERS,target:s.TYPE_OBJECT_NUMBERS,offset:s.TYPE_OBJECT_NUMBERS,wh:s.TYPE_OBJECT_NUMBERS,wh05:s.TYPE_OBJECT_NUMBERS,boundsPX:s.TYPE_OBJECT_NUMBERS,boundsCluster:s.TYPE_OBJECT_NUMBERS},_.ownSetters={rotate:!0,position:!0},_.moveTo=function(...t){_.getInstance().moveTo.apply(_.getInstance(),...t)},_.scaling=function(t){_.getInstance().properties.scale_wheel&&_.getInstance().onWheelScale({deltaY:"-"===t.action?1:-1})},_._point={x:void 0,y:void 0},_._boundsPX={},_._boundsCluster={},_._moveToTarget={x:0,y:0};class f extends s{initialize(t,e,i){f._newPosition||(f._newPosition=new PIXI.Point),this.target=this.constructor.target,this.options=this.constructor.options,this.on("pxy",()=>{this.set("cxy",[Math.floor(1+this.properties.pxy.x/r.CELLSIZEPIX),Math.floor(1+this.properties.pxy.y/r.CELLSIZEPIX)])}),this.target.pxy=this.properties.pxy,this.target.cxy=this.properties.cxy,this.target.pxy_local={x:void 0,y:void 0}}_sg2dconnect(t){for(var e in this.sg2d=t,this.camera=this.sg2d.camera,this.properties.global=this.sg2d.pixi.renderer.plugins.interaction.mouse.global,this.sg2d.viewport.interactive=!0,this.sg2d.viewport.on("pointerdown",this.pointerdown.bind(this)),this.sg2d.viewport.on("pointerup",this.pointerup.bind(this)),this.sg2d.viewport.on("mousemove",this.pointermove.bind(this)),this.properties.cursors){var i=this.properties.cursors[e];i&&(this.sg2d.pixi.renderer.plugins.interaction.cursorStyles[e]=i)}}pointerdown(t){if(!this.sg2d.clusters)return;let e=this.target,i=this.options;if(i.button=t.data.button,i.type=t.type,e.cluster=this.sg2d.clusters.getCluster(this.properties.cxy.x,this.properties.cxy.y),e.tile=null,e.sprite=null,e.cluster)for(var s of e.cluster.bodies)h.objectForEach(s.sprites,t=>{t.pixiSprites&&(this.sg2d.pixi.renderer.plugins.interaction.mouse.getLocalPosition(t.pixiSprite,e.pxy_local),t.getLocalBounds().contains(e.pxy_local.x,e.pxy_local.y)&&(!e.sprite.pixiSprite||e.sprite.pixiSprite.zIndex>t.pixiSprite.zIndex)&&(e.sprite=t,e.tile=s))});this.camera.properties.movement_by_pointer&&this.camera.properties.movement_state===_.STATE_NO_MOVEMENT&&(0===i.button&&this.camera.properties.movement_by_pointer&_.MOVEMENT_BY_POINTER_LEFT||2===i.button&&this.camera.properties.movement_by_pointer&_.MOVEMENT_BY_POINTER_RIGHT||1===i.button&&this.camera.properties.movement_by_pointer&_.MOVEMENT_BY_POINTER_MIDDLE)&&(f._startPointMouse.x=f._newPosition.x,f._startPointMouse.y=f._newPosition.y,this.camera.set("movement_state",_.STATE_MOVEMENT_WAITING_SHIFT))}pointermove(t){if(this.camera.properties.movement_by_pointer)if(this.camera.properties.movement_state===_.STATE_MOVEMENT_WAITING_SHIFT){this.sg2d.viewport.cursor="move",n.distance_p(f._startPointMouse,f._newPosition)>=f.CAMERA_MOVEMENT_SHIFT&&(f._startPointMouse.x=this.properties.global.x,f._startPointMouse.y=this.properties.global.y,f._startPointPXY.x=this.camera.properties.offset.x,f._startPointPXY.y=this.camera.properties.offset.y,this.camera.set("movement_state",_.STATE_MOVING))}else if(this.camera.properties.movement_state===_.STATE_MOVING){let t=this.camera.scales_k[this.camera.properties.scale],e=(this.properties.global.x-f._startPointMouse.x)/t,i=(this.properties.global.y-f._startPointMouse.y)/t,r=this.camera.properties.rotate-this.camera.rotate_adjustment;f._position.x=f._startPointPXY.x-e*n.cos(r,1)+i*n.sin(r,1),f._position.y=f._startPointPXY.y-i*n.cos(r,1)-e*n.sin(r,1),this.camera.set("offset",f._position,s.OPTIONS_PRECISION_5)}}pointerup(t){if(!this.sg2d.clusters)return;let e=this.target,i=this.options;if(e.tile&&(e.tile.constructor.click&&e.tile.constructor.click(e,i),e.tile.click&&e.tile.click(e,i)),this.camera.properties.movement_by_pointer&&this.camera.properties.movement_state){this.sg2d.viewport.cursor="default";let t=this.camera.scales_k[this.camera.properties.scale];this.properties.global.x,f._startPointMouse.x,this.properties.global.y,f._startPointMouse.y;this.camera.set("movement_state",_.STATE_NO_MOVEMENT)}this.pointerclick(e,i)}pointerclick(t){}iterate(){this.sg2d.pixi.renderer.plugins.interaction.mouse.getLocalPosition(this.sg2d.viewport,f._newPosition),f._newPosition.x=~~f._newPosition.x,f._newPosition.y=~~f._newPosition.y,this.set("pxy",[f._newPosition.x,f._newPosition.y])}}f.typeProperties={global:s.TYPE_OBJECT_NUMBERS,camera:s.TYPE_OBJECT_NUMBERS,pxy:s.TYPE_OBJECT_NUMBERS,cxy:s.TYPE_OBJECT_NUMBERS},f.POINTER_LEFT=0,f.POINTER_MIDDLE=1,f.POINTER_RIGHT=2,f.CAMERA_MOVEMENT_SHIFT=10,f._newPosition=void 0,f.target={cluster:void 0,tile:void 0,sprite:void 0,pxy:void 0,cxy:void 0},f.options={type:void 0,button:void 0},f.defaultProperties={global:void 0,pxy:{x:0,y:0},cxy:{x:0,y:0},cursors:{default:"",hover:"",move:""}},f._position={x:0,y:0},f._startPointMouse={x:0,y:0},f._startPointPXY={x:0,y:0};class v{constructor(){this.effects=new Set}_sg2dconnect(t){this.sg2d=t,this.sg2d.camera.on("scale",this._onCameraScale.bind(this),void 0,void 0,!0),this.sg2d.camera.on("rotate",this._onCameraRotate.bind(this),void 0,void 0,!0)}_onCameraScale(t,e){for(var i of this.effects)switch(i.type){case v.TYPE_SHADOWS:i.filter.distance*=t/e;break;case v.TYPE_BEVELS:i.filter.thickness*=t/e;break;case v.TYPE_DISPLACEMENT:i.options.scale/=t/e,i.sprite.scale.set(i.options.scale)}}_onCameraRotate(t){for(var e of this.effects)switch(e.type){case v.TYPE_SHADOWS:case v.TYPE_BEVELS:e.filter.rotation=e.options.rotation-t}}addShadowsToLayer(t){var e=this.sg2d.layers[t.layer].container;e.filters=e.filters||[];var i=h.ifUndefined(t.rotation,135),s={type:v.TYPE_SHADOWS,layer:t.layer,filter:new PIXI.filters.DropShadowFilter({rotation:i-this.sg2d.camera.properties.rotate,distance:h.ifUndefined(t.distance,8),alpha:h.ifUndefined(t.alpha,.6)}),options:{rotation:i}};return e.filters.push(s.filter),this.effects.add(s),s}addBevelsToLayer(t){var e=this.sg2d.layers[t.layer].container;e.filters=e.filters||[];var i=h.ifUndefined(t.rotation,135),s={type:v.TYPE_BEVELS,layer:t.layer,filter:new PIXI.filters.BevelFilter({rotation:i-this.sg2d.camera.properties.rotate,thickness:h.ifUndefined(t.thickness,2),lightAlpha:h.ifUndefined(t.lightAlpha,.8),shadowAlpha:h.ifUndefined(t.shadowAlpha,.8)}),options:{rotation:i}};return s.filter.padding=1,e.filters.push(s.filter),this.effects.add(s),s}addDisplacementToLayer(t){var e=this.sg2d.layers[t.layer].container;e.filters=e.filters||[];var i={type:v.TYPE_DISPLACEMENT,layer:t.layer,options:{texture:t.texture||r.TILE_OVERRIDE,scale:t.scale||1}};return"function"==typeof t.iterate&&(i.iterate=t.iterate.bind(i),i.options.animationStep=t.animationStep||1),i.sprite=PIXI.Sprite.from(i.options.texture),i.sprite.scale.set(i.options.scale),i.sprite.texture.baseTexture.wrapMode=PIXI.WRAP_MODES.REPEAT,e.addChild(i.sprite),i.filter=new PIXI.filters.DisplacementFilter(i.sprite),e.filters.push(i.filter),this.effects.add(i),i}}v.TYPE_SHADOWS=1,v.TYPE_BEVELS=2,v.TYPE_DISPLACEMENT=3;class m{}m.files={},m.classes={},m.instances={},m.load=function(t){t="object"==typeof t?Array.isArray(t)?t.reduce((t,e)=>(t[e]={},t),{}):t:{};let e=[];for(let i in t)if(!this.files[i]){let t=new Promise((t,e)=>{this.files[i]=import("./plugins/"+i+".js").then(i=>{let s=this.classes[i.default.name]=i.default;this.instances[i.default.code]=new s;if(!s.ready)throw'The plugin class "'+s.name+"\" must have a static ready() method! Maybe you didn't inherit the class from SG2D.PluginBase or you didn't call super() in the constructor!";s.ready(t,e)})});e.push(t)}return Promise.all(e)};class E{static ready(t,e){return this._ready||(this._ready=new Promise((t,e)=>{this.success=t,this.failed=e})),(t||e)&&this._ready.then(t||(()=>{}),e||(()=>{})),this._ready}constructor(){if(this.constructor._instance)throw"Error! A plugin class can only have one instance!";this.constructor._instance=this,this.constructor.ready()}}class x{constructor(t){if(x._instance)throw"SG2DApplication Error! There is an instance of the class! You must execute .destroy() on the previous instance!";if(x._instance=this,x._initialized?Promise.resolve():x._initialize(),!t)throw"SG2DApplication Error! config is empty!";+t.cellsizepix&&x.setCellSizePix(t.cellsizepix);let e=t.pixi=t.pixi||{};this.canvas=e.view=e.view||document.getElementById(t.canvasId)||document.querySelector("CANVAS"),e.width=void 0!==e.width?e.width:100,e.height=void 0!==e.height?e.height:100,e.backgroundColor=void 0!==e.backgroundColor?e.backgroundColor:0,e.resizeTo=void 0!==e.resizeTo?e.resizeTo:this.canvas.parentElement;let i=void 0===e.autoStart||e.autoStart;e.autoStart=!1,x.drawSprite=x._drawSprite.bind(this),x.removeSprite=x._removeSprite.bind(this),this.iterate=this.iterate.bind(this),this.iterate_out=t.iterate||function(){},this.resize_out=t.resize||function(){},this.canvas.oncontextmenu=function(){return!1},this.canvas.onselectstart=function(){return!1},this.pixi=new PIXI.Application(e),this.frame_index=0,this.layers_enabled=t.layers_enabled=void 0===t.layers_enabled||t.layers_enabled,t.layers||(t.layers={main:{}});var s=!1;if("number"==typeof t.layers){s=!0;for(var r=[],o=0;o<t.layers;o++)r[o]={};t.layers=r}var n=!1;for(var a in t.layers){if(s&&(a=+a),(p=t.layers[a]).position===x.LAYER_POSITION_FIXED){n=!0;break}}n?(this.viewport=new PIXI.Container,this.pixi.stage.addChild(this.viewport)):this.viewport=this.pixi.stage,this.viewport.sortableChildren=!0,this.layers={};var l=0;for(var a in t.layers){s&&(a=+a);var p=t.layers[a],u=this.layers[a]={position:p.position||x.LAYER_POSITION_ABSOLUTE,zindex:p.zindex||++l,sortableChildren:void 0===p.sortableChildren||p.sortableChildren},d=u.container="main"===a?this.viewport:t.layers_enabled||u.position===x.LAYER_POSITION_FIXED?new PIXI.Container:this.viewport;(t.layers_enabled||u.position===x.LAYER_POSITION_FIXED)&&(d.sortableChildren=u.sortableChildren,d.zIndex=u.zindex),"main"!==a&&(u.position===x.LAYER_POSITION_FIXED?this.pixi.stage.addChild(d):t.layers_enabled&&this.viewport.addChild(d))}this.pixi.ticker.add(this.iterate),this.clusters=t.clusters instanceof c?t.clusters:new c(t.clusters),this.camera=t.camera instanceof _?t.camera:new _(t.camera),this.camera._sg2dconnect&&this.camera._sg2dconnect(this),this.mouse=t.mouse instanceof f?t.mouse:new f(t.mouse),this.mouse._sg2dconnect&&this.mouse._sg2dconnect(this),this.resize=h.debounce(this.resize,100).bind(this),addEventListener("resize",this.resize),x._pluginsPromise=m.load(t.plugins),this.effects=t.effects instanceof v?t.effects:new v(t.effects),this.effects._sg2dconnect&&this.effects._sg2dconnect(this),this.state=x.STATE_IDLE,i&&this.run()}run(){Promise.all([x._initializationPromise,x._pluginsPromise]).then(()=>{this.initClustersInCamera(),this.pixi.start(),this.state=x.STATE_RUN},t=>{throw"Error 50713888! Message: "+t})}initClustersInCamera(){this.clusters.each(t=>{t.drawed&&(t.inCamera(!0))})}iterate(t){if(this.state===x.STATE_RUN){var e=h.getTime();for(var i of(this.frame_index++,this.camera._iterate(),r.DRAW_BODY_LINES&&u.redrawSG2DBodiesLines(),this.mouse.iterate(),this.camera.clustersInCamera))for(var s of i.tiles)s.iterateAnimations&&s.iterateAnimations(this.frame_index);for(var o of this.effects.effects)o.iterate&&o.iterate();this.iterate_out();t=h.getTime();this.tUsed0=t-e,this.tRequestAnimationFrame=this.tPrevious?t-this.tPrevious:1,this.tPrevious=t}}pause(){this.pixi.stop(),this.state=x.STATE_PAUSE}destroy(){this.state=x.STATE_DESTROY,removeEventListener("resize",this.resize),this.mouse.destroy(),this.mouse=null,this.camera.destroy(),this.camera=null,this.clusters.destroy(),this.clusters=null,u.clear();for(var t=0;t<this.viewport.children.length;t++)this.viewport.removeChild(this.viewport.children[t]);this.pixi.render(),this.pixi.stop(),setTimeout(()=>{this.pixi.destroy(void 0,{children:!0}),this.pixi=null},500),x.drawSprite=null,x.removeSprite=null,x.spritesCount=0,x._instance=null}resize(){this.camera.onResize(),this.resize_out()}}x._initializationPromise=h._loadSystemTextures(),x._instance=null,x.getInstance=function(t){if(this._instance)return this._instance;if(!t)throw"Error! SG2DApplication._instance is empty!";return null},x.STATE_IDLE=0,x.STATE_RUN=1,x.STATE_PAUSE=2,x.STATE_DESTROY=1<<31,x.plugins=null,x._pluginsPromise=null,x._initialized=!1,x._initialize=function(){x.plugins=m,E.SGModel=s,E.SG2DConsts=r,E.SG2DUtils=h,E.SG2DClusters=c,E.SG2DTile=d,E.SG2DCamera=_,PIXI.utils.skipHello(),this._initializationPromise.then(()=>{x._initialized=!0})},x.LAYER_POSITION_ABSOLUTE=0,x.LAYER_POSITION_FIXED=1,x.spritesCount=0,x._drawSprite=function(t,e){void 0!==e&&x._instance.layers[e]?x._instance.layers[e].container.addChild(t):x._instance.viewport.addChild(t),x.spritesCount++,r.DRAW_BODY_LINES&&u.drawSG2DBodyLines(t.tile)},x._removeSprite=function(t){!t||t.parent,t.parent.removeChild(t),x.spritesCount--,r.DRAW_BODY_LINES&&u.undrawSG2DBodyLines(t.tile)},x.setCellSizePix=function(t){r.CELLSIZEPIX=+t,r.CELLSIZEPIX05=+t>>1,r.CELLSIZELOG2=Math.ceil(Math.log2(r.CELLSIZEPIX))};class T{static addFont(t){var e=T[t.name]={};e.symbols={},e.schema=t.schema;var i=t.texture.match(/(.+)_(\d+)x(\d+)(\w)?(\.\w+)?$/);if(i){e.base_name=i[1],e.w=+i[2],e.h=+i[3];for(var s=0;s<t.schema.length;s++)e.symbols[t.schema[s]]=PIXI.Texture.from(e.base_name+"_"+(1+s))}}}class A{constructor(t,e,i){e=e||A._options,this.sprite=new PIXI.Sprite("string"==typeof t?PIXI.Texture.from(t):t),this.sprite.x=e.x||0,this.sprite.y=e.y||0,e.scale=e.scale||{},"number"==typeof e.scale&&(e.scale={x:e.scale,y:e.scale}),this.sprite.scale.x=void 0===e.scale.x?1:e.scale.x,this.sprite.scale.y=void 0===e.scale.y?1:e.scale.y,e.anchor=e.anchor||{},"number"==typeof e.anchor&&(e.anchor={x:e.anchor||0,y:e.anchor||0}),this.sprite.anchor.set(e.anchor.x,e.anchor.y),this.sprite.angle=void 0===e.angle?0:e.angle,this.sprite.alpha=void 0===e.alpha?1:e.alpha,this.sprite.visible=void 0===e.visible||e.visible,this.sprite.interactive=!!e.interactive,this.sprite.buttonMode=!!e.buttonMode,e.pointerdown&&this.sprite.on("pointerdown",e.pointerdown),e.pointerup&&this.sprite.on("pointerup",e.pointerup),e.pointerupoutside&&this.sprite.on("pointerupoutside",e.pointerupoutside),e.pointerover&&this.sprite.on("pointerover",e.pointerover),e.pointerout&&this.sprite.on("pointerout",e.pointerout),(e.layer?x.getInstance().layers[e.layer].container:x.getInstance().viewport).addChild(this.sprite),"object"==typeof i&&Object.assign(this,i),this.sprite.sg2dSprite=this}}A._options={};var I={Model:s,Consts:r,Math:n,Utils:h,Application:x,Clusters:c,Camera:_,Tile:d,Mouse:f,Effects:v,Plugins:m,PluginBase:E,Debugging:u,Bounds:l,Cluster:p,Fonts:T,Label:class{constructor(t,e){this.options=e||{},e.x=e.x||0,e.y=e.y||0,e.scale=e.scale||1,this.setText(t)}setText(t){this.container?this.container.removeChildren():this.container=new PIXI.Container;var e=T[this.options.font];if(!e)return console.warn('Error: font "'+this.options.font+'" not founded!'),!1;this.container.x=this.options.x,this.container.y=this.options.y;var i=0;t=""+t;for(var s=0;s<t.length;s++){var r=t[s],o=e.symbols[r];if(o){var n=new PIXI.Sprite(o);n.position.x=this.options.x+i,n.position.y=this.options.y,n.scale.set(this.options.scale),this.options.tint&&(n.tint=this.options.tint),this.container.addChild(n)}else" "!==r&&console.warn('Error! The symbol "'+r+'" is missing in the font "'+this.options.font+'"!');i+=e.w*this.options.scale}var a=this.options.sg2d||x.getInstance();(this.options.layer?a.layers[this.options.layer].container:a.viewport).addChild(this.container)}},LabelCanvas:class{constructor(t,e){this.options=e||{},this.canvas=h.createCanvas(1,1,h.FLAG_CANVAS_ELEMENT),e.parent&&e.parent.append(this.canvas),this.setText(t)}setText(t){var e=T[this.options.font];if(!e)return console.warn('Error: font "'+this.options.font+'" not founded!'),!1;var i=0;t=""+t,this.canvas.width=e.w*t.length,this.canvas.height=e.h;for(var s=0;s<t.length;s++){var r=t[s],o=e.symbols[r];o?h.drawTextureToCanvas(o,this.canvas,{x:i,y:0}):" "!==r&&console.warn('Error! The symbol "'+r+'" is missing in the font "'+this.options.font+'"!'),i+=e.w}}},Sprite:A,version:"1.0.0"};"object"==typeof window&&(window.SG2D=I),"object"==typeof self&&(self.SG2D=I),"object"==typeof global&&(global.SG2D=I),"object"==typeof _root&&(_root.SG2D=I);e.default=I}]).default}));