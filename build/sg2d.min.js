/*!
 * SG2D 1.0.0 by @ Kalashnikov Ilya
 * https://sg2d.ru
 * License MIT
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("SG2D",[],e):"object"==typeof exports?exports.SG2D=e():t.SG2D=e()}(this,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return s}));class s{defaults(){return s.clone(this.constructor.defaultProperties)}constructor(t={},e,i){if(this.constructor.singleInstance){if(this.constructor._instance)throw"Error! this.constructor._instance not is empty!";this.constructor._instance=this}let r=this.defaults();if(this.constructor.localStorageKey){let t=void 0,e=localStorage.getItem(this.constructor.localStorageKey+(this.constructor.singleInstance?"":"_"+props.id));e&&(t=JSON.parse(e)),t&&s.initObjectByObject(r,t)}for(var o in"object"!=typeof t&&(t={}),t){var n=t[o];switch(this.constructor.typeProperties[o]){case s.TYPE_ANY:case s.TYPE_ARRAY:break;case s.TYPE_NUMBER:t[o]=void 0===n?void 0:+n;break;case s.TYPE_NUMBER_OR_XY:"object"==typeof n?(n.x=void 0===n.x?void 0:+n.x,n.y=void 0===n.y?void 0:+n.y):t[o]=void 0===n?void 0:+n;break;case s.TYPE_ARRAY_NUMBERS:for(var a=0;a<n.length;a++)n[a]=+n[a];break;case s.TYPE_OBJECT_NUMBERS:if(Array.isArray(n)){if(!(l=r[o]))throw'No default value was set for an object named "'+o+'" ('+this.constructor.name+")! An object structure is required to fill in the data!";var h=0;for(var a in l)l[a]=+n[h],h++;t[o]=l}else{if("object"!=typeof n)throw'Error! Property "'+o+'" ('+this.constructor.name+") must be an object or an array!";for(var a in n)n[a]=+n[a]}break;case s.TYPE_STRING:t[o]=""+n;break;case s.TYPE_BOOLEAN:t[o]=!!n;break;case s.TYPE_OBJECT:if(Array.isArray(n)){var l;if(!(l=r[o]))throw'No default value was set for an object named "'+o+'" ('+this.constructor.name+")! An object structure is required to fill in the data!";h=0;for(var a in l)l[a]=n[h],h++;t[o]=l}else if("object"!=typeof n)throw'Error! Property "'+o+'" ('+this.constructor.name+") must be an object or an array!";break;default:throw'Error! Unknown type specified for property "'+o+'" ('+this.constructor.name+")!"}}if(this.properties=s.defaults({},r,t),this.properties.id||(this.properties.id=s.uid()),e?Object.assign(this,e):e=s.OBJECT_EMPTY,this.destroyed=!1,this.onChangeCallbacks={},!this.constructor.hasOwnProperty("_ownSettersInitialized"))for(var o in this.constructor._ownSettersInitialized=!0,this.constructor.ownSetters)!0===this.constructor.ownSetters[o]&&(this.constructor.ownSetters[o]=this["set"+s.upperFirstLetter(o)]);this.changed=!1,this.initialize.call(this,t,e,i)}initialize(){}set(t,e,i,r=0){if("object"!=typeof i&&void 0!==i)throw'Error 7610932! "options" type is not a object or undefined! Property: '+t+", constructor: "+this.constructor.name;if("number"!=typeof r)throw'Error 7892354! "flags" type is not a number!';if(i=i||s.OBJECT_EMPTY,!(r&s.FLAG_IGNORE_OWN_SETTER)&&this.constructor.ownSetters[t])return this.constructor.ownSetters[t].call(this,e,i,r);var o=this.constructor.typeProperties[t];if(o)switch(o){case s.TYPE_ANY:break;case s.TYPE_NUMBER:void 0!==e&&(e=i.precision?s.roundTo(e,i.precision):+e);break;case s.TYPE_NUMBER_OR_XY:return this._setNumberOrXY.apply(this,arguments);case s.TYPE_ARRAY:case s.TYPE_ARRAY_NUMBERS:return this._setArray.apply(this,arguments);case s.TYPE_OBJECT:case s.TYPE_OBJECT_NUMBERS:return this._setObject.apply(this,arguments);case s.TYPE_STRING:e=""+e;break;case s.TYPE_BOOLEAN:e=!!e}var n=this.properties[t];if(n===e){if(!(r&s.FLAG_FORCE_CALLBACKS))return!1}else this.properties[t]=e,this.changed=!0;if(!(r&s.FLAG_NO_CALLBACKS)){s._prevValue=void 0!==i.previous_value?i.previous_value:r&s.FLAG_PREV_VALUE_CLONE?s.clone(n):n;var a=this.onChangeCallbacks[t];if(a){r&s.FLAG_OFF_MAY_BE&&(a=s.clone(a));var h=void 0;for(var l in a){var p=a[l];void 0!==(h=p.d?p.f.call(p.c?p.c:this,p.d,e,s._prevValue):p.f.call(p.c?p.c:this,e,s._prevValue))&&(n=h)}}}return!0}_setArray(t,e,i,r=0){if(i=i||s.OBJECT_EMPTY,!(r&s.FLAG_IGNORE_OWN_SETTER)&&this.constructor.ownSetters[t])return this.constructor.ownSetters[t].call(this,e,i,r);var o=this.constructor.typeProperties[t],n=this.properties[t];if(s._prevValue=i.previous_value||void 0,s._bChanged=!1,Array.isArray(e))for(var a=0;a<e.length;a++){var h=e[a];o===s.TYPE_ARRAY_NUMBERS&&(h=i.precision?s.roundTo(h,i.precision):+h),n[a]!==h&&(s._bChanged=!0,r&s.FLAG_PREV_VALUE_CLONE&&!s._prevValue&&(s._prevValue=s.clone(n)),n[a]=h)}else{if(e)throw"aValues should be must Array or empty! ("+this.constructor.name+")";for(h=o===s.TYPE_OBJECT_NUMBERS?0:void 0,a=0;a<n.length;a++)n[a]!==h&&(s._bChanged=!0,r&s.FLAG_PREV_VALUE_CLONE&&!s._prevValue&&(s._prevValue=s.clone(n)),n[a]=h)}return s._bChanged&&(this.changed=!0),!!(s._bChanged||r&s.FLAG_FORCE_CALLBACKS)&&(this._runCallbacks(t,n,r),!0)}_setObject(t,e,i,r=0){if(i=i||s.OBJECT_EMPTY,!(r&s.FLAG_IGNORE_OWN_SETTER)&&this.constructor.ownSetters[t])return this.constructor.ownSetters[t].call(this,e,i,r);var o=this.constructor.typeProperties[t],n=this.properties[t];if(s._prevValue=i.previous_value||void 0,s._bChanged=!1,Array.isArray(e))for(var a in s._index=0,n){var h=e[s._index];o===s.TYPE_OBJECT_NUMBERS&&(h=i.precision?s.roundTo(h,i.precision):+h),n[a]!==h&&(s._bChanged=!0,r&s.FLAG_PREV_VALUE_CLONE&&!s._prevValue&&(s._prevValue=s.clone(n)),n[a]=h),s._index++}else if(e)for(var a in e){h=e[a];o===s.TYPE_OBJECT_NUMBERS&&(h=i.precision?s.roundTo(h,i.precision):+h),n[a]!==h&&(s._bChanged=!0,r&s.FLAG_PREV_VALUE_CLONE&&!s._prevValue&&(s._prevValue=s.clone(n)),n[a]=h)}else{h=o===s.TYPE_OBJECT_NUMBERS?0:void 0;for(var a in n)n[a]!==h&&(s._bChanged=!0,r&s.FLAG_PREV_VALUE_CLONE&&!s._prevValue&&(s._prevValue=s.clone(n)),n[a]=h)}return s._bChanged&&(this.changed=!0),!!(s._bChanged||r&s.FLAG_FORCE_CALLBACKS)&&(this._runCallbacks(t,n,r),!0)}_setNumberOrXY(t,e,i,r=0){if(i=i||s.OBJECT_EMPTY,!(r&s.FLAG_IGNORE_OWN_SETTER)&&this.constructor.ownSetters[t])return this.constructor.ownSetters[t].call(this,e,i,r);let o=this.properties[t];return s._prevValue=i.previous_value||void 0,s._bChanged=!1,void 0!==e?"object"==typeof e?(e.x=i.precision?s.roundTo(e.x,i.precision):+e.x,e.y=i.precision?s.roundTo(e.y,i.precision):+e.y,"object"==typeof o?o.x===e.x&&o.y===e.y||(s._bChanged=!0,r&s.FLAG_PREV_VALUE_CLONE&&!s._prevValue&&(s._prevValue=s.clone(o)),o.x=e.x,o.y=e.y):o===e.x&&o===e.y||(s._bChanged=!0,s._prevValue=o,this.properties[t]=e)):(e=i.precision?s.roundTo(e,i.precision):+e,"object"==typeof o?o.x===e&&o.y===e||(s._bChanged=!0,r&s.FLAG_PREV_VALUE_CLONE&&!s._prevValue&&(s._prevValue=s.clone(o)),this.properties[t]=e):o!==e&&(s._bChanged=!0,s._prevValue=o,this.properties[t]=e)):o!==e&&(s._bChanged=!0,r&s.FLAG_PREV_VALUE_CLONE&&!s._prevValue&&(s._prevValue=s.clone(o)),this.properties[t]=void 0),!!s._bChanged&&(this.changed=!0,(s._bChanged||r&s.FLAG_FORCE_CALLBACKS)&&this._runCallbacks(t,e,r),!0)}_runCallbacks(t,e,i=0){if(!(i&s.FLAG_NO_CALLBACKS)){var r=this.onChangeCallbacks[t];if(r){i&s.FLAG_OFF_MAY_BE&&(r=s.clone(r));var o=void 0;for(var n in r){var a=r[n];void 0!==(o=a.d?a.f.call(a.c?a.c:this,a.d,e,s._prevValue):a.f.call(a.c?a.c:this,e,s._prevValue))&&(e=o)}}}}get(t){return this.properties[t]}on(t,e,i,r,o=0){var n=this.onChangeCallbacks[t];n||(n=this.onChangeCallbacks[t]=[]),n.push({f:e,c:i,d:r}),o===s.FLAG_IMMEDIATELY&&(r?e.call(i||this,r,this.properties[t],this.properties[t]):e.call(i||this,this.properties[t],this.properties[t]))}off(t,e){if(t){var i=this.onChangeCallbacks[t];if(i)if(e)for(var s=0;s<i.length;s++)i[s].f===e&&(i.splice(s,1),s--);else i.length=0}else for(var r in this.onChangeCallbacks)this.onChangeCallbacks[r].length=0}trigger(t,e=0){var i=this.onChangeCallbacks[t];if(i)for(var r in e&s.FLAG_OFF_MAY_BE&&(i=s.clone(i)),i)i[r].f.call(i[r].c?i[r].c:this,i[r].d?i[r].d:this.properties[t])}save(){if(!this.constructor.localStorageKey)throw"Error 37722990!";let t;this.constructor.singleInstance&&(t=this.properties.id,delete this.properties.id);let e={};for(var i in this.properties)"_"!==i[0]&&(e[i]=this.properties[i]);localStorage.setItem(this.constructor.localStorageKey+(this.constructor.singleInstance?"":"_"+t),JSON.stringify(e)),this.constructor.singleInstance&&(this.properties.id=t)}destroy(){this.destroyed=!0,this.constructor._instance=null,this.off()}}s.typeProperties={},s.defaultsProperties={},s.TYPE_ANY=void 0,s.TYPE_NUMBER=1,s.TYPE_STRING=2,s.TYPE_BOOLEAN=3,s.TYPE_OBJECT=4,s.TYPE_ARRAY=5,s.TYPE_ARRAY_NUMBERS=6,s.TYPE_OBJECT_NUMBERS=7,s.TYPE_NUMBER_OR_XY=8,s.FLAG_IMMEDIATELY=!0,s.OBJECT_EMPTY=Object.preventExtensions({}),s.FLAG_OFF_MAY_BE=1,s.FLAG_PREV_VALUE_CLONE=2,s.FLAG_NO_CALLBACKS=4,s.FLAG_FORCE_CALLBACKS=8,s.FLAG_IGNORE_OWN_SETTER=16,s.OPTIONS_PRECISION_2=Object.preventExtensions({precision:2}),s.OPTIONS_PRECISION_3=Object.preventExtensions({precision:3}),s.OPTIONS_PRECISION_4=Object.preventExtensions({precision:4}),s.OPTIONS_PRECISION_5=Object.preventExtensions({precision:5}),s.ownSetters={},s._uid=0,s.uid=function(){return++s._uid},s.defaults=function(t,...e){for(var i=e.length;i--;){var r=e[i];for(var o in r)void 0===t[o]&&(t[o]="object"==typeof r[o]?s.clone(r[o]):r[o])}return t},s.clone=function(t){let e;if(Array.isArray(t)){e=[];for(var i=0;i<t.length;i++)e[i]="object"==typeof t[i]?s.clone(t[i]):t[i]}else if("object"==typeof t)for(var r in e={},t)e[r]="object"==typeof t[r]?s.clone(t[r]):t[r];else e=t;return e},s.initObjectByObject=function(t,e){if(Array.isArray(t))for(var i=0;i<t.length;i++)e.hasOwnProperty(i)&&("object"==typeof t[i]?this.initObjectByObject(t[i],e[i]):t[i]=e[i]);else if("object"==typeof t)for(var s in t)e.hasOwnProperty(s)&&("object"==typeof t[s]?this.initObjectByObject(t[s],e[s]):t[s]=e[s]);else t=e;return t},s.upperFirstLetter=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},s.roundTo=function(t,e=0){let i=10**e;return Math.round(t*i)/i},s._instance=null,s.singleInstance=!1,s.getInstance=function(t=!1){if(this._instance)return this._instance;if(!t)throw"Error! this._instance is empty!";return null},s.get=function(...t){return this._instance&&this._instance.get(...t)},s.set=function(...t){return this._instance&&this._instance.set(...t)},s.on=function(...t){return this._instance&&this._instance.on(...t)},s.off=function(...t){return this._instance&&this._instance.off(...t)},s.localStorageKey="",s._bChanged=!1,s._index=0,s._prevValue=void 0,s._xy={x:0,y:0},"object"==typeof exports&&"object"==typeof t?t.exports=s:"function"==typeof define&&i(2)?define("SG2D",[],()=>s):"object"==typeof exports?exports.SGModel=s:"object"==typeof window&&window.document?window.SGModel=s:(void 0).SGModel=s}).call(this,i(1)(t))},function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}},function(t,e){(function(e){t.exports=e}).call(this,{})},function(t,e,i){"use strict";i.r(e);var s=i(0);var r=function(){let t,e,i,s=[],r=[];return{isCompleted:()=>"resolved"===t,resolve:i=>{t="resolved",e=i,s.forEach(t=>t(i)),s.length=0},reject:e=>{t="rejected",i=e,r.forEach(t=>t(e)),r.length=0},then:i=>{"resolved"===t?i(e):s.unshift(i)},catch:e=>{"rejected"===t?e(i):r.unshift(e)}}};var o={CELLSIZEPIX:32,CELLSIZEPIX05:16,CELLSIZELOG2:5,AREASIZE:128,AREASIZELOG2:Math.ceil(Math.log2(128)),AREASQUARE:16384,DRAW_BODY_LINES:!1,ONLY_LOGIC:!1,CAMERA:{WIDTH_HEIGHT_K:1.01,DEBUGGING:{SHOW:{GRID:!1,BOUNDS_PXY:!1,BOUNDS_TOP_CLUSTERS:!1,CLUSTER_LINE_BOUNDS:!1,AXIS_LABELS:!1,CLUSTERS_IN_OUT:!1}}},SYSTEM_TILES:[{name:"sg2d/override",url:"data:image/png;base64,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"},{name:"sg2d/404",url:"data:image/png;base64,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"}],TILE_OVERRIDE:"sg2d/override",TILE_404:"sg2d/404",PIXI_TEXTURE_STRICT:!1};let n={};var a=n;!function(){let t=0;n.uid=function(){return++t},n.addFlag=(t,e)=>t|e,n.removeFlag=(t,e)=>t&~e,n.setFlag=(t,e,i=!0)=>i?n.addFlag(t,e):n.removeFlag(t,e),n.hasFlag=(t,e)=>t&e,n.noFlag=(t,e)=>!(t&e);let e=[];for(var i=0;i<=10;i++)e[i]=10**i;n.roundTo=function(t,i){var s=e[i];return Math.round(t*s)/s},n.absDelta=function(t,e){return Math.abs(t-e)},n.PI180=Math.PI/180,n.PI2=2*Math.PI,n.rad90=90*n.PI180,n.toRad=function(t){return t*this.PI180},n.toDeg=function(t){return t/this.PI180},n.normalize_a=function(t,e=0){for(;t>=360;)t-=360;for(;t<0;)t+=360;return this.roundTo(t,e)};let s=[],r=[];for(var o=0;o<=360;o++)s[o]=Math.sin(o*n.PI180),r[o]=Math.cos(o*n.PI180);let a=[],h=[];for(o=0;o<=3600;o++){var l=o/10;a[o]=Math.sin(l*n.PI180),h[o]=Math.cos(l*n.PI180)}n.sin=function(t,e=0){return 0===e?s[this.normalize_a(t,e)]:a[Math.round(10*this.normalize_a(t,1))]},n.cos=function(t,e=0){return 0===e?r[this.normalize_a(t,e)]:h[Math.round(10*this.normalize_a(t,1))]},n.sinrad=function(){return arguments[0]=arguments[0]/this.PI180,this.sin.apply(this,arguments)},n.cosrad=function(){return arguments[0]=arguments[0]/this.PI180,this.cos.apply(this,arguments)},n.angle_p1p2_deg=function(t,e,i=0){var s=Math.atan2(e.y-t.y,e.x-t.x);return this.normalize_a(s/this.PI180,i)},n.distance_d=function(t,e){return Math.sqrt(t*t+e*e)},n.distance_p=function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},n.betweenAnglesDeg=function(t,e){var i=e-t,s=e-360-t,r=e-(t-360);return Math.abs(i)<Math.abs(s)?Math.abs(r)<Math.abs(i)?r:i:Math.abs(r)<Math.abs(s)?r:s},n.nearestDirRotate=function(t,e){var i=this.normalize_a(e-t),s=this.normalize_a(t-e);return i===s?0:i>s?-1:1},n.vectors45=[{dx:1,dy:0},{dx:1,dy:1},{dx:0,dy:1},{dx:-1,dy:1},{dx:-1,dy:0},{dx:-1,dy:-1},{dx:0,dy:-1},{dx:1,dy:-1}],n.vectors90=[{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0},{dx:0,dy:-1}];let p=[];n._addLinePoint=function(t,e){this.push({x:t,y:e})},n.getLinePoints=function(t,e,i){var s=this._addLinePoint;"function"==typeof i?s=i:Array.isArray(i)?s=s.bind(i):(p.length=0,s=s.bind(p)),s(Math.round(t.x),Math.round(t.y));for(var r=t.x,o=t.y,n=e.x,a=e.y,h=n-r,l=a-o,c=Math.sqrt(h*h+l*l),d=h/c,u=l/c,f=r,_=o,v=Math.round(r),m=Math.round(o),E=v,y=m;;){f+=d,_+=u;var x=Math.round(f),g=Math.round(_);if(x!==E||g!==y){if(n>r&&f>n||n<r&&f<n)break;if(a>o&&_>a||a<o&&_<a)break;if(x!=E&&g!=y){var I=x,T=y,A=E,C=g;Math.sqrt(Math.pow(I-f,2)+Math.pow(T-_,2))+Math.sqrt(Math.pow(I-v,2)+Math.pow(T-m,2))>Math.sqrt(Math.pow(A-f,2)+Math.pow(C-_,2))+Math.sqrt(Math.pow(A-v,2)+Math.pow(C-m,2))?(s(A,C),E=A,y=C):(s(I,T),E=I,y=T)}s(x,g),v=f,m=_,E=x,y=g}}return p};let c={x:void 0,y:void 0};n.avgVertext=function(t,e){if(!t.length)throw"Error 773734";e=e||c,c.x=t[0].x,c.y=t[0].y;for(var i=1;i<t.length;i++)c.x+=t[i].x,c.y+=t[i].y;return c.x=c.x/t.length,c.y=c.y/t.length,c}}();var h={DEFAULT_WIDTH:32,DEFAULT_HEIGHT:32,FLAG_ADD_BORDER_ALPHA:1,getTime:function(){if("undefined"!=typeof process&&process.hrtime)var t=process.hrtime(),e=t[0]+"."+("00"+Math.round(t[1]/1e6)).substr(-3,3);else if("undefined"!=typeof performance&&performance.now)e=(performance.now()/1e3).toFixed(3);else{e=((new Date).getTime()/1e3).toFixed(3)}return+e},loadJS:function(t,e){return new Promise((i,s)=>{var r=document.createElement("script");r.onload=t=>{e&&e(t),i()},r.onerror=s,r.src=t,document.head.append(r)})},getTextureAsCanvas:function(t){var e="object"==typeof t?t:PIXI.Texture.from(t);if(e.canvas)return e.canvas;var i=this.createCanvas(e.frame.width,e.frame.height);return i.getContext("2d").drawImage(e.baseTexture.resource.source,e.frame.x,e.frame.y,e.frame.width,e.frame.height,0,0,e.frame.width,e.frame.height),i.texture=e.textureCacheIds[0]||"error",e.canvas=i,i},getTextureAsBlob:async function(t){if("string"==typeof t&&!PIXI.utils.TextureCache[t])return console.error('Texture "'+t+'" does not exist!'),!1;var e="object"==typeof t?t:PIXI.Texture.from(t);if(e.blob)return e.blob;var i=this.createCanvas(e.frame.width,e.frame.height);return i.getContext("2d").drawImage(e.baseTexture.resource.source,e.frame.x,e.frame.y,e.frame.width,e.frame.height,0,0,e.frame.width,e.frame.height),i.convertToBlob?e.blob=await i.convertToBlob({type:"image/png"}):e.blob=await new Promise(t=>i.toBlob(e=>t(e))),e.blob},getTextureUrl:async function(t,e){if(!t)return null;var i=await h.getTextureAsBlob(t);if(!i)return!1;if(i.url=i.url||URL.createObjectURL(i),!e)return i.url;var s=window.open("","_blank");s.document.write("<html><head><script>window.location = '"+i.url+"';<\/script></head></html>"),s.document.close()},_options:{x:void 0,y:void 0},drawTextureToCanvas:function(t,e,i){i=i||this._options;var s=e.getContext("2d");e=this.getTextureAsCanvas(t);s.drawImage(e,void 0===i.x?0:i.x,void 0===i.y?0:i.y)},addMask:function(t){for(var e=t.width||h.DEFAULT_WIDTH,i=t.height||h.DEFAULT_HEIGHT,s=this.createCanvas(e,i),r=s.getContext("2d"),o=r.getImageData(0,0,e,i),n=e>>1,l=e*i*4,p=0;p<l;p+=4){var c=p>>2,d=Math.floor(c/i)-n,u=c-(d+n)*e-n,f=a.distance_d(u+.5,d+.5),_=t.iterate(u,d,f,c);o.data[p]=_.r,o.data[p+1]=_.g,o.data[p+2]=_.b,o.data[p+3]=_.a}r.putImageData(o,0,0),s._pixiId=t.name;var v=PIXI.Texture.from(s);return v.canvas=s,v._isFinalTexture=!0,s},_optionsBAT:{},setBorderAlphaTextures:function(t={}){t.textures=t.textures||[],t.textures.length||this._getFinalTextures(t.textures);for(var e=0;e<t.textures.length;e++){var i="object"==typeof t.textures[e]?t.textures[e]:PIXI.utils.TextureCache[t.textures[e]];i?(this._optionsBAT.texture=i,this._optionsBAT.alpha=t.alpha,this._optionsBAT.alpha2=t.alpha2,this.setBorderAlphaTexture(this._optionsBAT)):console.warn('Texture with name "'+t.textures[e]+'" not found!')}},setBorderAlphaTexture:function(t={}){void 0===t.alpha&&(t.alpha=.995),void 0===t.alpha2&&(t.alpha2=1),t.alpha=~~(256*t.alpha),t.alpha2=~~(256*t.alpha2);let e="object"==typeof t.texture?t.texture:PIXI.utils.TextureCache(t.texture),i=this.getTextureAsCanvas(e);for(var s=i.getContext("2d"),r=s.getImageData(0,0,i.width,i.height),o=i.width*i.height*4,n=0;n<o;n+=4){var a=n>>2,h=Math.floor(a/i.width),l=a-h*i.width;0!==l&&0!==h&&l!==i.width-1&&h!==i.height-1||(r.data[n+3]=Math.min(r.data[n+3],t.alpha)),t.alpha2<255&&(1===l||1===h||l===i.width-2||h===i.height-2)&&(r.data[n+3]=Math.min(r.data[n+3],t.alpha2))}s.putImageData(r,0,0),PIXI.Texture.removeFromCache(i.texture),PIXI.BaseTexture.removeFromCache(i.texture),i._pixiId=i.texture;var p=PIXI.Texture.from(i);p.canvas=i,p._isFinalTexture=e._isFinalTexture,p._qBorderAlpha=e._qBorderAlpha},addBorderAlphaTextures:function(t){t.textures=t.textures||[],t.qborder=t.qborder||1,t.textures.length||this._getFinalTextures(t.textures);for(var e=0;e<t.textures.length;e++){var i="object"==typeof t.textures[e]?t.textures[e]:PIXI.utils.TextureCache[t.textures[e]];if(i){if(t.qborder>this.ifUndefined(i._qBorderAlpha,0)){var s=h.getTextureAsCanvas(i),r=h.createCanvas(i.width+2,i.height+2);r.getContext("2d").drawImage(s,1,1),r._pixiId=i.textureCacheIds[0]||i.canvas._pixiId,PIXI.Texture.removeFromCache(r._pixiId),PIXI.BaseTexture.removeFromCache(r._pixiId);var o=PIXI.Texture.from(r);o.canvas=r,o._isFinalTexture=i._isFinalTexture,o._qBorderAlpha=i._qBorderAlpha?i._qBorderAlpha+1:1}}else console.warn('Texture with name "'+t.textures[e]+'" not found!')}},_getFinalTextures:function(t){for(var e in PIXI.utils.TextureCache){var i=PIXI.utils.TextureCache[e];i._isFinalTexture&&t.push(i)}},_ibt:[],createInBetweenTextures:function(t){if(!t.start)throw"Error 7020181!";if(!t.end)throw"Error 7020182!";if(t.count=Math.max(2,t.count||2),!t.name)throw"Error 7020184!";if(t.flags=t.flags||0,t.count<=2)return;let e=this.getTextureAsCanvas(t.start),i=this.getTextureAsCanvas(t.end),s=e.width,r=e.height,o=s*r;for(var n=0;n<o;n++)this._ibt[n]=!1;let a=e.getContext("2d").getImageData(0,0,s,r).data,h=i.getContext("2d").getImageData(0,0,s,r).data,l=t.count-1,p=Math.ceil(o/l),c=null,d=[];for(var u=2;u<t.count;u++){for(var f=(u-1)/(t.count-1),_=t.count-u+1,v=new ImageData(Uint8ClampedArray.from(c||a),s,r),m=v.data,E=0;E<p;E++)for(var y=Math.floor(Math.random()*_),x=E*l,g=x;g<x+l;g++)if(!this._ibt[g]){if(0===y){this._ibt[g]=!0;for(var I=g<<2,T=a[I]+a[I+1]+a[I+2],A=(h[I]+h[I+1]+h[I+2]-T)*f/3/256,C=0;C<3;C++){m[S=I+C]=h[S],m[S]=A<0?~~(m[S]*(1+A)):~~(m[S]+(256-m[S])*A)}var S,b=(h[S=I+3]-a[S])*f/256;m[S]=h[S],b&&(m[S]=b<0?~~(m[S]*(1+b)):~~(m[S]+(256-m[S])*b));break}y--}var w=this.createCanvas(s,r);w.getContext("2d").putImageData(v,0,0),w._pixiId=t.name.replace("%",u),(L=PIXI.Texture.from(w)).canvas=w,L._isFinalTexture=!0,d.push(L),c=m}t.flags&this.FLAG_ADD_BORDER_ALPHA&&this.addBorderAlphaTextures({textures:d});var P=t.name.replace("%",1);PIXI.utils.TextureCache[P]||(e._pixiId=P,(L=PIXI.Texture.from(e))._isFinalTexture=!0);var L,O=t.name.replace("%",t.count);PIXI.utils.TextureCache[O]||(i._pixiId=O,(L=PIXI.Texture.from(i))._isFinalTexture=!0)},parseTexturePack:function(t){for(var e in t)if("_image"!==e.substr(-6,6)){var i=t[e];for(var s in i.textures){var r=i.textures[s],o=s.match(/(.+)_(\d+)x(\d+)(\w)?(\.\w+)?$/);if(o){r._isFinalTexture=!1;var n=o[1],a=+o[2],h=+o[3],l=o[4]||"h",p=Math.floor(r.width/a),c=Math.floor(r.height/h);if("h"!==l)throw"dir vertical no supported! (TODO)";for(var d=0,u=0;u<c;u++)for(var f=0;f<p;f++){var _=n+"_"+ ++d;if(PIXI.utils.TextureCache[_])console.error('Texture "'+_+'" already exists!');else{var v=f*a,m=u*h,E=new PIXI.Rectangle(0,0,0,0);E.width=a,E.height=h,E.x=r.frame.x+v,E.y=r.frame.y+m;var y=new PIXI.Texture(r,E);PIXI.Texture.addToCache(y,_),y._isFinalTexture=!0}}PIXI.Texture.removeFromCache(r),PIXI.BaseTexture.removeFromCache(r)}else r._isFinalTexture=!0}}},_loadSystemTextures:function(){return new Promise((t,e)=>{if("undefined"==typeof PIXI)t("PIXI is undefined! Perhaps we are working in server mode!");else{(new PIXI.Loader).add(o.SYSTEM_TILES).load((e,i)=>{for(var s=0;s<o.SYSTEM_TILES.length;s++)PIXI.Texture.removeFromCache(o.SYSTEM_TILES[s].url),PIXI.BaseTexture.removeFromCache(o.SYSTEM_TILES[s].url),PIXI.utils.TextureCache[o.SYSTEM_TILES[s].name]._isFinalTexture=!0;t()})}})},FLAG_CANVAS_OFFSCREEN:0,FLAG_CANVAS_ELEMENT:1,createCanvas:function(t,e,i=0){if(i===this.FLAG_CANVAS_ELEMENT||"undefined"==typeof OffscreenCanvas){var s=document.createElement("CANVAS");return s.width=t||h.DEFAULT_WIDTH,s.height=e||h.DEFAULT_HEIGHT,s}return new OffscreenCanvas(t||h.DEFAULT_WIDTH,e||h.DEFAULT_HEIGHT)},drawCircle:function(t,e,i,s){var r=new PIXI.Graphics;r.beginFill(s||16720418),r.drawCircle(t||0,e||0,i||3),r.endFill(),r.zIndex=99999,SG2D.Application.drawSprite(r)},PXtoCX:function(t){return 1+(t>>o.CELLSIZELOG2)},debounce:function(t,e){let i;return function(){const s=this,r=arguments;clearTimeout(i),i=setTimeout(()=>t.apply(s,r),e)}},throttle:function(t,e,i){let s,r;return function(){const o=i||this,n=arguments;r?(clearTimeout(s),s=setTimeout((function(){Date.now()-r>=e&&(t.apply(o,n),r=Date.now())}),e-(Date.now()-r))):(t.apply(o,n),r=Date.now())}},_p:void 0,isEmpty:function(t){for(this._p in t)return!1;return!0},objectForEach:function(t,e,i=this){for(var s in t)if(!1===e.call(i,t[s]))break},propertiesCount:function(t){let e=0;for(var i in t)e++;return e},ifUndefined:function(t,e){return void 0===t?e:t}},l=h;class p{constructor(){1==arguments.length?this.setBounds(arguments[0]):4==arguments.length?this.set.apply(this,arguments):this.set(0,0,0,0)}set(){1===arguments.length?this.setBounds(arguments[0]):(this.min={x:Math.min(arguments[0],arguments[2]),y:Math.min(arguments[1],arguments[3])},this.max={x:Math.max(arguments[0],arguments[2]),y:Math.max(arguments[1],arguments[3])})}setBounds(t){this.min={x:t.min.x,y:t.min.y},this.max={x:t.max.x,y:t.max.y}}dx(t){return void 0!==t&&(this.max.x=this.min.x+t),this.max.x-this.min.x}dy(t){return void 0!==t&&(this.max.y=this.min.y+t),this.max.y-this.min.y}}class c{constructor(t){this.i=t.i,this.x=t.x,this.y=t.y,this.position={x:t.x*o.CELLSIZEPIX-o.CELLSIZEPIX05,y:t.y*o.CELLSIZEPIX-o.CELLSIZEPIX05},this.tiles=new Set,this.bodies=new Set,this.lighting_frame=0}inCamera(){for(var t of(this.drawed=!0,this.tiles))t.drawUndraw()}outCamera(){for(var t of(this.drawed=!1,this.tiles)){for(var e of t.clusters)if(e.drawed)return;t.removeSprites()}}getLayerTiles(t,e=null){if(e){for(var i of(e.length=0,this.tiles))(void 0===i.properties.layer&&i.constructor.layer===t||i.properties.layer===t)&&e.push(i);return e}for(var i of(c._tiles.length=0,this.tiles))(void 0===i.properties.layer&&i.constructor.layer===t||i.properties.layer===t)&&c._tiles.push(i);return c._tiles}tileInCluster(t){if("function"==typeof t){for(var e of this.tiles)if(e.constructor===t)return e}else for(var e of this.tiles)if(e.properties.texture===t)return e;return!1}}c._tiles=[];class d{constructor(t,e=c){if(d._instance)throw"SG2DClusters Error! There is an instance of the class! You must execute .destroy() on the previous instance!";if(d._instance=this,void 0!==(t=t||{}).areasize&&(o.AREASIZE=t.areasize,o.AREASQUARE=t.areasize*t.areasize,o.AREASIZELOG2=Math.ceil(Math.log2(t.areasize))),-1===d.permissible_sizes.indexOf(o.AREASIZE))throw"Side of map size cannot differ from "+d.permissible_sizes.join(",")+"! Now SG2DConsts.AREASIZE="+o.AREASIZE;var i,s;this.areasize=this.width=this.height=o.AREASIZE,this.areasizepix=this.areasize*o.CELLSIZEPIX,this.clusters=[],this.tiles=d.tiles,this.tilesset=d.tilesset,this.bodies=d.bodies,this.clear();for(var r=0;r<o.AREASQUARE;r++)[i,s]=this.getXYbyIndex(r),this.clusters[r]=new e({x:i,y:s,i:r})}getXYbyIndex(t){return c._y=t>>o.AREASIZELOG2,[t-(c._y<<o.AREASIZELOG2)+1,1+c._y]}getClusterByIndex(t){return c._y=t>>o.AREASIZELOG2,c._x=t-(c._y<<o.AREASIZELOG2),this.getCluster0(c._x,c._y)}getCluster0(t,e){return!this.outArea0(t,e)&&this.clusters[(e<<o.AREASIZELOG2)+t]}getCluster(t,e){return!this.outArea(t,e)&&this.clusters[(e-1<<o.AREASIZELOG2)+(t-1)]}getClusterCXY(t){return!this.outArea(t.x,t.y)&&this.clusters[(t.y-1<<o.AREASIZELOG2)+(t.x-1)]}outArea0(t,e){return t<0||t>=this.width||e<0||e>=this.height}outArea(t,e){return t<1||t>this.width||e<1||e>this.height}inArea0(t,e){return!this.outArea0(t,e)}inArea(t,e){return!this.outArea(t,e)}each(t){for(var e=0;e<o.AREASQUARE;e++)t(this.clusters[e])}nearestClusters90(t,e){for(var i,s=0;s<4;s++)if((i=this.getCluster(t.x+a.vectors90[s].dx,t.y+a.vectors90[s].dy))&&!0===e(i,Math.round(90*s)))return!0;return!1}nearestClusters45(t,e){for(var i,s=0;s<8;s++)if((i=this.getCluster(t.x+a.vectors45[s].dx,t.y+a.vectors45[s].dy))&&!0===e(i,Math.round(45*s)))return!0;return!1}clear(){d.tiles.length=0,d.tilesset.clear(),d.bodies.clear()}destroy(){this.clear(),d._instance=null}}d.permissible_sizes=[8,16,32,64,128,256,512,1024],d._x=0,d._y=0,d._instance=null,d.getInstance=function(){if(this._instance)return this._instance;throw"Error! SG2DClusters._instance is empty!"},d.tiles=[],d.tilesset=new Set,d.bodies=new Set,d.each=function(t){return d.getInstance().each(t)},d.getCluster=function(t,e){return d.getInstance().getCluster(t,e)},d.getClusterCXY=function(t){return d.getInstance().getClusterCXY(t)},d.inArea=function(t,e){return d.getInstance().inArea(t,e)},d.outArea=function(t,e){return d.getInstance().outArea(t,e)},d.nearestClusters90=function(t,e){return d.getInstance().nearestClusters90(t,e)},d.nearestClusters45=function(t,e){return d.getInstance().nearestClusters45(t,e)};var u={drawDebug:function(){let t=T.getInstance(),e=t.clusters,i=t.camera;if(o.CAMERA.DEBUGGING.SHOW.GRID){if(!this._temp116){this._temp116=[];for(var s=0;s<=e.width;s++){(n=new PIXI.Graphics).lineStyle(2,16777215).moveTo(s*o.CELLSIZEPIX,0).lineTo(s*o.CELLSIZEPIX,e.height*o.CELLSIZEPIX),n.zIndex=9999,this._temp116.push(n),t.viewport.addChild(n)}for(var r=0;r<=e.height;r++){var n;(n=new PIXI.Graphics).lineStyle(2,16777215).moveTo(0,r*o.CELLSIZEPIX).lineTo(e.width*o.CELLSIZEPIX,r*o.CELLSIZEPIX),n.zIndex=9999,this._temp116.push(n),t.viewport.addChild(n)}}}else{if(this._temp116)for(var a in this._temp116)t.viewport.removeChild(this._temp116[a]);this._temp116=void 0}if(o.CAMERA.DEBUGGING.SHOW.BOUNDS_PXY){this._temp110&&t.viewport.removeChild(this._temp110);var h=this._temp110=new PIXI.Graphics,l=i.boundsPXTops;h.moveTo(l.leftTop.x,l.leftTop.y),h.lineStyle(3,16776960,1),h.lineTo(l.rightTop.x,l.rightTop.y),h.lineStyle(3,16711680,1),h.lineTo(l.rightBottom.x,l.rightBottom.y),h.lineStyle(3,65280,1),h.lineTo(l.leftBottom.x,l.leftBottom.y),h.lineStyle(3,255,1),h.lineTo(l.leftTop.x,l.leftTop.y),h.endFill(),h.zIndex=9999,t.viewport.addChild(h)}else this._temp110&&(t.viewport.removeChild(this._temp110),this._temp110=void 0);if(o.CAMERA.DEBUGGING.SHOW.BOUNDS_TOP_CLUSTERS){this._temp111||(this._temp111={});var p=0,c=[16711680,65280,255,11141290];for(var a in i.boundsClusterTops){var d=i.boundsClusterTops[a];if(!this._temp111[a])(h=this._temp111[a]=new PIXI.Graphics).lineStyle(3,c[p++],1),h.moveTo(0,0),h.lineTo(63,0),h.lineTo(63,63),h.lineTo(0,63),h.lineTo(0,0),h.endFill(),h.zIndex=9999,t.viewport.addChild(h);this._temp111[a].position.set(64*d.x-64,64*d.y-64)}}else{if(this._temp111)for(var a in this._temp111)t.viewport.removeChild(this._temp111[a]);this._temp111=void 0}if(o.CAMERA.DEBUGGING.SHOW.CLUSTER_LINE_BOUNDS){this._temp112||(this._temp112=[]);for(p=0;p<this._temp112.length;p++)t.viewport.removeChild(this._temp112[p]);this._temp112.length=0;for(p=0;p<i.boundsPoint._length;p++){(h=this._temp112[p]=new PIXI.Graphics).lineStyle(2,16777215,2);d=i.boundsPoint[p];h.moveTo(0,0),h.lineTo(63,0),h.lineTo(63,63),h.lineTo(0,63),h.lineTo(0,0),h.endFill(),h.zIndex=9998,h.position.set(64*d.x-64,64*d.y-64),t.viewport.addChild(h)}}else{if(this._temp112)for(var a in this._temp112)t.viewport.removeChild(this._temp112[a]);this._temp112=void 0}if(o.CAMERA.DEBUGGING.SHOW.AXIS_LABELS)if(this._temp115){var u=i.properties.rotate-i.rotate_adjustment;for(p=0;p<this._temp115.length;p++)this._temp115[p].angle=u}else{this._temp115=[];for(s=1;s<=e.width;s++){if(f=e.getCluster(s,1))(_=new PIXI.Text(s,{fontFamily:"Arial",fontSize:12,fill:16777215,align:"center"})).position.x=f.position.x,_.position.y=f.position.y-o.CELLSIZEPIX,_.angle=-i.rotate_adjustment,_.zIndex=9999,this._temp115.push(_),t.viewport.addChild(_)}for(r=1;r<=e.height;r++){var f,_;if(f=e.getCluster(1,r))(_=new PIXI.Text(r,{fontFamily:"Arial",fontSize:12,fill:16777215,align:"center"})).position.x=f.position.x-o.CELLSIZEPIX,_.position.y=f.position.y,_.angle=-i.rotate_adjustment,_.zIndex=9999,this._temp115.push(_),t.viewport.addChild(_)}}else{if(this._temp115)for(var a in this._temp115)t.viewport.removeChild(this._temp115[a]);this._temp115=void 0}},drawDebug2:function(){let t=T.getInstance(),e=t.camera;if(o.CAMERA.DEBUGGING.SHOW.CLUSTERS_IN_OUT){this._temp113||(this._temp113=[]);for(var i=0;i<this._temp113.length;i++)t.viewport.removeChild(this._temp113[i]);this._temp113.length=0;for(i=0;i<e.clustersIn.length;i++){(r=new PIXI.Graphics).lineStyle(2,16711680,1);var s=e.clustersIn[i];r.moveTo(0,0),r.lineTo(63,0),r.lineTo(63,63),r.lineTo(0,63),r.lineTo(0,0),r.endFill(),r.zIndex=9998,r.position.set(64*s.x-64,64*s.y-64),t.viewport.addChild(r),this._temp113.push(r)}for(i=0;i<e.clustersOut.length;i++){var r;(r=new PIXI.Graphics).lineStyle(2,4482815,1);s=e.clustersOut[i];r.moveTo(0,0),r.lineTo(63,0),r.lineTo(63,63),r.lineTo(0,63),r.lineTo(0,0),r.endFill(),r.zIndex=9998,r.position.set(64*s.x-64,64*s.y-64),t.viewport.addChild(r),this._temp113.push(r)}}else{if(this._temp113)for(var n in this._temp113)t.viewport.removeChild(this._temp113[n]);this._temp113=void 0}},_bodiesDrawed:new Set,drawSG2DBodyLines:function(t){if(t&&t.body&&t.body.vertices&&t.body.vertices.length&&!this._bodiesDrawed.has(t.body)){this._bodiesDrawed.add(t.body);for(var e=t.body.parts,i=t.body._sg2dLines=1===e.length?new PIXI.Graphics:new PIXI.Container,s=1===e.length?0:1;s<e.length;s++){var r=e[s],o=1===e.length?i:(o=new PIXI.Graphics,i.addChild(o),o);o.lineStyle(2,16777215,1),o.moveTo(r.vertices[0].x-r.position.x,r.vertices[0].y-r.position.y);for(var n=0;n<r.vertices.length;n++)o.lineTo(r.vertices[n].x-r.position.x,r.vertices[n].y-r.position.y);o.lineTo(r.vertices[0].x-r.position.x,r.vertices[0].y-r.position.y),o.endFill(),o.x=r.position.x-t.body.position.x,o.y=r.position.y-t.body.position.y}i.x=t.body.position.x,i.y=t.body.position.y,i.angle_init=t.body.angle,i.zIndex=9998,T.getInstance().viewport.addChild(i)}},undrawSG2DBodyLines:function(t){if(t&&t.body&&this._bodiesDrawed.has(t.body)){T.getInstance().viewport.removeChild(t.body._sg2dLines),this._bodiesDrawed.delete(t.body)}},redrawSG2DBodiesLines:function(){for(var t of this._bodiesDrawed)if(t.removed){T.getInstance().viewport.removeChild(t._sg2dLines),this._bodiesDrawed.delete(t)}else t.isStatic||(t._sg2dLines.x=t.position.x,t._sg2dLines.y=t.position.y,t._sg2dLines.angle=(t.angle-t._sg2dLines.angle_init)/a.PI180)},clear:function(){this._bodiesDrawed.clear()}};class f extends s.a{defaults(){return{scale:f.SCALE_NORMAL,rotation:!1,rotate:0,position:{x:0,y:0},target:{x:0,y:0},offset:{x:0,y:0},wh:{w:0,h:0},wh05:{w:0,h:0},boundsPX:{left:0,top:0,right:0,bottom:0},boundsCluster:{left:0,top:0,right:0,bottom:0},frameCVC:0,scale_wheel:!0,scale_min:f.SCALE_MIN,scale_max:f.SCALE_MAX,pointer_over_canvas:!0,movement_by_pointer:0,movement_state:0}}initialize(t){let e=t||{};e.scale_wheel=void 0===e.scale_wheel||e.scale_wheel,e.scale=+e.scale||f.SCALE_NORMAL,e.rotation=!!e.rotation||!1,e.rotate=+e.rotate||0,e.position=e.position||null,e.rotate_adjustment=+e.rotate_adjustment||f.ROTATE_ADJUSTMENT,e.movement_by_pointer=+e.movement_by_pointer,this.rotate_adjustment=e.rotate_adjustment,this.browser_scale_start=window.devicePixelRatio?window.devicePixelRatio:window.outerWidth/window.innerWidth,this.set("scale_min",+e.scale_min||f.SCALE_MIN),this.set("scale_max",+e.scale_max||f.SCALE_MAX),this.scales_k=[],this.scales_per=[];for(var i=1,s=100,r=f.SCALE_NORMAL;r<=this.properties.scale_max;r++)this.scales_k[r]=i,this.scales_per[r]=~~s,i+=.125,s+=12.5;for(i=1,s=100,r=f.SCALE_NORMAL;r>=this.properties.scale_min;r--)this.scales_k[r]=i,this.scales_per[r]=~~s,i-=.125,s-=12.5;this.positionPrev={x:this.properties.position.x,y:this.properties.position.y},this.frame_lighting=1,this.boundsClusterPrev=null,this.clustersInCamera=new Set,this.boundsPXTops={leftTop:{x:0,y:0},rightTop:{x:0,y:0},rightBottom:{x:0,y:0},leftBottom:{x:0,y:0}},this.boundsClusterTops={leftTop:{x:0,y:0},rightTop:{x:0,y:0},rightBottom:{x:0,y:0},leftBottom:{x:0,y:0}},this.clustersOut=[],this.clustersIn=[],this._addLinePoint=this._addLinePoint.bind(this),this.onPointerEnter=this.onPointerEnter.bind(this),this.onPointerLeave=this.onPointerLeave.bind(this),this.onWheelScale=this.onWheelScale.bind(this),this.properties.scale_wheel&&this._onwheel(this.onWheelScale),this.boundsPoint=[],this.on("wh",t=>{for(var e=~~((t.w+t.h)/o.CELLSIZEPIX*4),i=0;i<e;i++)this.boundsPoint[i]={x:0,y:0}}),this.set("scale_wheel",e.scale_wheel),this.set("scale",e.scale),this.set("rotation",e.rotation),this.on("frameCVC",u.drawDebug2),this.set("movement_by_pointer",e.movement_by_pointer),this._followToTile=null}_sg2dconnect(t){this.sg2d=t,this.onResize(),this.sg2d.pixi.view.addEventListener("pointerenter",this.onPointerEnter),this.sg2d.pixi.view.addEventListener("pointerleave",this.onPointerLeave),this.set("rotate",this.properties.rotate),this.sg2d.viewport.angle=-this.properties.rotate+this.rotate_adjustment,this.startPosition(this.properties.position||null),this._calc()}setRotate(t,e,i=0){if(!(this.properties.rotation||i&s.a.FLAG_FORCE_CALLBACKS))return;t=a.normalize_a(t,1);let r=this.properties.rotate;if(this.set("rotate",t,e,i|s.a.FLAG_IGNORE_OWN_SETTER)){this.sg2d.viewport.angle=-this.properties.rotate+this.rotate_adjustment;let e=a.normalize_a(t-r),i=this.properties.offset.x,s=this.properties.offset.y;return f._point.x=i*a.cos(e,1)-s*a.sin(e,1),f._point.y=s*a.cos(e,1)+i*a.sin(e,1),this.set("offset",f._point),this._calc(),!0}return!1}startPosition(t){this.moveTo(t,!0)}setPosition(t,e=s.a.OBJECT_EMPTY,i=0){return t=t||this.positionPrev,(e=e&&e!==s.a.OBJECT_EMPTY?e:s.a.OPTIONS_PRECISION_5).precision=e.precision||5,!!this.set("position",t,e,i|s.a.FLAG_IGNORE_OWN_SETTER)&&(this._calc(),!0)}_calc(){this.sg2d.viewport.x=(this.sg2d.pixi.screen.width||100)/2,this.sg2d.viewport.y=(this.sg2d.pixi.screen.height||100)/2,this.sg2d.viewport.pivot.x=this.properties.position.x,this.sg2d.viewport.pivot.y=this.properties.position.y;var t=this.properties.position.x,e=this.properties.position.y,i=a.cos(this.properties.rotate,1),s=a.sin(this.properties.rotate,1),r=this.properties.wh05.w*o.CAMERA.WIDTH_HEIGHT_K,n=this.properties.wh05.h*o.CAMERA.WIDTH_HEIGHT_K,h=this.boundsPXTops,l=this.boundsClusterTops;h.leftTop.x=Math.round(t-r*i+n*s),h.leftTop.y=Math.round(e-r*s-n*i),h.rightTop.x=Math.round(t+r*i+n*s),h.rightTop.y=Math.round(e+r*s-n*i),h.rightBottom.x=Math.round(t+r*i-n*s),h.rightBottom.y=Math.round(e+r*s+n*i),h.leftBottom.x=Math.round(t-r*i-n*s),h.leftBottom.y=Math.round(e-r*s+n*i);var p=f._boundsPX;for(var c in p.left=p.top=p.right=p.bottom=void 0,h){var d=h[c];(void 0===p.left||p.left>d.x)&&(p.left=d.x),(void 0===p.top||p.top>d.y)&&(p.top=d.y),(void 0===p.right||p.right<d.x)&&(p.right=d.x),(void 0===p.bottom||p.bottom<d.y)&&(p.bottom=d.y)}var _=!1;for(var c in this.properties.boundsPX)p[c]!==this.properties.boundsPX[c]&&(_=!0),this.properties.boundsPX[c]=p[c];var v=f._boundsCluster;v.left=Math.floor(1+p.left/o.CELLSIZEPIX),v.top=Math.floor(1+p.top/o.CELLSIZEPIX),v.right=Math.floor(1+p.right/o.CELLSIZEPIX),v.bottom=Math.floor(1+p.bottom/o.CELLSIZEPIX);var m,E,y,x,g=!1;for(var c in v)v[c]!==this.properties.boundsCluster[c]&&(g=!0),this.properties.boundsCluster[c]=v[c];this.boundsClusterPrev||(this.boundsClusterPrev={left:this.properties.boundsCluster.left,top:this.properties.boundsCluster.top,right:this.properties.boundsCluster.right,bottom:this.properties.boundsCluster.bottom}),l.leftTop.x=.5+h.leftTop.x/o.CELLSIZEPIX,l.leftTop.y=.5+h.leftTop.y/o.CELLSIZEPIX,l.rightTop.x=.5+h.rightTop.x/o.CELLSIZEPIX,l.rightTop.y=.5+h.rightTop.y/o.CELLSIZEPIX,l.rightBottom.x=.5+h.rightBottom.x/o.CELLSIZEPIX,l.rightBottom.y=.5+h.rightBottom.y/o.CELLSIZEPIX,l.leftBottom.x=.5+h.leftBottom.x/o.CELLSIZEPIX,l.leftBottom.y=.5+h.leftBottom.y/o.CELLSIZEPIX,this.boundsPoint._length=-1,a.getLinePoints(l.leftTop,l.rightTop,this._addLinePoint),a.getLinePoints(l.rightTop,l.rightBottom,this._addLinePoint),a.getLinePoints(l.rightBottom,l.leftBottom,this._addLinePoint),a.getLinePoints(l.leftBottom,l.leftTop,this._addLinePoint),this.boundsPoint._length++;var I=this.frame_lighting++,T=this.frame_lighting;this.clustersOut.length=0,this.clustersIn.length=0;for(var A=0;A<this.boundsPoint._length;A++){c=this.boundsPoint[A];(m=this.sg2d.clusters.getCluster(c.x,c.y))&&(0===m.lighting_frame&&(this.clustersIn.push(m),this.clustersInCamera.add(m)),m.lighting_frame=T)}var C=Math.min(this.boundsClusterPrev.left,this.properties.boundsCluster.left),S=Math.min(this.boundsClusterPrev.top,this.properties.boundsCluster.top),b=Math.max(this.boundsClusterPrev.right,this.properties.boundsCluster.right),w=Math.max(this.boundsClusterPrev.bottom,this.properties.boundsCluster.bottom);for(e=S;e<=w;e++){for(x=0,E=0,y=0,t=C;t<=b;t++)if(m=this.sg2d.clusters.getCluster(t,e))switch(x){case 0:switch(m.lighting_frame){case 0:break;case I:this.clustersOut.push(m),this.clustersInCamera.delete(m),m.lighting_frame=0;break;case T:x=1,y=E=t;break;default:throw"Error!"}break;case 1:switch(m.lighting_frame){case 0:case I:break;case T:y=t;break;default:throw console.log("cluster.lighting_frame="+m.lighting_frame),"Error!"}}if(E&&y){for(t=E;t<=y;t++)(m=this.sg2d.clusters.getCluster(t,e))&&(0===m.lighting_frame&&(this.clustersIn.push(m),this.clustersInCamera.add(m)),m.lighting_frame=T);for(t=y+1;t<=b;t++)(m=this.sg2d.clusters.getCluster(t,e))&&(m.lighting_frame===I&&(this.clustersOut.push(m),this.clustersInCamera.delete(m)),m.lighting_frame=0)}}if(this.clustersOut.length||this.clustersIn.length){this.set("frameCVC",this.properties.frameCVC+1);for(A=0;A<this.clustersOut.length;A++)this.clustersOut[A].outCamera();for(A=0;A<this.clustersIn.length;A++)this.clustersIn[A].inCamera()}for(var c in l)l[c].x=Math.floor(.5+l[c].x),l[c].y=Math.floor(.5+l[c].y);u.drawDebug(),this.positionPrev.x=this.properties.position.x,this.positionPrev.y=this.properties.position.y,this.boundsClusterPrev.left=this.properties.boundsCluster.left,this.boundsClusterPrev.top=this.properties.boundsCluster.top,this.boundsClusterPrev.right=this.properties.boundsCluster.right,this.boundsClusterPrev.bottom=this.properties.boundsCluster.bottom,_&&this.trigger("boundsPX"),g&&this.trigger("boundsCluster")}followTo(t){this._followToTile=t}stopFollow(){this._followToTile=null}getFollow(){return this._followToTile}moveTo(){"object"==typeof arguments[0]?(this.set("target",arguments[0],s.a.OPTIONS_PRECISION_5),!0===arguments[1]&&this.set("position",arguments[0],s.a.OPTIONS_PRECISION_5)):(f._moveToTarget.x=arguments[0],f._moveToTarget.y=arguments[1],this.set("target",f._moveToTarget,s.a.OPTIONS_PRECISION_5),!0===arguments[2]&&this.set("position",f._moveToTarget,s.a.OPTIONS_PRECISION_5))}moveOffset(t=o.CELLSIZEPIX,e=0){let i=t/this.scales_k[this.properties.scale];e=e-this.properties.rotate+this.rotate_adjustment,f._point.x=this.properties.offset.x+i*a.cos(e,1),f._point.y=this.properties.offset.y-i*a.sin(e,1),this.set("offset",f._point)}onResize(){var t=window.devicePixelRatio?window.devicePixelRatio:window.outerWidth/window.innerWidth,e=this.scales_k[this.properties.scale]*this.browser_scale_start/t;this.sg2d.viewport.scale.set(e),0===this.rotate_adjustment||180===this.rotate_adjustment||-180===this.rotate_adjustment?this.set("wh",{w:(this.sg2d.pixi.screen.width||100)/e,h:(this.sg2d.pixi.screen.height||100)/e}):this.set("wh",{w:(this.sg2d.pixi.screen.height||100)/e,h:(this.sg2d.pixi.screen.width||100)/e}),this.set("wh05",{w:this.properties.wh.w>>1,h:this.properties.wh.h>>1}),this.set("position",void 0,void 0,f.FLAG_FORCE_CALLBACKS)}_iterate(){this._followToTile&&(f._point.x=this._followToTile.properties.position.x+this.properties.offset.x,f._point.y=this._followToTile.properties.position.y+this.properties.offset.y,this.set("target",f._point)),this.properties.target.x===this.properties.position.x&&this.properties.target.y===this.properties.position.y||(f._point.x=this.properties.position.x+f.SMOOTHNESS_FACTOR*(this.properties.target.x-this.properties.position.x),f._point.y=this.properties.position.y+f.SMOOTHNESS_FACTOR*(this.properties.target.y-this.properties.position.y),this.set("position",f._point))}onPointerEnter(t){this.set("pointer_over_canvas",!0)}onPointerLeave(t){this.set("pointer_over_canvas",!1)}onWheelScale(t){if(this.properties.pointer_over_canvas){var e=t.deltaY||t.detail||t.wheelDelta;this.zoomInc(e<0?1:-1)}}zoom(t=f.SCALE_NORMAL){t=Math.max(this.properties.scale_min,t),t=Math.min(this.properties.scale_max,t),this.set("scale",t),this.onResize()}zoomInc(t=1){var e=this.properties.scale+t;e=Math.max(this.properties.scale_min,e),e=Math.min(this.properties.scale_max,e),this.set("scale",e),this.onResize()}getScale(){return{value:this.properties.scale,percent:this.scales_per[this.properties.scale],k:this.scales_k[this.properties.scale]}}_addLinePoint(t,e){var i=this.boundsPoint[++this.boundsPoint._length];i.x=t<1?1:t>o.AREASIZE?o.AREASIZE:t,i.y=e<1?1:e>o.AREASIZE?o.AREASIZE:e}_onwheel(t,e){e||(e=window),"onwheel"in document?e.addEventListener("wheel",t):"onmousewheel"in document?e.addEventListener("mousewheel",t):e.addEventListener("MozMousePixelScroll",t)}_offwheel(t,e){e||(e=window),e.removeEventListener("wheel",t),e.removeEventListener("onmousewheel",t),e.removeEventListener("mousewheel",t),e.removeEventListener("MozMousePixelScroll",t)}destroy(){this.sg2d.pixi.view.removeEventListener("pointerenter",this.onPointerEnter),this.sg2d.pixi.view.removeEventListener("pointerleave",this.onPointerLeave),this._offwheel(this.onWheelScale),super.destroy()}}function _(){Object.assign(this,new s.a({music:!0,musicVolume:100,sounds:!0,soundsVolume:100,bass:!1,muteOnLossFocus:!0,volumeDecreaseDistance:10,environment2D:!0,view:"",_focusLoss:!1})),this.sounds={},this.musics={},this.music_views={},this.music_view=null,this.bass=void 0,this._options={config:void 0,music_dir:void 0,sounds_dir:void 0,library_pathfile:void 0},this._initializationRunned=!1,this._gestureDetected=!1,this.load=(t={},e={})=>{if("undefined"==typeof window||void 0===window.document)return void console.error("Error in SG2D.Sound.load()! window.document is not set!");let i;for(var s in this._options.config=t.config,this._options.music_dir=t.music_dir||this._options.music_dir||"./res/music/",this._options.sounds_dir=t.sounds_dir||this._options.sounds_dir||"./res/sounds/",this._options.library_pathfile=t.library_pathfile||this._options.library_pathfile||"./libs/pixi/pixi-sound.js",e)this.set(s,e[s]);return this._initializationRunned?i=this._options.config?new Promise((t,e)=>{this.loadConfig(this._options.config,t,e)}):Promise.resolve():(this._initializationRunned=!0,this.onEndMusic=this._onEndMusic.bind(this),this.visibilityChange=this._visibilityChange.bind(this),document.addEventListener("visibilitychange",this._visibilityChange),this.on("music",t=>{t?this.musicResume():this.musicPause()}),this.on("musicVolume",t=>{this.music_view&&this.music_view.instance&&(this.music_view.instance.volume=t/100)}),this.on("view",t=>{this.musicPlay(t)}),i=new Promise((e,i)=>{if(this._gestureDetected)this._libraryLoad(t,e,i);else{let s=setInterval(()=>{this._gestureDetected&&(clearInterval(s),this._libraryLoad(t,e,i))},100)}})),i},this._libraryLoaded=!1,this._libraryLoad=(t={},e,i)=>{let s;return this._libraryLoaded?s=Promise.resolve():(this._libraryLoaded=!0,s=l.loadJS(this._options.library_pathfile,s=>{this.visibilityChange(),this.bass=[new PIXI.sound.filters.ReverbFilter(1,100),new PIXI.sound.filters.EqualizerFilter(13,15,6,-1,0,0,0,0,0,0)],t.config?this.loadConfig(t.config,e,i):e()}),s.catch(t=>{i('Error in SG2D.Sound! See options.library_pathfile="'+this._options.library_pathfile+'"!')})),s},this._sg2dconnect=t=>{this.sg2d=t},this.loadConfig=(t,e,i)=>{"object"==typeof t?(this._parseConfig(t),e()):"string"==typeof t&&fetch(t).then(e=>{if(e.ok)return e.json();{let s="Error in SG2D.Sound! response.status="+e.status+'. See config="'+t+'"!';throw i(s),new Error(s)}}).then(t=>{this._parseConfig.call(this,t),e()}).catch(e=>{i('Error in SG2D.Sound! See config="'+t+'"!')})},this._parseConfig=t=>{var e,i;if(t.sounds)for(var s in t.sounds)e=t.sounds[s],this.sounds[s]=i="object"==typeof e?e:{file:e},i.name=s,i.sound=PIXI.sound.add(s,{autoPlay:!1,preload:!0,url:this._options.sounds_dir+i.file,loaded:(t,e)=>{t&&(void 0!==e&&(e.isError=!0),console.warn(""+t))}}),this.properties.bass&&(i.sound.filters=this.bass);if(t.music)for(let i in t.music){let s="string"==typeof(e=t.music[i])?[e]:Array.isArray(e)?e:[],o=[];for(var r=0;r<s.length;r++)o[r]=this.musics[s[r]]=PIXI.sound.add(s[r],{autoPlay:!1,preload:!1,singleInstance:!0,url:this._options.music_dir+s[r],loaded:(t,e)=>{t?(void 0!==e&&(e.isError=!0),console.warn(""+t)):this.properties.view&&this.properties.view===i&&!this.music_view&&this.musicPlay(i)},complete:(t,e,i)=>{}});this.music_views[i]={viewcode:i,status:!1,list:o,current_index:0,instance:null}}!this.properties.view||this.music_view&&this.music_view.viewcode===this.properties.view||this.musicPlay(this.properties.view)},this._visibilityChange=()=>{"visible"===document.visibilityState?(this.set("_focusLoss",!1),PIXI.sound&&PIXI.sound.unmuteAll()):(this.set("_focusLoss",!0),PIXI.sound&&this.properties.muteOnLossFocus&&PIXI.sound.muteAll())},this.musicPlay=(t=!0,e={},i=!1)=>{if(!0===t){if(!this.music_view)return!1}else this.music_view&&this.music_view.viewcode===t||(this.music_view&&(this.music_view.instance&&this.music_view.instance.destroy(),this.music_view.instance=null,this.music_view.status=!1),this.music_view=this.music_views[t]);if(!this.music_view)return i&&console.error("SG2D.Sound Error! The music file may not have been loaded yet!"),!1;if(this.set("view",t,void 0,s.a.FLAG_NO_CALLBACKS),this.music_view.status=!0,!this.music_view.list.length)return!1;if(this.properties.music&&PIXI.sound)if(e=s.a.defaults(e,{volume:this.properties.musicVolume/100}),this.music_view.instance)this.music_view.instance.paused&&(this.music_view.instance.paused=!1);else{let t=this.music_view.list[this.music_view.current_index];if(t.isError)return!1;this.properties.bass&&(t.filters=this.bass);let i=this.music_view,s=t.play(e);"function"==typeof s.then?s.then(t=>{i.instance=t,t.on("end",this.onEndMusic),i.status||(i.instance.paused=!0)}):(i.instance=s,i.instance.on("end",this.onEndMusic))}return!0},this._onEndMusic=t=>{this.music_view.current_index++,this.music_view.current_index>=this.music_view.list.length&&(this.music_view.current_index=0),this.music_view.instance=null,this.musicPlay()},this.musicPause=()=>{this.music_view&&(this.music_view.status=!1,this.music_view.instance&&(this.music_view.instance.paused=!0))},this.musicResume=()=>{this.musicPlay()},this._sound={file:""},this._config={},this.play=(t,e,i)=>{var s=null;if("string"==typeof t){let e=t;(t=this.sounds[e])||(this.sounds[e]=t={name:e,file:e+".mp3"})}var r=v._config;if("object"==typeof e&&(e.constructor.isTile?i=e:r=e),this.properties.sounds&&PIXI.sound){if(!t.sound)return;if(!t.sound.isLoaded)return!1;var o={};if(o.volume=(r.volume||t.volume||1)*this.properties.soundsVolume/100,this.properties.volumeDecreaseDistance){let t=f.getInstance(!0);if(i&&t){let e=64*this.properties.volumeDecreaseDistance,s=t.get("position"),r=i.get("position"),n=a.distance_p(s,r);o.volume*=Math.max(0,1-n/e)}f.getInstance(!0)&&(o.volume=o.volume*f.get("scale")/f.SCALE_NORMAL)}if(o.speed=r.speed||t.speed||1,o.start=r.start||t.start||0,r.end?o.end=r.end:t.end&&(o.end=t.end),s=t.sound.play(o),i&&(i.sound_instance=s),this.properties.environment2D){let t=f.getInstance(!0);if(i&&t){let e=a.sin(a.angle_p1p2_deg(t.get("position"),i.get("position"),0)-f.get("rotate")),r=new StereoPannerNode(s._source.context,{pan:e});s._source.connect(s._gain).connect(r).connect(s._source.context.destination)}}}return s},this.destroy=()=>{document.removeEventListener("visibilitychange",this.visibilityChange)}}f.singleInstance=!0,f.ROTATE_ADJUSTMENT=0,f.SCALE_MIN=2,f.SCALE_NORMAL=8,f.SCALE_MAX=10,f.MOVEMENT_BY_POINTER=1,f.MOVEMENT_BY_POINTER_LEFT=1,f.MOVEMENT_BY_POINTER_RIGHT=2,f.MOVEMENT_BY_POINTER_MIDDLE=4,f.STATE_NO_MOVEMENT=0,f.STATE_MOVEMENT_WAITING_SHIFT=1,f.STATE_MOVING=2,f.SMOOTHNESS_FACTOR=.25,f.typeProperties={rotate:s.a.TYPE_NUMBER,rotation:s.a.TYPE_BOOLEAN,position:s.a.TYPE_OBJECT_NUMBERS,target:s.a.TYPE_OBJECT_NUMBERS,offset:s.a.TYPE_OBJECT_NUMBERS,wh:s.a.TYPE_OBJECT_NUMBERS,wh05:s.a.TYPE_OBJECT_NUMBERS,boundsPX:s.a.TYPE_OBJECT_NUMBERS,boundsCluster:s.a.TYPE_OBJECT_NUMBERS},f.ownSetters={rotate:!0,position:!0},f.moveTo=function(...t){f.getInstance().moveTo.apply(f.getInstance(),...t)},f.scaling=function(t){f.getInstance().properties.scale_wheel&&f.getInstance().onWheelScale({deltaY:"-"===t.action?1:-1})},f._point={x:void 0,y:void 0},f._boundsPX={},f._boundsCluster={},f._moveToTarget={x:0,y:0};var v={EMPTY:!0};if("undefined"!=typeof window&&window.document){let t=i=>{20!==i.keyCode&&18!==i.keyCode&&17!==i.keyCode&&16!==i.keyCode&&(document.removeEventListener("keydown",t),document.removeEventListener("pointerup",e),v._gestureDetected=!0)},e=i=>{document.removeEventListener("keydown",t),document.removeEventListener("pointerup",e),v._gestureDetected=!0};document.addEventListener("keydown",t),document.addEventListener("pointerup",e),_.prototype=s.a.prototype,v=new _}var m=v;class E extends s.a{initialize(t,e,i){if(this.constructor._prepareStaticConfigSprites(),i=i||s.a.OBJECT_EMPTY,this.bounds=this.body&&this.body.bounds?new p(this.body.bounds):new p,this.boundsCXY=new p,this.clusters=new Set,this.centerCluster=null,this.sprite=void 0,this.sprites=void 0,this.hasAnimations=!1,!this.constructor.sprites)throw"Error 82423704! this.constructor.sprites must be filled!";if(this.sprites=s.a.clone(this.constructor.sprites),this.sprites.main&&(this.sprite=this.sprites.main),this.sprite){for(var r in this.sprite.texture=void 0!==this.properties.texture?this.properties.texture:this.constructor.sprites.main.texture,E._defaultSpriteValues)void 0!==t[r]&&(this.sprite[r]=t[r]);void 0!==this.properties.layer&&(this.sprite.layer=this.properties.layer)}l.objectForEach(this.sprites,t=>{t._texture=t.texture,t.animation&&(t.animation._count=t.animation.start||1,t.animation._sleep=1,t.animation.onComplete&&(t.animation.onComplete=t.animation.onComplete.bind(this)),this.hasAnimations=!0,this._animationIndex=0)}),d.tiles[this.properties.id]=this,d.tilesset.add(this),this.onGeometric(),this.drawUndraw()}setTexture(t,e=s.a.OBJECT_EMPTY,i=0){o.ONLY_LOGIC||this._setTileProperty("texture",t,e,i)}setPosition(t,e=s.a.OBJECT_EMPTY,i=0){this.set("position",t,e,i|s.a.FLAG_IGNORE_OWN_SETTER)&&(this.onGeometric(),this.drawUndraw())}setAngle(t,e=s.a.OBJECT_EMPTY,i=0){void 0!==t&&(t=a.normalize_a(t,l.ifUndefined(e.precision,1))),this._setTileProperty("angle",t,e,i)}setAnchor(t,e=s.a.OBJECT_EMPTY,i=0){this._setTileProperty("anchor",t,e,i)}setScale(t,e=s.a.OBJECT_EMPTY,i=0){this._setTileProperty("scale",t,e,i)}setAlpha(t,e=s.a.OBJECT_EMPTY,i=0){this._setTileProperty("alpha",t,e,i)}setVisible(t,e=s.a.OBJECT_EMPTY,i=0){this._setTileProperty("visible",t,e,i)}setZindex(t,e=s.a.OBJECT_EMPTY,i=0){this._setTileProperty("zindex",t,e,i)}_setTileProperty(t,e,i=s.a.OBJECT_EMPTY,r=0){if(this._spritesFromOptions(i),E._spritesFromOptions.size){let i=!1;for(var o of E._spritesFromOptions)o&&o[t]!==e&&(o[t]=e,i=!0,this.drawUndraw(o));return i}return!!this.set(t,e,i,r|s.a.FLAG_IGNORE_OWN_SETTER)&&(l.objectForEach(this.sprites,i=>{i.setter_flag!==E.FLAG_ONLY_OPTIONS_SPRITE&&(i[t]=e)}),this.drawUndraw(),!0)}drawUndraw(t){if(!o.ONLY_LOGIC&&T._initialized){if(this.isInCamera()){if(t)this._pixiSprite(t);else{for(var e in this.sprites)this._pixiSprite(this.sprites[e]);this.set("drawed",!0)}return!0}return this.removeSprites(),!1}}isInCamera(){for(var t of(this.clusters,this.clusters))if(t.drawed)return!0;return!1}_pixiSprite(t){if(T._initialized&&!1===this.constructor.noDraw){var e=t.pixiSprite;if(t.visible){if(!e){let i=this.updateSpriteTexture(t,t.animation&&t.animation.running?this.getAnimationTexture(t):t.texture);(e=t.pixiSprite=new PIXI.Sprite(i)).tile=this,T.drawSprite(e,t.layer)}}else e&&(T.removeSprite(t.pixiSprite),delete t.pixiSprite);t.pixiSprite&&((!t.animation||t.animation&&!t.animation.running)&&this.updateSpriteTexture(t,t.texture),e.position.x=~~this.properties.position.x,e.position.y=~~this.properties.position.y,"number"==typeof t.anchor?e.anchor.set(t.anchor):e.anchor.set(t.anchor.x,t.anchor.y),"number"==typeof t.scale?e.scale.set(t.scale):e.scale.set(t.scale.x,t.scale.y),e.angle=t.angle,e.zIndex=t.zindex,e.alpha=t.alpha,e.visible=t.visible)}}removeSprites(){if(this.properties.drawed){for(var t in this.sprites){var e=this.sprites[t];e.pixiSprite&&(T.removeSprite(e.pixiSprite),delete e.pixiSprite),e.animation&&(e.animation._count=1,e.animation._sleep=1,e.animation.loop||(e._texture=e.texture,e.animation.running=!1))}this.set("drawed",!1)}}startAnimation(t){let e=this._checkSpriteAnimation(t);e&&(e.animation.running=!0,e.visible=!0,e.animation._count=1,e.animation._sleep=1,this.isInCamera()&&this._pixiSprite(e),this.updateSpriteTexture(e,this.getAnimationTexture(e)))}breakAnimation(t){let e=this._checkSpriteAnimation(t);e&&(e.animation.running=!1,e.animation.visible=!1,e.animation._count=1,e.animation._sleep=1,this.updateSpriteTexture(e,e.texture||e._texture),this.isInCamera()&&this._pixiSprite(e))}stopAnimation(t,e){let i=this._checkSpriteAnimation(t);i&&(i.animation.running=!1),e&&void 0!==e.visible&&this.set("visible",e.visible,{sprite:i})}resumeAnimation(t,e){let i=this._checkSpriteAnimation(t);i&&(i.animation.running=!0),e&&void 0!==e.visible&&this.set("visible",e.visible,{sprite:i})}stepAnimation(t,e=1){let i=this._checkSpriteAnimation(t);if(i)for(var s=0;s<e;s++)this.iterateAnimations(!0,i)}_checkSpriteAnimation(t){if(this.hasAnimations){let e="object"==typeof(t=t||this.sprite)?t:this.sprites[t];if(!e)throw'Error 730002! Animation sprite "'+t+'" not found!';if(!e.animation)throw'Error 908720! Sprite "'+e.name+'" does not contain animation description!';return e}return!1}getAnimationTexture(t){return t.animation.basetexture+t.animation._count}iterateAnimations(t=!0,e){this.hasAnimations&&(this._animationIndex<t||!0===t)&&(!0!==t&&(this._animationIndex=t),e?this._iterateAnimation(e):l.objectForEach(this.sprites,this._iterateAnimation,this))}_iterateAnimation(t){var e=t.animation;e&&e.running&&(e._sleep++,e._sleep>e.sleep&&(e._sleep=1,e._count++,e._count>e.count?(e._count=1,e.loop||(t._texture=t.texture||t._texture,t.visible=!1,e.running=!1,e.onComplete&&e.onComplete(t),this._pixiSprite(t))):t._texture=this.getAnimationTexture(t),this.updateSpriteTexture(t)))}updateSpriteTexture(t,e){void 0!==e&&(t._texture=e);let i=this.checkTexture(t._texture),s=PIXI.Texture.from(i,{},o.PIXI_TEXTURE_STRICT);return t.pixiSprite&&t.pixiSprite.texture.textureCacheIds[0]!==i&&(t.pixiSprite.texture=s),s}checkTexture(t){return o.PIXI_TEXTURE_STRICT||PIXI.utils.TextureCache[t]||(-1===E._textures_not_founded.indexOf(t)&&(E._textures_not_founded.push(t),console.warn('Texture with the name "'+t+'" was not found!')),t=o.TILE_404),t}_spritesFromOptions(t=s.a.OBJECT_EMPTY){E._spritesFromOptions.clear(),t.sprite&&E._spritesFromOptions.add(t.sprite),t.sprites&&l.objectForEach(t.sprites,t=>E._spritesFromOptions.add(t))}onGeometric(){this.calcBoundsPX(),this.calcCXY(),this.calcClustersBody()}calcBoundsPX(){this.bounds.set(this.properties.position.x-o.CELLSIZEPIX05+.5,this.properties.position.y-o.CELLSIZEPIX05+.5,this.properties.position.x+o.CELLSIZEPIX05-.5,this.properties.position.y+o.CELLSIZEPIX05-.5)}calcCXY(){E._point.x=l.PXtoCX(this.properties.position.x),E._point.y=l.PXtoCX(this.properties.position.y),this.centerCluster=d.getClusterCXY(E._point),this.set("cxy",E._point,void 0,s.a.FLAG_PREV_VALUE_CLONE),this.boundsCXY.set(l.PXtoCX(this.bounds.min.x),l.PXtoCX(this.bounds.min.y),l.PXtoCX(this.bounds.max.x),l.PXtoCX(this.bounds.max.y))}calcClustersBody(){var t;for(t of this.clusters)(t.x<this.boundsCXY.min.x||t.x>this.boundsCXY.max.x||t.y<this.boundsCXY.min.y||t.y>this.boundsCXY.max.y)&&(this.clusters.delete(t),t.tiles.delete(this),this.constructor.isBody&&t.bodies.delete(this));for(var e=this.boundsCXY.min.y;e<=this.boundsCXY.max.y;e++)for(var i=this.boundsCXY.min.x;i<=this.boundsCXY.max.x;i++)(t=d.getCluster(i,e))&&(this.clusters.add(t),t.tiles.add(this),this.constructor.isBody&&t.bodies.add(this))}sound(t){m.play(t,this)}destroy(){for(var t of(o.ONLY_LOGIC||(this.removeSprites(),o.DRAW_BODY_LINES&&u.undrawSG2DBodyLines(this)),this.clusters))t.tiles.delete(this),t.bodies.delete(this);this.clusters.clear(),d.tiles[this.properties.id]=null,d.tilesset.delete(this),super.destroy()}}E.typeProperties={texture:s.a.TYPE_STRING,position:s.a.TYPE_OBJECT_NUMBERS,angle:s.a.TYPE_NUMBER,anchor:s.a.TYPE_NUMBER_OR_XY,scale:s.a.TYPE_NUMBER_OR_XY,alpha:s.a.TYPE_NUMBER,visible:s.a.TYPE_BOOLEAN,zindex:s.a.TYPE_NUMBER,cxy:s.a.TYPE_OBJECT_NUMBERS},E.layer=void 0,E.texture=o.TILE_OVERRIDE,E.angle=0,E.anchor=.5,E.scale=1,E.alpha=1,E.visible=!0,E.zindex=0,E.isTile=!0,E.isBody=!1,E.noDraw=!1,E.FLAG_ONLY_OPTIONS_SPRITE=!0,E._initPrevPosition={x:-1,y:-1},E._point={x:void 0,y:void 0},E.ownSetters={position:!0,angle:!0,anchor:!0,scale:!0,alpha:!0,visible:!0,zindex:!0,texture:!0},E.defaultProperties={id:void 0,position:{x:0,y:0},angle:0,anchor:.5,scale:1,alpha:1,visible:!0,zindex:0,layer:void 0,cxy:{x:0,y:0},drawed:!1},E._defaultSpriteValues={angle:0,anchor:.5,scale:1,alpha:1,visible:!0,zindex:0},E._prepareStaticConfigSprites=function(){this.hasOwnProperty("_spritesPrepared")||(this._spritesPrepared=!0,this.hasOwnProperty("sprites")?this.sprites=this._prepareMultipleSprites(this.sprites):this.sprites={main:this._prepareSpriteProperties({name:"main"},this)},this.sprites.main&&(this.sprite=this.sprites.main),this.sprite&&void 0!==this.animation&&(this.sprite.animation=s.a.clone(this.animation)),void 0!==this.zindex&&l.objectForEach(this.sprites,t=>{"main"!==t.name&&(t.zindex+=this.zindex)}))},E._prepareMultipleSprites=function(t,e){for(var i in t){const s=t[i];s.name=i,e&&(s.parent=e.name,s.setter_flag=E.FLAG_ONLY_OPTIONS_SPRITE),this._prepareSpriteProperties(s),s.sprites&&(t={...t,...this._prepareMultipleSprites(s.sprites,s)})}return t},E._prepareSpriteProperties=function(t,e){for(var i in e||(e=t),t.texture=void 0!==typeof e.texture?e.texture:o.TILE_OVERRIDE,E._defaultSpriteValues)t[i]=l.ifUndefined(e[i],E._defaultSpriteValues[i]);return t.layer=e.layer||this.layer,t},E._textures_not_founded=[],E._spritesFromOptions=new Set;class y extends s.a{initialize(t,e,i){y._newPosition||(y._newPosition=new PIXI.Point),this.identifiers=[];for(var s=0;s<y._maxIdentifiers;s++)this.identifiers[s]={target:{cluster:void 0,tile:void 0,sprite:void 0,pxy:this.properties.pxy,cxy:this.properties.cxy,pxy_local:{x:void 0,y:void 0}},options:{type:void 0,button:void 0}};this.on("pxy",()=>{this.set("cxy",[Math.floor(1+this.properties.pxy.x/o.CELLSIZEPIX),Math.floor(1+this.properties.pxy.y/o.CELLSIZEPIX)])})}_sg2dconnect(t){for(var e in this.sg2d=t,this.camera=this.sg2d.camera,this.properties.global=this.sg2d.pixi.renderer.plugins.interaction.mouse.global,this.sg2d.viewport.interactive=!0,this.sg2d.viewport.on("pointerdown",this.pointerdown.bind(this)),this.sg2d.viewport.on("pointerup",this.pointerup.bind(this)),this.sg2d.viewport.on("pointermove",this.pointermove.bind(this)),this.properties.cursors){var i=this.properties.cursors[e];i&&(this.sg2d.pixi.renderer.plugins.interaction.cursorStyles[e]=i)}}pointerdown(t){if(!this.sg2d.clusters)return;if(t.data.identifier>=y._maxIdentifiers)return;let e=this.identifiers[t.data.identifier].target,i=this.identifiers[t.data.identifier].options;if(i.button=t.data.button,i.type=t.type,e.cluster=this.sg2d.clusters.getCluster(this.properties.cxy.x,this.properties.cxy.y),e.tile=null,e.sprite=null,e.cluster)for(var s of e.cluster.bodies)l.objectForEach(s.sprites,t=>{t.pixiSprites&&(this.sg2d.pixi.renderer.plugins.interaction.mouse.getLocalPosition(t.pixiSprite,e.pxy_local),t.getLocalBounds().contains(e.pxy_local.x,e.pxy_local.y)&&(!e.sprite.pixiSprite||e.sprite.pixiSprite.zIndex>t.pixiSprite.zIndex)&&(e.sprite=t,e.tile=s))});this.camera.properties.movement_by_pointer&&this.camera.properties.movement_state===f.STATE_NO_MOVEMENT&&(0===i.button&&this.camera.properties.movement_by_pointer&f.MOVEMENT_BY_POINTER_LEFT||2===i.button&&this.camera.properties.movement_by_pointer&f.MOVEMENT_BY_POINTER_RIGHT||1===i.button&&this.camera.properties.movement_by_pointer&f.MOVEMENT_BY_POINTER_MIDDLE)&&(y._startPoint.x=y._newPosition.x,y._startPoint.y=y._newPosition.y,this.camera.set("movement_state",f.STATE_MOVEMENT_WAITING_SHIFT))}pointermove(t){if(this.camera.properties.movement_by_pointer)if(this.camera.properties.movement_state===f.STATE_MOVEMENT_WAITING_SHIFT){this.sg2d.viewport.cursor="move",a.distance_p(y._startPoint,y._newPosition)>=y.CAMERA_MOVEMENT_SHIFT&&(y._startPoint.x=this.properties.global.x,y._startPoint.y=this.properties.global.y,y._startPointPXY.x=this.camera.properties.offset.x,y._startPointPXY.y=this.camera.properties.offset.y,this.camera.set("movement_state",f.STATE_MOVING))}else if(this.camera.properties.movement_state===f.STATE_MOVING){let t=this.camera.scales_k[this.camera.properties.scale],e=(this.properties.global.x-y._startPoint.x)/t,i=(this.properties.global.y-y._startPoint.y)/t,r=this.camera.properties.rotate-this.camera.rotate_adjustment;y._position.x=y._startPointPXY.x-e*a.cos(r,1)+i*a.sin(r,1),y._position.y=y._startPointPXY.y-i*a.cos(r,1)-e*a.sin(r,1),this.camera.set("offset",y._position,s.a.OPTIONS_PRECISION_5)}}pointerup(t){if(!this.sg2d.clusters)return;if(t.data.identifier>=y._maxIdentifiers)return;let e=this.identifiers[t.data.identifier].target,i=this.identifiers[t.data.identifier].options;if(e.tile&&(e.tile.constructor.click&&e.tile.constructor.click(e,i),e.tile.click&&e.tile.click(e,i)),this.camera.properties.movement_by_pointer&&this.camera.properties.movement_state){this.sg2d.viewport.cursor="default";let t=this.camera.scales_k[this.camera.properties.scale];this.properties.global.x,y._startPoint.x,this.properties.global.y,y._startPoint.y;this.camera.set("movement_state",f.STATE_NO_MOVEMENT)}this.pointerclick(e,i)}pointerclick(t){}iterate(){this.sg2d.pixi.renderer.plugins.interaction.mouse.getLocalPosition(this.sg2d.viewport,y._newPosition),y._newPosition.x=~~y._newPosition.x,y._newPosition.y=~~y._newPosition.y,this.set("pxy",[y._newPosition.x,y._newPosition.y])}}y.typeProperties={global:s.a.TYPE_OBJECT_NUMBERS,camera:s.a.TYPE_OBJECT_NUMBERS,pxy:s.a.TYPE_OBJECT_NUMBERS,cxy:s.a.TYPE_OBJECT_NUMBERS},y.POINTER_LEFT=0,y.POINTER_MIDDLE=1,y.POINTER_RIGHT=2,y.CAMERA_MOVEMENT_SHIFT=10,y._newPosition=void 0,y._maxIdentifiers=10,y.defaultProperties={global:void 0,pxy:{x:0,y:0},cxy:{x:0,y:0},cursors:{default:"",hover:"",move:""}},y._position={x:0,y:0},y._startPoint={x:0,y:0},y._startPointPXY={x:0,y:0};class x{constructor(){this.effects=new Set}_sg2dconnect(t){this.sg2d=t,this.sg2d.camera.on("scale",this._onCameraScale.bind(this),void 0,void 0,!0),this.sg2d.camera.on("rotate",this._onCameraRotate.bind(this),void 0,void 0,!0)}_onCameraScale(t,e){for(var i of this.effects)switch(i.type){case x.TYPE_SHADOWS:i.filter.distance*=t/e;break;case x.TYPE_BEVELS:i.filter.thickness*=t/e;break;case x.TYPE_DISPLACEMENT:i.options.scale/=t/e,i.sprite.scale.set(i.options.scale)}}_onCameraRotate(t){for(var e of this.effects)switch(e.type){case x.TYPE_SHADOWS:case x.TYPE_BEVELS:e.filter.rotation=e.options.rotation-t}}addShadowsToLayer(t){var e=this.sg2d.layers[t.layer].container;e.filters=e.filters||[];var i=l.ifUndefined(t.rotation,135),s={type:x.TYPE_SHADOWS,layer:t.layer,filter:new PIXI.filters.DropShadowFilter({rotation:i-this.sg2d.camera.properties.rotate,distance:l.ifUndefined(t.distance,8),alpha:l.ifUndefined(t.alpha,.6)}),options:{rotation:i}};return e.filters.push(s.filter),this.effects.add(s),s}addBevelsToLayer(t){var e=this.sg2d.layers[t.layer].container;e.filters=e.filters||[];var i=l.ifUndefined(t.rotation,135),s={type:x.TYPE_BEVELS,layer:t.layer,filter:new PIXI.filters.BevelFilter({rotation:i-this.sg2d.camera.properties.rotate,thickness:l.ifUndefined(t.thickness,2),lightAlpha:l.ifUndefined(t.lightAlpha,.8),shadowAlpha:l.ifUndefined(t.shadowAlpha,.8)}),options:{rotation:i}};return s.filter.padding=1,e.filters.push(s.filter),this.effects.add(s),s}addDisplacementToLayer(t){var e=this.sg2d.layers[t.layer].container;e.filters=e.filters||[];var i={type:x.TYPE_DISPLACEMENT,layer:t.layer,options:{texture:t.texture||o.TILE_OVERRIDE,scale:t.scale||1}};return"function"==typeof t.iterate&&(i.iterate=t.iterate.bind(i),i.options.animationStep=t.animationStep||1),i.sprite=PIXI.Sprite.from(i.options.texture),i.sprite.scale.set(i.options.scale),i.sprite.texture.baseTexture.wrapMode=PIXI.WRAP_MODES.REPEAT,e.addChild(i.sprite),i.filter=new PIXI.filters.DisplacementFilter(i.sprite),e.filters.push(i.filter),this.effects.add(i),i}}x.TYPE_SHADOWS=1,x.TYPE_BEVELS=2,x.TYPE_DISPLACEMENT=3;class g{}g.files={},g.classes={},g.instances={},g.load=function(t){t="object"==typeof t?Array.isArray(t)?t.reduce((t,e)=>(t[e]={},t),{}):t:{};let e=[];for(let i in t)if(!this.files[i]){let t=new Promise((t,e)=>{this.files[i]=import("./plugins/"+i+".js").then(i=>{let s=this.classes[i.default.name]=i.default;this.instances[i.default.code]=new s;if(!s.ready)throw'The plugin class "'+s.name+"\" must have a static ready() method! Maybe you didn't inherit the class from SG2D.PluginBase or you didn't call super() in the constructor!";s.ready(t,e)})});e.push(t)}return Promise.all(e)};class I{static ready(t,e){return this._ready||(this._ready=new Promise((t,e)=>{this.success=t,this.failed=e})),(t||e)&&this._ready.then(t||(()=>{}),e||(()=>{})),this._ready}constructor(){if(this.constructor._instance)throw"Error! A plugin class can only have one instance!";this.constructor._instance=this,this.constructor.ready()}}class T{constructor(t){if(T._instance)throw"SG2D.Application Error! There is an instance of the class! You must execute .destroy() on the previous instance!";if(T._instance=this,T._initialized?Promise.resolve():T._initialize(),!t)throw"SG2D.Application Error! config is empty!";+t.cellsizepix&&T.setCellSizePix(t.cellsizepix),this.id=t.id?t.id:++T._uid;let e=t.pixi=t.pixi||{};this.canvas=e.view=e.view||document.getElementById(t.canvasId)||document.querySelector("CANVAS"),e.width=void 0!==e.width?e.width:100,e.height=void 0!==e.height?e.height:100,e.backgroundColor=void 0!==e.backgroundColor?e.backgroundColor:0,e.resizeTo=void 0!==e.resizeTo?e.resizeTo:this.canvas.parentElement;let i=void 0===e.autoStart||e.autoStart;if(e.autoStart=!1,T.drawSprite=T._drawSprite.bind(this),T.removeSprite=T._removeSprite.bind(this),this.iterate=this.iterate.bind(this),this.iterate_out=t.iterate||function(){},this.resize_out=t.resize||function(){},this.canvas.oncontextmenu=function(){return!1},this.canvas.onselectstart=function(){return!1},SG2D.pixi=this.pixi=new PIXI.Application(e),t.matter&&(SG2D.matter=this.matter=Matter.Engine.create(t.matter),Matter.Events.on(this.matter,"collisionStart",(function(t){for(var e=0;e<t.pairs.length;e++){var i=t.pairs[e];i.bodyA.parent.tile&&i.bodyB.parent.tile&&(i.bodyA.parent.tile.collision&&i.bodyA.parent.tile.collision(i.bodyB.parent.tile,i,t.pairs),i.bodyB.parent.tile.collision&&i.bodyB.parent.tile.collision(i.bodyA.parent.tile,i,t.pairs))}}))),this.frame_index=0,t.layers||(t.layers={main:{}}),"number"==typeof t.layers){for(var s=[],r=0;r<t.layers;r++)s[r]={};t.layers=s}let o=!1;for(var n in t.layers){if((h=t.layers[n]).position===SG2D.LAYER_POSITION_FIXED){o=!0;break}}o?(this.viewport=new PIXI.Container,this.pixi.stage.addChild(this.viewport)):this.viewport=this.pixi.stage,this.viewport.sortableChildren=!0,this.layers={};let a=0;for(var n in t.layers){var h=t.layers[n],p=this.layers[n]={position:h.position||SG2D.LAYER_POSITION_ABSOLUTE,zIndex:h.zIndex||++a,sortableChildren:void 0===h.sortableChildren||h.sortableChildren},c=p.container="main"===n?this.viewport:new PIXI.Container;void 0!==p.sortableChildren&&(c.sortableChildren=p.sortableChildren),void 0!==p.zIndex&&(c.zIndex=p.zIndex),"main"!==n&&(p.position===SG2D.LAYER_POSITION_FIXED?this.pixi.stage.addChild(c):this.viewport.addChild(c))}this.pixi.ticker.add(this.iterate),this.clusters=t.clusters instanceof d?t.clusters:new d(t.clusters),this.camera=t.camera instanceof f?t.camera:new f(t.camera),this.camera._sg2dconnect&&this.camera._sg2dconnect(this),this.pointer=t.pointer instanceof y?t.pointer:new y(t.pointer),this.pointer._sg2dconnect&&this.pointer._sg2dconnect(this),this.resize=l.debounce(this.resize,100).bind(this),addEventListener("resize",this.resize),T._pluginsPromise=g.load(t.plugins),this.effects=t.effects instanceof x?t.effects:new x(t.effects),this.effects._sg2dconnect&&this.effects._sg2dconnect(this),"string"==typeof t.sound&&(t.sound={options:{config:t.sound}}),"object"==typeof t.sound?T._soundConfigPromise=m.load(t.sound.options,t.sound.properties):T._soundConfigPromise=Promise.resolve(),m._sg2dconnect(this),t.deferred?this.deferred=t.deferred:this.deferred=SG2D.Deferred(),this.state=T.STATE_IDLE,i&&this.run()}run(){Promise.all([T._initializationPromise,T._pluginsPromise,T._soundConfigPromise]).then(()=>{this.deferred.resolve(this),window.dispatchEvent(new Event("resize")),this.initClustersInCamera(),this.pixi.start(),this.state=T.STATE_RUN},t=>{throw"Error 50713888! Message: "+t})}initClustersInCamera(){this.clusters.each(t=>{t.drawed&&(t.inCamera(!0))})}iterate(t){if(this.state===T.STATE_RUN){var e=l.getTime();for(var i of(this.frame_index++,this.matter&&this.matterIterate(),this.camera._iterate(),o.DRAW_BODY_LINES&&u.redrawSG2DBodiesLines(),this.pointer.iterate(),this.camera.clustersInCamera))for(var s of i.tiles)s.iterateAnimations&&s.iterateAnimations(this.frame_index);for(var r of this.effects.effects)r.iterate&&r.iterate();for(var s of this.clusters.tilesset)s.iterate&&s.iterate();this.iterate_out();t=l.getTime();this.tUsed0=t-e,this.tRequestAnimationFrame=this.tPrevious?t-this.tPrevious:1,this.tPrevious=t}}matterIterate(){Matter.Engine.update(this.matter),this.aBodies=Matter.Composite.allBodies(this.matter.world);for(var t=0;t<this.aBodies.length;t++){var e=this.aBodies[t];if(!e.isStatic){var i=e.tile;i&&(e.angle>=a.PI2&&(Matter.Body.setAngle(e,e.angle-a.PI2),e.anglePrev=e.angle),e.angle<0&&(Matter.Body.setAngle(e,e.angle+a.PI2),e.anglePrev=e.angle),i.set("position",e.position,s.a.OPTIONS_PRECISION_5),i.set("angle",e.angle/a.PI180,s.a.OPTIONS_PRECISION_5),i.set("velocity",e.velocity,s.a.OPTIONS_PRECISION_5),i.set("angularVelocity",e.angularVelocity,s.a.OPTIONS_PRECISION_5),i.changed?(i.bounds.set(e.bounds),e.velocity&&(e.velocity.x>0?i.bounds.max.x-=e.velocity.x:i.bounds.min.x-=e.velocity.x,e.velocity.y>0?i.bounds.max.y-=e.velocity.y:i.bounds.min.y-=e.velocity.y)):(Matter.Body.setAngularVelocity(e,0),Matter.Body.setVelocity(e,{x:0,y:0}),Matter.Body.setPosition(e,i.properties.position),Matter.Body.setAngle(e,i.properties.angle*a.PI180)))}}}pause(){this.pixi.stop(),this.state=T.STATE_PAUSE}destroy(){this.state=T.STATE_DESTROY,removeEventListener("resize",this.resize),this.pointer.destroy(),this.pointer=null,this.camera.destroy(),this.camera=null,this.clusters.destroy(),this.clusters=null,u.clear();for(var t=0;t<this.viewport.children.length;t++)this.viewport.removeChild(this.viewport.children[t]);this.pixi.render(),this.pixi.stop(),setTimeout(()=>{this.pixi.destroy(void 0,{children:!0}),this.pixi=null,SG2D.pixi=null},500),SG2D.matter&&(Matter.World.clear(this.matter.world),Matter.Engine.clear(this.matter),SG2D.matter=null),T.drawSprite=null,T.removeSprite=null,T.spritesCount=0,T._instance=null}resize(){this.camera.onResize(),this.resize_out()}}T._initializationPromise=l._loadSystemTextures(),T._instance=null,T.getInstance=function(t){if(this._instance)return this._instance;if(!t)throw"Error! SG2D.Application._instance is empty!";return null},T.STATE_IDLE=0,T.STATE_RUN=1,T.STATE_PAUSE=2,T.STATE_DESTROY=1<<31,T._uid=0,T.plugins=null,T._pluginsPromise=null,T._soundConfigPromise=null,T._initialized=!1,T._initialize=function(){T.plugins=g,I.SGModel=s.a,I.SG2DConsts=o,I.SG2DUtils=l,I.SG2DClusters=d,I.SG2DTile=E,I.SG2DCamera=f,PIXI.utils.skipHello(),this._initializationPromise.then(()=>{T._initialized=!0})},T.spritesCount=0,T._drawSprite=function(t,e){void 0!==e&&T._instance.layers[e]?T._instance.layers[e].container.addChild(t):T._instance.viewport.addChild(t),T.spritesCount++,o.DRAW_BODY_LINES&&u.drawSG2DBodyLines(t.tile)},T._removeSprite=function(t){!t||t.parent,t.parent.removeChild(t),T.spritesCount--,o.DRAW_BODY_LINES&&u.undrawSG2DBodyLines(t.tile)},T.setCellSizePix=function(t){o.CELLSIZEPIX=+t,o.CELLSIZEPIX05=+t>>1,o.CELLSIZELOG2=Math.ceil(Math.log2(o.CELLSIZEPIX))};class A extends E{initialize(t,e,i){this.body=this.bodyCreate(t.position,t.angle),this.body&&(this.body.tile=this),super.initialize.apply(this,arguments),this.body&&Matter.Composite.add(SG2D.matter.world,this.body),SG2D.Clusters.bodies.add(this)}bodyCreate(t={x:0,y:0},e=0){return this.body=Matter.Bodies.rectangle(t.x,t.y,SG2D.Consts.CELLSIZEPIX-1,SG2D.Consts.CELLSIZEPIX-1,{isStatic:!0,frictionStatic:this.constructor.MATTER.FRICTIONSTATIC,restitution:this.constructor.MATTER.RESTITUTION,slop:this.constructor.MATTER.SLOP}),this.properties.angle&&Matter.Body.setAngle(this.body,e*SG2D.Math.PI180),this.body}onGeometric(){this.calcCXY(),this.calcClustersBody()}getBodiesAround(t,e=1,i=[]){var s;i.length=0;for(var r=l.PXtoCX(t.x),o=l.PXtoCX(t.y),n=r-e;n<=r+e;n++)for(var a=o-e;a<=o+e;a++)if(s=d.getCluster(n,a))for(var h of s.bodies)h!==this&&h.body&&-1===i.indexOf(h.body)&&i.push(h.body);return i}destroy(){this.body&&Matter.Composite.remove(SG2D.matter.world,this.body),SG2D.Clusters.bodies.delete(this),this.body=null,super.destroy()}}A.isBody=!0,A.MATTER={DENSITY:1,FRICTION:0,FRICTIONAIR:.1,FRICTIONSTATIC:1,RESTITUTION:0,SLOP:.05};class C{static addFont(t){var e=C[t.name]={};e.symbols={},e.schema=t.schema;var i=t.texture.match(/(.+)_(\d+)x(\d+)(\w)?(\.\w+)?$/);if(i){e.base_name=i[1],e.w=+i[2],e.h=+i[3];for(var s=0;s<t.schema.length;s++)e.symbols[t.schema[s]]=PIXI.Texture.from(e.base_name+"_"+(1+s))}}}class S{constructor(t,e,i){e=e||S._options,this.sprite=new PIXI.Sprite("string"==typeof t?PIXI.Texture.from(t):t),this.sprite.x=e.x||0,this.sprite.y=e.y||0,e.scale=e.scale||{},"number"==typeof e.scale&&(e.scale={x:e.scale,y:e.scale}),this.sprite.scale.x=void 0===e.scale.x?1:e.scale.x,this.sprite.scale.y=void 0===e.scale.y?1:e.scale.y,e.anchor=e.anchor||{},"number"==typeof e.anchor&&(e.anchor={x:e.anchor||0,y:e.anchor||0}),this.sprite.anchor.set(e.anchor.x,e.anchor.y),this.sprite.angle=void 0===e.angle?0:e.angle,this.sprite.alpha=void 0===e.alpha?1:e.alpha,this.sprite.visible=void 0===e.visible||e.visible,this.sprite.interactive=!!e.interactive,this.sprite.buttonMode=!!e.buttonMode,e.pointerdown&&this.sprite.on("pointerdown",e.pointerdown),e.pointerup&&this.sprite.on("pointerup",e.pointerup),e.pointerupoutside&&this.sprite.on("pointerupoutside",e.pointerupoutside),e.pointerover&&this.sprite.on("pointerover",e.pointerover),e.pointerout&&this.sprite.on("pointerout",e.pointerout),(e.layer?T.getInstance().layers[e.layer].container:T.getInstance().viewport).addChild(this.sprite),"object"==typeof i&&Object.assign(this,i),this.sprite.sg2dSprite=this}}S._options={};let b={process:{state:0,t:void 0,opacity:1},eDiv:void 0,eMessage:void 0,holdInterval:500,fadeOutInterval:1e3,fadeOutSteps:20,fadeOutIntervalStep:void 0,opacityStep:void 0,STATE_IDLE:0,STATE_HOLD:1,STATE_FADEOUT:2,initialize:function(){this.eDiv||(this.eDiv=document.querySelector("#message_toast"),this.eDiv||(document.body.insertAdjacentHTML("beforeend",'\n<div id="message_toast" style="color: white; position: fixed; left: 50%; margin-right: -50%; background: transparent; transform: translate(-50%, 200%); display: none">\n\t<div class="content">\n\t\t<div class="js-message" style="color: #fff; font: 20pt bold Arial;"></div>\n\t</div>\n</div>'),this.eDiv=document.querySelector("#message_toast")),this.eMessage=this.eDiv.querySelector(".js-message"),this.fadeOutIntervalStep=~~(this.fadeOutInterval/this.fadeOutSteps),this.opacityStep=1/b.fadeOutSteps),this.startFadeOut=this.startFadeOut.bind(this),this.fadeOut=this.fadeOut.bind(this)},show:function(t){this.initialize(),this.process.state&&(clearInterval(this.process.t),this.process.t=null),this.process.state=this.STATE_HOLD,this.process.t=setTimeout(this.startFadeOut,this.holdInterval),this.eMessage.innerHTML=t.text,this.eDiv.style.display="block",this.eDiv.style.opacity=.99},startFadeOut:function(){this.process.t=setInterval(this.fadeOut,this.fadeOutIntervalStep)},fadeOut:function(){this.eDiv.style.opacity-=this.opacityStep,this.eDiv.style.opacity<=0&&(this.eDiv.style.opacity=1,this.eDiv.style.display="none",clearInterval(this.process.t),this.process.t=null,this.process.state=this.STATE_IDLE)}};var w=b,P={Model:s.a,Deferred:r,Consts:o,Math:a,Utils:l,Application:T,Clusters:d,Camera:f,Tile:E,TileBody:A,Pointer:y,Effects:x,Plugins:g,PluginBase:I,Debugging:u,Bounds:p,Cluster:c,Fonts:C,Label:class{constructor(t,e){this.options=e||{},e.x=e.x||0,e.y=e.y||0,e.scale=e.scale||1,this.setText(t)}setText(t){this.container?this.container.removeChildren():this.container=new PIXI.Container;var e=C[this.options.font];if(!e)return console.warn('Error: font "'+this.options.font+'" not founded!'),!1;this.container.x=this.options.x,this.container.y=this.options.y;var i=0;t=""+t;for(var s=0;s<t.length;s++){var r=t[s],o=e.symbols[r];if(o){var n=new PIXI.Sprite(o);n.position.x=this.options.x+i,n.position.y=this.options.y,n.scale.set(this.options.scale),this.options.tint&&(n.tint=this.options.tint),this.container.addChild(n)}else" "!==r&&console.warn('Error! The symbol "'+r+'" is missing in the font "'+this.options.font+'"!');i+=e.w*this.options.scale}var a=this.options.sg2d||T.getInstance();(this.options.layer?a.layers[this.options.layer].container:a.viewport).addChild(this.container)}},LabelCanvas:class{constructor(t,e){this.options=e||{},this.canvas=l.createCanvas(1,1,l.FLAG_CANVAS_ELEMENT),e.parent&&e.parent.append(this.canvas),this.setText(t)}setText(t){var e=C[this.options.font];if(!e)return console.warn('Error: font "'+this.options.font+'" not founded!'),!1;var i=0;t=""+t,this.canvas.width=e.w*t.length,this.canvas.height=e.h;for(var s=0;s<t.length;s++){var r=t[s],o=e.symbols[r];o?l.drawTextureToCanvas(o,this.canvas,{x:i,y:0}):" "!==r&&console.warn('Error! The symbol "'+r+'" is missing in the font "'+this.options.font+'"!'),i+=e.w}}},Sprite:S,MessageToast:w,Sound:m,pixi:null,matter:null,version:"1.0.0",LAYER_POSITION_ABSOLUTE:0,LAYER_POSITION_FIXED:1};"object"==typeof window&&window.document&&(window.SG2D=P);e.default=P}]).default}));